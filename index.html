<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R Workshop</title>
    <meta charset="utf-8" />
    <meta name="author" content="Felix lorenz" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/remark-css/default.css" rel="stylesheet" />
    <link href="index_files/xaringanExtra-banner/banner.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-banner/banner.js"></script>
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link href="index_files/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="index_files/countdown/countdown.css" rel="stylesheet" />
    <script src="index_files/countdown/countdown.js"></script>
    <link rel="stylesheet" href="img/styles_x.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# R Workshop
]
.author[
### Felix lorenz
]
.date[
### 12. Dezember 2022
]

---

<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 128px;
z-index: 0;
background-image: url(./img/tg.jpg);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

<script>document.addEventListener('DOMContentLoaded',function(){new xeBanner(JSON.parse('{"left":"<h6>Staatskanzlei<\/h6><h7>Dienststelle für Statistik<\/h7>","exclude":["title-slide"],"position":"top"}'))})</script>
<script>document.addEventListener('DOMContentLoaded',function(){new xeBanner(JSON.parse('{"left":"12. Dezember 2022","center":"© Staatskanzlei","exclude":["title-slide"],"position":"bottom"}'))})</script>







































----
## Ziele des Workshops


1. Richtiges Mindset schaffen, um Programmieren zu lernen

2. Möglichst breiten Blick auf die Möglichkeiten von R schaffen, um Grundstein für selbstständiges Lernen zu bilden.

3. Beispiele aus der Praxis in der Dienststelle für Statistik zum besseren Verständnis


---
----
## R und RStudio

.pull-left[
**R**
- R ist eine freie (open-source) Programmiersprache, erschienen in 1993
- R ist eine Arbeitsumgebung für statistische Analysen und Grafiken (und vieles mehr)
- R kann mit *packages* erweitert werden
]
--
.pull-right[

**RStudio**

- RStudio ist eine grafische Benutzeroberfläche, welche auch integrierte Entwicklunsumgebung (i.e. IDE - integrated development environment) genannt wird

]

---
----
## Die R und tidyverse-Bibel

&lt;div class="figure"&gt;
&lt;img src="https://pictures.abebooks.com/isbn/9781491910399-de.jpg" alt="https://pictures.abebooks.com/isbn/9781491910399-de.jpg" width="30%" /&gt;
&lt;p class="caption"&gt;https://pictures.abebooks.com/isbn/9781491910399-de.jpg&lt;/p&gt;
&lt;/div&gt;

Das Buch ist kostenlos [hier](https://r4ds.had.co.nz/index.html) zu finden und ist ideal für Einsteiger.





---
----
## Aufbau RStudio
&lt;img src="./img/Rstudio.jpg" width="100%" /&gt;


---
----
## R Projects

- Daten, Scripts etc. werden in einem Ordner gebündelt
- erleichtert die Strukturierung und erhöht die Übersichtlichkeit

**Derzeitige Ordnung im Y widerspricht dieser Logik**


&lt;img src="./img/03_projects.png" width="60%" /&gt;
---
----
## R Projects

In der Regel folgen Projekte dem untenstehenden Aufbau. Dieser ist dem Aufbau eines Packages nachempfunden. Dies ist jedoch kein Muss und kann variiert werden.


```r
# Project
- data
  -&gt; dataset.csv
- R
  -&gt; data_preparation.R
- output
  -&gt; output.xlsx
- www
  -&gt; image.png
```

---
----
## Hands On: R Projects und initiale Einstellungen

- Unnötiges Speichern/Laden von Daten ausstellen

- Global Options kennenlernen

- Projekte erstellen

---
----

## Funktionen, Objekte und Packages



&gt; **In R ist alles ein Objekt – auch Funktionen sind spezielle Objekte.**

R speichert sowohl Daten als auch Funktionen als Objekte. So können alle Elemente einheitlich behandelt und flexibel genutzt werden.




---
----

## Datenstrukturen

R besitzt verschiedene Basisobjekte, die ihr bereits im *DataCamp* Kurs kennengelernt habt. Die meistgenutzten sind:

.panelset[
.panel[.panel-name[Variablen]
- grundlegenstes und kleinstes R Objekt
- kann `numeric`, `character` oder `logical` sein

```r
x &lt;- 10
y  = "Das ist ein String"
x
```

```
## [1] 10
```

```r
y
```

```
## [1] "Das ist ein String"
```
]
.panel[.panel-name[Vektoren]
- eindimensionales Objekt. Alle Elemente müssen den gleichen Datentyp haben.
- am häufigsten verwendet werden `numeric`, `character` oder `logical`

```r
vec_num &lt;- c(1,5,2)
vec_char &lt;- c("one","five",NA)
var_log &lt;- c(FALSE,TRUE,TRUE)
vec_num
```

```
## [1] 1 5 2
```

```r
vec_char
```

```
## [1] "one"  "five" NA
```
]
.panel[.panel-name[Data Frames]
- vergleichbar mit klassischer Tabelle (alle Spalten müssen gleich lang sein)
- einzelne Spalten sind im Prinzip Vektoren und besitzen die gleichen Eigenschaften

```r
df &lt;- data.frame(col_1 = c(1,5,2),col_2 = vec_char)
df
```

```
##   col_1 col_2
## 1     1   one
## 2     5  five
## 3     2  &lt;NA&gt;
```
]

.panel[.panel-name[Listen]
- Boxen die unterschiedlichste Objekte enthalten können
- in einer Liste kann prinzipiell alles gespeichert werden

```r
temp_list &lt;- list(x,y,vec_num, vec_char,df)
temp_list[[5]]
```

```
##   col_1 col_2
## 1     1   one
## 2     5  five
## 3     2  &lt;NA&gt;
```
]

]



---
----
## Funktionen
- Funktionen sind wichtige Bestandteile im Arbeiten mit R. Einzelne Tasks können mit einer Funktion zusammengefasst und reproduzierbar gemacht werden


.panelset[
.panel[.panel-name[built-in]

R besitzt viele "built-in" Funktionen, wie z. B. mathematischen Grundlagen (`mean()`,`sum()`,`sqrt()`, etc.)

```r
values &lt;- c(3,9,6,8)
mean(values)
```

```
## [1] 6.5
```
]
.panel[.panel-name[Aus package]

Einzelne Funktionen aus packages können mit voransgestelltem `packagename::` aufgerufen werden. 

Die `library` Funktion lädt alle Funktionen des Packages. Der vorangestellte package Name kann dann weggeleassen werden.

```r
library(dplyr)
```

```r
dplyr::dense_rank(values)
```

```
## [1] 1 4 2 3
```
]
.panel[.panel-name[Eigene Funktion]

Funktionen können auch vom User selbst ersetellt werden


```r
greetings &lt;- function(name){
  result &lt;- paste0("Hello ",name,". Nice to meet you.")
  print(result)
}
```

```r
greetings(name="Joe")
```


]
.panel[.panel-name[Ergebnis]

```
## [1] "Hello Joe. Nice to meet you."
```
]
]
---
----

## Packages

- Erweiterungen, die reproduzierbare Funktionen enthalten und kostenfrei genutzt werden können
- Packages können direkt von [CRAN (Comrehensive R Archive Network)](https://cran.r-project.org/) installiert werden
- Packages können auch von GitHub, GitLab o.ä. installiert werden
- Jede/r kann Packages entwickeln 


```r
# CRAN
install.packages("package_name")
install.packages("dplyr")

# GITHUB
devtools::install_github("username/package_name")
devtools::install_github("ogdtg/tgAPI")

# GITLAB
devtools::install_gitlab("username/packagename")

# uvm...
```
---

























----
## "Programmierweisheiten"

--

**1. Jedes Problem hatte irgendjemand anders schon einmal...**

--

**2. "Richtiges" Googlen ist die halbe Miete beim Programmieren.**

--

**3. Man kann oft mehr automatisieren, als man im ersten Moment denkt.**

--

**4. Automatisierung bring *immer* einen Mehrwert.**

--

**5. Viele Wege führen nach Rom.**

---
----
## Jedes Problem hatte irgendjemand anders schon einmal...

...die Lösung ist daher meistens auch irgendwo zu finden.

- Code übernehmen und reproduzieren, anstatt das Rad jedes Mal neu erfinden

- [Stack Overflow](https://stackoverflow.com/) hilft (fast) immer. (*"Every data scientist has a tab open to Stack Overflow"*)

- Unzählige weitere Hilfeseiten z.B. [Rbloggers](https://www.r-bloggers.com/), [Geeks for Geeks](https://www.geeksforgeeks.org/r-programming-language-introduction/), etc.

&lt;br&gt;
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://upload.wikimedia.org/wikipedia/commons/0/02/Stack_Overflow_logo.svg" alt="https://upload.wikimedia.org/wikipedia/commons/0/02/Stack_Overflow_logo.svg" width="40%" /&gt;
&lt;p class="caption"&gt;https://upload.wikimedia.org/wikipedia/commons/0/02/Stack_Overflow_logo.svg&lt;/p&gt;
&lt;/div&gt;


---
----
## "Richtiges" Googlen ist die halbe Miete

- Programmieren ist ein englischsprachiges Feld &amp;#10140; auf Englisch googlen bringt die besten Ergebnisse

- Bei Fehlermeldungen kann als erster Schritt einfach der Text der Meldung gegooglet werden &amp;#10140; bringt meistens schon ersten Anhaltspunkt

---
----
## Man kann oft mehr automatisieren als man im ersten Moment denkt
&lt;br&gt;
- Prozesse als Ganzes betrachten! Kann ich vielleicht noch mehr automatisieren, als diesen einen spezifischen Prozessschritt?

- Kann ich meine Arbeit skalieren und für andere Prozesse nutzen?

- Wie kann ich meinen Code so generisch wie möglich schreiben?

---
----
## Automatisierung bring immer einen Mehrwert

--

- Automatisierung spart oft Zeit

--

- Automatisierung reduziert meistens die Fehleranfälligkeit

--

- Automatisierung bringt **immer** einen Lerneffekt

--

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://marcgg.com/assets/blog/automation-win.png" alt="https://marcgg.com/assets/blog/automation-win.png" width="55%" /&gt;
&lt;p class="caption"&gt;https://marcgg.com/assets/blog/automation-win.png&lt;/p&gt;
&lt;/div&gt;


---
----
## Viele Wege führen nach Rom

- Es gibt niemals "die eine Lösung"

- Probleme können auf die unterschiedlichste Art, mit den unterschiedlichsten Funktionen und den unterschiedlichsten Packages gelöst werden
&lt;br&gt;
&lt;br&gt;
&lt;h2 align="center"&gt;&lt;i&gt;"Der beste Code ist der, der verlässlich funktioniert" &lt;/i&gt;&lt;/p&gt;

---
----
## Programmieren lernt man nur durch Anwendung!

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="./img/how_much_I_think_I_know_about_R.PNG" alt="https://tidyverse.tidyverse.org/logo.png" width="598" /&gt;
&lt;p class="caption"&gt;https://tidyverse.tidyverse.org/logo.png&lt;/p&gt;
&lt;/div&gt;
---
























----
## Das tidyverse 
.pull-left[
tidyverse ist eine Sammlung von zusammenhängenden R-Paketen. Sie basiert auf der Idee von tidy Data, wo jede Spalte eine Variable, jede Zeile eine Beobachtung und jede Zelle einen einzelnen Wert darstellt.

Das tidyverse umfasst Pakete für die Datenmanipulation, Visualisierung und Modellierung. Alle Packages basieren auf einer konsistenten "Grammatik".

]
.pull-right[
&lt;div class="figure"&gt;
&lt;img src="https://tidyverse.tidyverse.org/logo.png" alt="https://tidyverse.tidyverse.org/logo.png" style =top: 0; right: 0; display: block; margin-left: auto; /&gt;
&lt;p class="caption"&gt;https://tidyverse.tidyverse.org/logo.png&lt;/p&gt;
&lt;/div&gt;
]

---
----
## Das tidyverse
&lt;figure class="logo-fig logo-title1"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title4"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title5"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title6"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title7"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title8"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title9"&gt;
  &lt;a href='https://forcats.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://forcats.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


&lt;figure class="logo-fig logo-title10"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;


---
























----
## Daten einlesen


&lt;figure class="logo-fig logo-title1"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title4"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title5"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title6"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title7"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title8"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title9"&gt;
  &lt;a href='https://forcats.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://forcats.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


&lt;figure class="logo-fig logo-title10"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

---
----
## Daten einlesen

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


R kann prinzipiell jede Form von Daten einlesen:

- für Standard Formate wie csv oder txt wird das `readr` package benutzt.

- für Dateitypen aus anderen Statistik Tools wie SAS, SPSS oder STATA kann `haven` benutzt werden.

- Excel Files können mit dem `readxl` package eingelesen werden

Generell gibt es sehr viele verschiedene Einlesefunktionen und -packages, die alle das gleiche Ergebnis liefern.

Sie unterscheiden sich jedoch in ihrer Perfomance.

---
----
## Daten einlesen


&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[CSV]

```r
library(readr)
# Comma separated
df_comma &lt;- read_csv("path/to/comma_separated.csv")

# Semicolon separated
df_semicolon &lt;- read_csv2("path/to/semicolon_separated.csv")

# Tab separated
df_tab &lt;- read_tsv("path/to/tab_separated.csv")
```
]
.panel[.panel-name[Excel]

```r
library(readxl)
df_excel &lt;- read_excel("path/to/excel_file.xlsx")
```
]
.panel[.panel-name[SAS]

```r
library(haven)
df_sas &lt;- read_sas("path/to/sas_file.sas7bdat")
```
]
.panel[.panel-name[fwf]
- *"fixed width file"* wie teilweise vom BFS erhalten

```r
library(readr)
df_fwf &lt;- read_fwf("path/to/fwf_data.txt",
                 fwf_positions(start=vec_start_col,
                               end=vec_end_col,
                               col_names = vec_names_col)
                 )
```
]
.panel[.panel-name[rds/rda]
- `rds` und `rda` sind die R-internen Datenfromate
- sie sind optimiert für R, können schnell geladen werden und sind speichereffizient

```r
# speichern
saveRDS(dataset, "data.rds")

# laden
dataset &lt;- readRDS("data.rds")
```
]
]



---
----
## Hands-On: Daten einlesen (Zeit: 10 Minuten)

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;ol type="a"&gt;
  &lt;li&gt;&lt;b&gt;EXCEL&lt;/b&gt;&lt;br&gt;
  Lies die Datei &lt;b&gt;bevölkerung.xlsx&lt;/b&gt; als data.frame ein.&lt;br&gt;
  Nenne den data.frame "bev".&lt;br&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;b&gt;CSV&lt;/b&gt;&lt;br&gt;
  Lies die Datei &lt;b&gt;bevölkerung.csv&lt;/b&gt; als data.frame ein.&lt;br&gt;
  Nenne den data.frame "bev_csv"&lt;br&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;b&gt;SAS&lt;/b&gt;&lt;br&gt;
  Lies die Datei &lt;b&gt;bevnatgeb2021.sas7bdat&lt;/b&gt; als data.frame ein.&lt;br&gt;
  Nenne den data.frame "bevnat".&lt;br&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;b&gt;EXCEL (Bonus)&lt;/b&gt;&lt;br&gt;
  Lies das Tabellenblatt &lt;b&gt;"altersklassen"&lt;/b&gt; aus der Datei &lt;b&gt;bevölkerung.xlsx&lt;/b&gt; als data.frame ein.&lt;br&gt;
  Nenne den data.frame "alter" und speichere ihn als &lt;b&gt;alter.csv&lt;/b&gt; in deinem Output Ordner.&lt;br&gt;
  &lt;/li&gt;
&lt;/ol&gt;

Benutze jeweils die `head()` Funktion um **die ersten 3 Zeilen** des Datensatzes anzeigen zu lassen. 

<div class="countdown" id="timer_e1dbf71c" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
----
## Hands-On: Daten einlesen (Zeit: 10 Minuten)

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[Lösung a)]



```r
library(readr)
df &lt;- read_csv("Data/Geburten.csv")
head(df,3)
```
]

.panel[.panel-name[Lösung b)]



```r
library(haven)
df &lt;- read_sas("bevnatgeb2020.sas7bdat")
head(df,3)
```
]

.panel[.panel-name[Lösung c)]



```r
library(readxl)
df &lt;- read_excel("Daten/test.xlsx")
head(df,3)
```
]
.panel[.panel-name[Lösung d)]


```r
df &lt;- read_excel("Daten/test.xlsx",sheet="Bonus")
head(df,3)
write_csv(df,"Felix/Output/alter.csv", na ="")
```
]
]

---
----
## Daten einlesen: Good to know 

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-fig-small3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;p style="margin-top:70px;"&gt;&lt;p/&gt;
Sollen mehrere Files aus einem Ordner eingelesen werden, kann die `list.files()` Funktion verwendet werden. Mit dieser Funktion werden alle Files mit einer spezifischen Endung innerhalb eines Ordners aufgelistet. Diese können dann mit einem `for`-Loop oder einer der `apply` Funktionen schnell eingelesen werden.

```r
# Listet alle CSV Files im Ordner
list.files(path = "path/to/directory", pattern = "*.csv")
```

Bei grossen Files kann es manchmal zu Problemen beim Einlesen kommen, aufgrund der internen Logik von R.
&lt;br&gt;
Im hier verlinkten [Tutorial](https://inbo.github.io/tutorials/tutorials/r_large_data_files_handling/) werden entsprechende Lösungsansätze aufgezeigt.
---























----
## Data Manipulation

&lt;figure class="logo-fig logo-title1"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title4"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title5"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title6"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title7"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title8"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title9"&gt;
  &lt;a href='https://forcats.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://forcats.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


&lt;figure class="logo-fig logo-title10"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


---
----
## magrittr:: %&gt;%

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit dem `magrittr` package und dem darin enthaltenen Pipeline Operator `%&gt;%` wird euer Code viel einfacher lesbar.
- Der Code wird durch die Nutzung der Pipe weniger verschachtelt und so einfacher zu debuggen.


.panelset[
.panel[.panel-name[Ohne Pipe]
Innerste Klammer wird zuerst usgeführt

```r
h(g(f(df)))
```
]
.panel[.panel-name[Mit Pipe]
Code wird nacheinander ausgeführt (f() dann g() dann h())

```r
df %&gt;% 
  f() %&gt;% 
  g() %&gt;% 
  h()
```
]
.panel[.panel-name[Ohne Platzhalter]

```r
langer_variablenname %&gt;%  f(y, z = langer_variablenname)
```
]
.panel[.panel-name[Mit Platzhalter]
Innerhalb der Pipeline kann anstelle der Variable, auf welche die Operationen angewendet werden auch der `.` als Platzhalter verwendet werden.

```r
langer_variablenname %&gt;%  f(y, z = .)
```
]
]

---
----
## Hands-On: Piping mit magrittr:: %&gt;%

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

```r
num_vec &lt;- c(5,4,6,1,4)

round(sqrt(sum(num_vec)),1)
```
`num_vec` soll aufsummiert und anschliessend soll die Wurzel aus der Summe gezogen werden. 
Das Ergebnis soll auf eine Nachkommastelle gerundet werden
Die oben stehende Codezeile führt diese Operationen aus. 

&lt;ol type="a"&gt;
  &lt;li&gt;
  Verwende den &lt;b&gt;%&gt;%&lt;/b&gt; Operator um die oben stehende Codezeile in eine Pipe im Stile von dplyr umzuwandeln&lt;br&gt;
  Wandle die Zeile in EINE Pipe um OHNE Zwischenergebnisse zu speichern. Verwende den Namen des Vektors nur EINMAL.
  &lt;/li&gt;
&lt;/ol&gt;

<div class="countdown" id="timer_2b9fe5e3" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---

























----
## Recap: Tidy Data

- Jede Spalte eine Variable
- Jede Zeile eine Beobachtung
- Jede Zelle ein einzelner Wert

**Vorteile von Tidy Data**

1. Konsistente Struktur &amp;#10140; es ist leichter, Tools auf verschiedene Datensätze anzuwenden, wenn diese der gleichen Struktur folgen

2. Tidy Data entspricht der inneren Arbeitslogik von R &amp;#10140; Funktionen lassen sich leichter auf Tidy Data anwenden

**Merke:** Tidy Data ist zwar erstrebenswert, aber sollte kein Selbstzweck sein.

---
----

## Recap: Tidy Data

**Beispiel:** COVID Fallzahlen


```
## # A tibble: 4 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
## 1 2022-12-10 TG     140474    723 723/140474
## 2 2022-12-11 TG     140484    723 723/140484
## 3 2022-12-10 BS     102405    372 372/102405
## 4 2022-12-11 BS     102405    372 372/102405
```

--

&lt;p class="check-no"&gt;&amp;#10060;&lt;/p&gt;

---
----

## Recap: Tidy Data

**Beispiel:** COVID Fallzahlen


```
## # A tibble: 8 × 4
##   date       kanton indicator  value
##   &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     cases     140474
## 2 2022-12-10 TG     deaths       723
## 3 2022-12-11 TG     cases     140484
## 4 2022-12-11 TG     deaths       723
## 5 2022-12-10 BS     cases     102405
## 6 2022-12-10 BS     deaths       372
## 7 2022-12-11 BS     cases     102405
## 8 2022-12-11 BS     deaths       372
```

--

&lt;p class="check-no"&gt;&amp;#10060;&lt;/p&gt;
---
----

## Recap: Tidy Data

**Beispiel:** COVID Fallzahlen


```
## # A tibble: 4 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
## 2 2022-12-11 TG     140484    723    0.00515
## 3 2022-12-10 BS     102405    372    0.00363
## 4 2022-12-11 BS     102405    372    0.00363
```

--

&lt;p class="check-yes"&gt;&amp;#10003;&lt;/p&gt;
---
----

## Recap: Tidy Data

**Beispiel:** COVID Fallzahlen


```
## # A tibble: 2 × 3
##   kanton `2022-12-10` `2022-12-11`
##   &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;
## 1 TG           140474       140484
## 2 BS           102405       102405
```

--

&lt;p class="check-no"&gt;&amp;#10060;&lt;/p&gt;
---

























----
## tidyr

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Das `tidyr` package dient dazu Daten ins Tidy Format zu bringen und liefert dazu mehrere nützliche Funktionen

Für detailliertere Informationen findet sich [hier](https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf) ein empfehlenswertes Cheatsheet

**Die drei meist genutzten Funktionen sind:**
- `pivot_longer`: fasst mehrere Spalten zusammen und "verlängert" den Datensatz
- `pivot_wider`: fasst Zeilen zusammen und "verbreitert" den Datensatz
- `separate`: teilt eine Spalte in mehrere Spalten auf (Gegenstück ist `unite`)

---
----
## tidyr

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[Ausgangsdaten]

```
## # A tibble: 4 × 4
##   date       kanton  cases deaths
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723
## 2 2022-12-11 TG     140484    723
## 3 2022-12-10 BS     102405    372
## 4 2022-12-11 BS     102405    372
```
]
.panel[.panel-name[pivot_longer]
Fasst mehrere Spalten zusammen und "verlängert" den Datensatz

```r
df_tidy_m %&gt;% 
  tidyr::pivot_longer(cols = c("cases","deaths"), names_to = c("indicator"))
```

```
## # A tibble: 8 × 4
##   date       kanton indicator  value
##   &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     cases     140474
## 2 2022-12-10 TG     deaths       723
## 3 2022-12-11 TG     cases     140484
## 4 2022-12-11 TG     deaths       723
## 5 2022-12-10 BS     cases     102405
## 6 2022-12-10 BS     deaths       372
## 7 2022-12-11 BS     cases     102405
## 8 2022-12-11 BS     deaths       372
```
]
.panel[.panel-name[pivot_wider]
"Verbreitert" den Datensatz

```r
df_tidy_m %&gt;% 
  tidyr::pivot_wider(names_from = "kanton", values_from = c("cases","deaths"))
```

```
## # A tibble: 2 × 5
##   date       cases_TG cases_BS deaths_TG deaths_BS
##   &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 2022-12-10   140474   102405       723       372
## 2 2022-12-11   140484   102405       723       372
```
]
.panel[.panel-name[separate]
Spalten können mit `separate` in mehrere Spalten aufgeteilt werden.

```r
df_tidy_m %&gt;% 
  tidyr::separate(col="date",sep = "-", into = c("year","month","day"))
```

```
## # A tibble: 4 × 6
##   year  month day   kanton  cases deaths
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 2022  12    10    TG     140474    723
## 2 2022  12    11    TG     140484    723
## 3 2022  12    10    BS     102405    372
## 4 2022  12    11    BS     102405    372
```
]
]

---
----
## Hands-On: Tidy Data mit tidyr

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


```r
library(tidyr)

abstimmungen &lt;- readRDS("Daten/Abstimmungen.rds")
```

1. Bringe die Abstimmungsdaten in eine sinnvolle Form im Sinne von Tidy Data (Wide format)&lt;br&gt;
  Alle Werte in der "Ergebnis" Spalte sollen eine einzelne Spalte sein.&lt;br&gt;
  Ihnen soll jeweils der entsprechende Wert aus der Spalte "Volksabstimmungen (Ergebnisse Ebene Kanton seit 1866)" untergeordnet werden

2. Bringe die Daten wieder in die Ursprungsform (long format)&lt;br&gt;
  Speichere das Ergebnis unter "abstimmungen_not_tidy" 
  
<div class="countdown" id="timer_bbd2f383" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---


























----
## dplyr::select()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit der `select` können die gewünschten Variablen aus dem Datensatz ausgewählt und/oder entfernt werden.

.panelset[
.panel[.panel-name[Ausgangsdaten]

```r
df_tidy
```

```
## # A tibble: 4 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
## 2 2022-12-11 TG     140484    723    0.00515
## 3 2022-12-10 BS     102405    372    0.00363
## 4 2022-12-11 BS     102405    372    0.00363
```
]
.panel[.panel-name[Bsp. 1]
- Variablennamen können direkt an die `select` Funktion übergeben werden.
- Genauso können Variablen auch als Vektor mit `c()` angegeben werden.


```r
df_tidy %&gt;% 
  select(date,cases)
```

```
## # A tibble: 4 × 2
##   date        cases
##   &lt;date&gt;      &lt;dbl&gt;
## 1 2022-12-10 140474
## 2 2022-12-11 140484
## 3 2022-12-10 102405
## 4 2022-12-11 102405
```
]
.panel[.panel-name[Bsp. 2]
Variablen können auch als *range* ausgewählt werden

```r
df_tidy %&gt;% 
  select(date:cases)
```

```
## # A tibble: 4 × 3
##   date       kanton  cases
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
## 1 2022-12-10 TG     140474
## 2 2022-12-11 TG     140484
## 3 2022-12-10 BS     102405
## 4 2022-12-11 BS     102405
```
]
.panel[.panel-name[Bsp. 3]
Auswahl per Spaltenindex ist ebenfalls möglich

```r
df_tidy %&gt;% 
  select(1,3:5)
```

```
## # A tibble: 4 × 4
##   date        cases deaths death_rate
##   &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 140474    723    0.00515
## 2 2022-12-11 140484    723    0.00515
## 3 2022-12-10 102405    372    0.00363
## 4 2022-12-11 102405    372    0.00363
```
]
.panel[.panel-name[Bsp. 4]
Mit vorangestelltem minus (`-`) können Variablen entfernt werden

```r
df_tidy %&gt;% 
  select(-c(date:cases))
```

```
## # A tibble: 4 × 2
##   deaths death_rate
##    &lt;dbl&gt;      &lt;dbl&gt;
## 1    723    0.00515
## 2    723    0.00515
## 3    372    0.00363
## 4    372    0.00363
```
]
.panel[.panel-name[Bsp. 5]
`select` kann z.B. mit `contains`, `ends_with` oder `starts_with`

```r
df_tidy %&gt;% 
  select(contains("death"))
```

```
## # A tibble: 4 × 2
##   deaths death_rate
##    &lt;dbl&gt;      &lt;dbl&gt;
## 1    723    0.00515
## 2    723    0.00515
## 3    372    0.00363
## 4    372    0.00363
```
]
]

---
----

## dplyr::filter()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit `filter` können die gewünschten Reihen gefiltert werden. So kann ein *subset* des Datensatzes erstellt werden
- Der Ausdruck innerhalb der `filter()` function muss vom Typ *logical* sein (`TRUE`,`FALSE`)

--

.panelset[
.panel[.panel-name[Ausgangsdaten]

```r
df_tidy
```

```
## # A tibble: 4 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
## 2 2022-12-11 TG     140484    723    0.00515
## 3 2022-12-10 BS     102405    372    0.00363
## 4 2022-12-11 BS     102405    372    0.00363
```
]
.panel[.panel-name[Bsp. 1]
Für `filter` können sog. Operatoren verwendet werden (`==`, `!=`, `&gt;=`, `&lt;=`, `&lt;`, `&gt;`) 

```r
df_tidy %&gt;% 
  filter(kanton == "TG")
```

```
## # A tibble: 2 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
## 2 2022-12-11 TG     140484    723    0.00515
```
]
.panel[.panel-name[Bsp. 2]
Filteroptionen können mit `&amp;` (*und*) und `|` (*oder*) verbunden werden.

```r
df_tidy %&gt;% 
  filter(kanton == "TG" &amp; date== "2022-12-10")
```

```
## # A tibble: 1 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
```
]
.panel[.panel-name[Bsp. 3]
Für den Abgleich mit einem Vektor kann der `%in%` Operator verwendet werden.

```r
df_tidy %&gt;% 
  filter(cases %in% c(140484,102405))
```

```
## # A tibble: 3 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-11 TG     140484    723    0.00515
## 2 2022-12-10 BS     102405    372    0.00363
## 3 2022-12-11 BS     102405    372    0.00363
```
]
.panel[.panel-name[Bsp. 4]
Wie die meisten dplyr Funktionen, können auch `filter` Statements beliebig oft aneinander gereiht werden 

```r
df_tidy %&gt;% 
  filter(kanton == "TG") %&gt;% 
  filter(date == "2022-12-10")
```

```
## # A tibble: 1 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
```
]
]

---
----

## Hands-On: filter und select (Zeit: 10 Minuten)

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

1. Lies die Datei **bevnatgeb2021.sas7bdat** aus dem Ordner **Daten** als data.frame ein.

2. Wähle nur die Spalten `geb_day`,`geb_mon`,`geb_year`, `sex`, `nat` und `name` aus.

3. Behalte nur Geburten **nach 2010** deren Staatsangehörigkeit **Schweiz** (8100) ist.

4. Speichere das Resultat in der Variable **geburten_ch_2010**


<div class="countdown" id="timer_b7f4369b" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
----

## Hands-On: filter und select (Zeit: 10 Minuten)

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[Lösung 1]

Lies die Datei **geburten_mod.rds** aus dem Ordner **Daten** als data.frame ein.


```r
library(dplyr)
# Aus Datenschutzgründen ist der Datensatz anonymisiert
geburten &lt;- readRDS("Daten/geburten_mod.rds")
```
]

.panel[.panel-name[Lösung 2]

Wähle nur die Spalten `geb_day`,`geb_mon`,`geb_year`, `sex`, `nat` und `name` aus.


```r
geburten_ch_2010 &lt;- geburten %&gt;%
  select(geb_day,geb_mon,geb_year,sex,nat,name)
```
]

.panel[.panel-name[Lösung 3]

Behalte nur Geburten **nach 2010** deren Staatsangehörigkeit **Schweiz** (8100) ist.


```r
geburten_ch_2010 &lt;- geburten %&gt;%
  select(geb_day,geb_mon,geb_year,sex,nat,name) %&gt;%
  filter(geb_year &gt; 2010 &amp; nat == 8100)
head(geburten_ch_2010,3)
```

```
##   geb_day geb_mon geb_year sex  nat     name
## 1      13      10     2016   1 8100         
## 2      28       5     2012   2 8100         
## 3      22       7     2016   1 8100 MAREILLE
```
]
]


---
----

## dplyr::mutate()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit `mutate` können neue Spalten z.B. durch Berechnungen erstellt werden
- `mutate` operiert immer reihenweise

.panelset[
.panel[.panel-name[Ausgangsdaten]

```r
df_tidy
```

```
## # A tibble: 4 × 5
##   date       kanton  cases deaths death_rate
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 2022-12-10 TG     140474    723    0.00515
## 2 2022-12-11 TG     140484    723    0.00515
## 3 2022-12-10 BS     102405    372    0.00363
## 4 2022-12-11 BS     102405    372    0.00363
```
]

.panel[.panel-name[Bsp. 1]


```r
df_tidy %&gt;% 
  mutate(kanton_long = case_when(kanton == "TG" ~ "Thurgau",
                   kanton == "BS" ~ "Basel-Stadt"))
```

```
## # A tibble: 4 × 6
##   date       kanton  cases deaths death_rate kanton_long
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      
## 1 2022-12-10 TG     140474    723    0.00515 Thurgau    
## 2 2022-12-11 TG     140484    723    0.00515 Thurgau    
## 3 2022-12-10 BS     102405    372    0.00363 Basel-Stadt
## 4 2022-12-11 BS     102405    372    0.00363 Basel-Stadt
```
]

.panel[.panel-name[Bsp. 2]


```r
df_tidy %&gt;% 
  mutate(death_percent = deaths/cases *100) %&gt;% 
  mutate(death_percent = round(death_percent,2)) %&gt;% 
  mutate(death_percent = paste0(death_percent," %"))
```

```
## # A tibble: 4 × 6
##   date       kanton  cases deaths death_rate death_percent
##   &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;        
## 1 2022-12-10 TG     140474    723    0.00515 0.51 %       
## 2 2022-12-11 TG     140484    723    0.00515 0.51 %       
## 3 2022-12-10 BS     102405    372    0.00363 0.36 %       
## 4 2022-12-11 BS     102405    372    0.00363 0.36 %
```
]
]

---
----
## mutate(): Good to know

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Mit `mutate_all` oder `mutate_at` können alle Variablen bzw. alle Variablen mit einem bestimmten Kriterium gleichzeitig bearbeitet werden.

Das ist nützlich, wenn man die gleiche Operation auf mehrere Spalten anwenden will.


```r
df_tidy %&gt;% 
  mutate_all(as.character) %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 5
##   date       kanton cases  deaths death_rate         
##   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;              
## 1 2022-12-10 TG     140474 723    0.00514685991713769
## 2 2022-12-11 TG     140484 723    0.005146493550867  
## 3 2022-12-10 BS     102405 372    0.00363263512523803
```

---
----

## dplyr::group_by

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit der `group_by` Funktion können Datensätze gruppiert werden. Die Daten an sich werden dadurch allerdings noch nicht verändert.
- Mächtig wird die Funktion erst in Kombination mit anderen Funktionen, wie z.B. `mutate` oder `summarise`

.panelset[
.panel[.panel-name[Ausgangsdaten]

```r
head(geburten_ch_2010,5)
```

```
##   geb_day geb_mon geb_year sex  nat     name
## 1      13      10     2016   1 8100         
## 2      28       5     2012   2 8100         
## 3      22       7     2016   1 8100 MAREILLE
## 4       4       7     2016   1 8100         
## 5      10      11     2016   2 8100    Elias
```
]

.panel[.panel-name[Bsp. 1]

Neue Variablen nach Gruppen erstellen mit `group_by` und `mutate`


```r
geburten_ch_2010 %&gt;% 
  group_by(geb_year,name) %&gt;% 
  mutate(sum_name_year = n()) %&gt;% head(2)
```

```
## # A tibble: 2 × 7
## # Groups:   geb_year, name [2]
##   geb_day geb_mon geb_year   sex   nat name  sum_name_year
##     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;int&gt;
## 1      13      10     2016     1  8100 ""               16
## 2      28       5     2012     2  8100 ""               15
```
]

.panel[.panel-name[Bsp. 2]

Daten zusammenfassen mit `group_by` und `summarise`


```r
geburten_ch_2010 %&gt;% 
  group_by(geb_year) %&gt;% 
  summarise(geb_per_year = n()) %&gt;% head(2)
```

```
## # A tibble: 2 × 2
##   geb_year geb_per_year
##      &lt;dbl&gt;        &lt;int&gt;
## 1     2012           35
## 2     2016           55
```
]
]

---
----

## dplyr::group_by

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

**ACHTUNG:** Sollten Daten nach einem `group_by` in einer neuen Variable gespeichert werden, dann wird die Gruppierung übernommen.
Das kann zu Verwirrung im weiteren Verarbeiten der Daten führen. Daher ist zu empfehlen nach einem `group_by` und der angehängten `mutate` die Gruppierung mit `ungroup` wieder aufzulösen.

Nach einem `summarise` ist diese Auflösung nicht nötig.

.panelset[
.panel[.panel-name[Code 1]

- Ohne `ungroup` 


```r
geburten_group &lt;- geburten_ch_2010 %&gt;% 
  group_by(geb_year,name) %&gt;% 
  mutate(sum_name_year = n())

geburten_group %&gt;% 
  mutate(n = n())
```
]

.panel[.panel-name[Output 1]

- Ohne `ungroup` 


```
## # A tibble: 4 × 8
## # Groups:   geb_year, name [3]
##   geb_day geb_mon geb_year   sex   nat name       sum_name_year     n
##     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;int&gt; &lt;int&gt;
## 1      13      10     2016     1  8100 ""                    16    16
## 2      28       5     2012     2  8100 ""                    15    15
## 3      22       7     2016     1  8100 "MAREILLE"             1     1
## 4       4       7     2016     1  8100 ""                    16    16
```
]

.panel[.panel-name[Code 2]

- Mit `ungroup`


```r
geburten_ungroup &lt;- geburten_ch_2010 %&gt;% 
  group_by(geb_year,name) %&gt;% 
  mutate(sum_name_year = n()) %&gt;% 
  ungroup()

geburten_ungroup %&gt;% 
  mutate(n = n())
```
]

.panel[.panel-name[Output 2]

- Mit `ungroup`


```
## # A tibble: 4 × 8
##   geb_day geb_mon geb_year   sex   nat name       sum_name_year     n
##     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;int&gt; &lt;int&gt;
## 1      13      10     2016     1  8100 ""                    16    90
## 2      28       5     2012     2  8100 ""                    15    90
## 3      22       7     2016     1  8100 "MAREILLE"             1    90
## 4       4       7     2016     1  8100 ""                    16    90
```
]
]
---
----
## Hands-On: mutate(), group_by() und summarise()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;




1. Erstelle für den in der vorherigen Aufgabe erstellten Datensatz geburten_ch_2010 eine neue Spalte `geb_date`.&lt;br&gt;
Die Spalte soll das Geburtsdatum im Format tt.mm.jjjj enthalten.&lt;br&gt;
Verwende dazu die `paste0()` Funktion.&lt;br&gt;
Speichere das Resultat unter dem Namen **geburten_ch_2010_date**   

2. Erstelle eine Variable `age`, welche das Alter des Kindes zum heutigen Tag enthält.&lt;br&gt;
**Tipp:** das heutige Datum kann mit `Sys.Date()` ermittelt und verwendet werden. Die variable `age` soll das Alter in vollendeten Lebensjahren beinhalten.

3. Zähle die Geburten pro (Geburts-)Jahr im Datensatz&lt;br&gt;
**Tipp:** Nutze `group_by()` sowie `count()` bzw. `summarise()` und `n()`

<div class="countdown" id="timer_e1b7899b" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
----

## dplyr::join()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Mit den Funktionen aus der `join` Familie können mehrere Datensaätze miteinander verbunden werden.

Es wird dabei zwischen [Filtering joins](https://dplyr.tidyverse.org/reference/filter-joins.html) und [Mutating joins](https://dplyr.tidyverse.org/reference/mutate-joins.html) unterscheiden.

.panelset[
.panel[.panel-name[Filtering joins]

...filtern Zeilen aus x auf der Grundlage des Vorhandenseins oder Fehlens von Übereinstimmungen in y

- `semi_join(x,y)`: gibt alle Zeilen von `x` **mit** einem Match in `y` zurück
- `anti_join(x,y)`: gibt alle Zeilen von `x` **ohne** ein Match in `y` zurük 

]
.panel[.panel-name[Mutating joins]

...fügen Spalten von y nach x hinzu, wobei die Zeilen anhand der Schlüssel abgeglichen werden

- `inner_join(x,y)`: beinhaltet alle Zeilen in `x` die ein match in `y` haben
- `left_join(x,y)`: beinhaltet alle Zeilen in `x`
- `right_join(x,y)`: beinhaltet alle Zeilen in `y`
- `full_join(x,y`: beinhaltet alle Zeilen in `x` und `y`

]
]


---
----

## dplyr::join()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://tavareshugo.github.io/r-intro-tidyverse-gapminder/fig/07-dplyr_joins.svg" alt="https://tavareshugo.github.io/r-intro-tidyverse-gapminder/fig/07-dplyr_joins.svg" width="57%" /&gt;
&lt;p class="caption"&gt;https://tavareshugo.github.io/r-intro-tidyverse-gapminder/fig/07-dplyr_joins.svg&lt;/p&gt;
&lt;/div&gt;

---
----

## dplyr::join()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.pull-left[
**df1: Beliebte Vornamen**


```
## # A tibble: 7 × 4
##     sex nat   name          n
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
## 1     1 8100  "fabian"    349
## 2     2 8100  "jasmin"    256
## 3     1 8218  "alessio"    43
## 4     2 8218  "alessia"    32
## 5     1 8239  "emre"       22
## 6     2 8239  "selin"      19
## 7     1 8999  ""          586
```

]
.pull-right[
**df2: Länder und Codes**

```
## # A tibble: 4 × 2
##   code  country
##   &lt;chr&gt; &lt;chr&gt;  
## 1 8100  Schweiz
## 2 8218  Italien
## 3 8239  Türkiye
## 4 8256  Kosovo
```
]


---
----

## Mutating joins

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[left_join]


```r
df1 %&gt;% 
  left_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 7 × 5
##     sex nat   name          n country
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;  
## 1     1 8100  "fabian"    349 Schweiz
## 2     2 8100  "jasmin"    256 Schweiz
## 3     1 8218  "alessio"    43 Italien
## 4     2 8218  "alessia"    32 Italien
## 5     1 8239  "emre"       22 Türkiye
## 6     2 8239  "selin"      19 Türkiye
## 7     1 8999  ""          586 &lt;NA&gt;
```

]
.panel[.panel-name[right_join]

```r
df1 %&gt;% 
  right_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 7 × 5
##     sex nat   name        n country
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  
## 1     1 8100  fabian    349 Schweiz
## 2     2 8100  jasmin    256 Schweiz
## 3     1 8218  alessio    43 Italien
## 4     2 8218  alessia    32 Italien
## 5     1 8239  emre       22 Türkiye
## 6     2 8239  selin      19 Türkiye
## 7    NA 8256  &lt;NA&gt;       NA Kosovo
```

]
.panel[.panel-name[inner_join]


```r
df1 %&gt;% 
  inner_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 6 × 5
##     sex nat   name        n country
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  
## 1     1 8100  fabian    349 Schweiz
## 2     2 8100  jasmin    256 Schweiz
## 3     1 8218  alessio    43 Italien
## 4     2 8218  alessia    32 Italien
## 5     1 8239  emre       22 Türkiye
## 6     2 8239  selin      19 Türkiye
```
]
.panel[.panel-name[full_join]


```r
df1 %&gt;% 
  full_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 8 × 5
##     sex nat   name          n country
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;  
## 1     1 8100  "fabian"    349 Schweiz
## 2     2 8100  "jasmin"    256 Schweiz
## 3     1 8218  "alessio"    43 Italien
## 4     2 8218  "alessia"    32 Italien
## 5     1 8239  "emre"       22 Türkiye
## 6     2 8239  "selin"      19 Türkiye
## 7     1 8999  ""          586 &lt;NA&gt;   
## 8    NA 8256   &lt;NA&gt;        NA Kosovo
```

]
]



---
----

## Filtering joins

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[semi_join]


```r
df1 %&gt;% 
  semi_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 6 × 4
##     sex nat   name        n
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;
## 1     1 8100  fabian    349
## 2     2 8100  jasmin    256
## 3     1 8218  alessio    43
## 4     2 8218  alessia    32
## 5     1 8239  emre       22
## 6     2 8239  selin      19
```

]
.panel[.panel-name[anti_join]

```r
df1 %&gt;% 
  anti_join(df2,by=c("nat"="code"))
```

```
## # A tibble: 1 × 4
##     sex nat   name      n
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1     1 8999  ""      586
```

]
]

---
----

## Hands-On: Joins

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.pull-left[
**df1**

```
## # A tibble: 3 × 2
##   vorname nachname
##   &lt;chr&gt;   &lt;chr&gt;   
## 1 Peter   Huber   
## 2 Maria   Krause  
## 3 Paul    Gut
```

]
.pull-right[
**df2**

```
## # A tibble: 3 × 2
##   nachname alter
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Huber       34
## 2 Huber       67
## 3 Meier       18
```
]
.panelset[
.panel[.panel-name[Frage]

Joint man die beiden Datensätze, wie viele Reihen hat der resultierende Datensatz bei einem...
- left join?
- right join?
- inner join?
- full join?

]
.panel[.panel-name[left_join]

```
## # A tibble: 4 × 3
##   vorname nachname alter
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
## 1 Peter   Huber       34
## 2 Peter   Huber       67
## 3 Maria   Krause      NA
## 4 Paul    Gut         NA
```

]
.panel[.panel-name[right_join]

```
## # A tibble: 3 × 3
##   vorname nachname alter
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
## 1 Peter   Huber       34
## 2 Peter   Huber       67
## 3 &lt;NA&gt;    Meier       18
```

]
.panel[.panel-name[inner_join]

```
## # A tibble: 2 × 3
##   vorname nachname alter
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
## 1 Peter   Huber       34
## 2 Peter   Huber       67
```

]
.panel[.panel-name[full_join]

```
## # A tibble: 5 × 3
##   vorname nachname alter
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
## 1 Peter   Huber       34
## 2 Peter   Huber       67
## 3 Maria   Krause      NA
## 4 Paul    Gut         NA
## 5 &lt;NA&gt;    Meier       18
```

]
]
---
----

## Hands-On: Joins

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;



1. Joine die `geburten_nat` mit dem `codes` Datensatz um den Ländernamen zu den Namensdaten hinzuzufügen&lt;br&gt;
Nutze dafür `left_join()`&lt;br&gt;
Schau dir die Datensätze vorher an, um die gemeinsamen Spalten herauszufinden&lt;br&gt;
Speichere den neuen Datensatz unter dem Namen `geburten_join` 

2. Wie lautet der häufigste männliche Vorname für Kinder mit der Nationalität Nordmazedonien im Datensatz?

<div class="countdown" id="timer_8c75f170" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
----
## Good to know: Joins

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Neben den Standard join Operatoren aus dem `dplyr` Package gibt es auch noch das [fuzzyjoin](http://varianceexplained.org/fuzzyjoin/index.html) Package, welches weitere join Möglichkeiten bietet.

Das Package ermöglicht "inexact matching", wie z.B:

- matching ähnlicher strings
- matching numerischer Werte mit einer gewissen Toleranz
- matching numerischer Werte auf bestimmte Intervalle
- u.v.m.

---
----
## Weitere nützliche dplyr Funktionen

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[arrange]

Mit arrange kann die Reihenfolge der Zeilen nach einer Variable im Datensatz sortiert werden. Standardmässig werden die Daten dann aufsteigend sortiert. 


```r
geburten_ch_2010 %&gt;% 
  arrange(geb_year) %&gt;% head(2)
```

```
##   geb_day geb_mon geb_year sex  nat name
## 1      28       5     2012   2 8100     
## 2      19       3     2012   1 8100
```

]
.panel[.panel-name[arrange + desc]
Mit der `desc()` Funktion kann man die Daten auch in eine absteigende Sortierung bringen.

```r
geburten_ch_2010 %&gt;% 
  arrange(desc(geb_year)) %&gt;% head(2)
```

```
##   geb_day geb_mon geb_year sex  nat     name
## 1      13      10     2016   1 8100         
## 2      22       7     2016   1 8100 MAREILLE
```
]
.panel[.panel-name[slice]
Zeilen können auch per Index gefiltert werden

```r
# extrahiert die Zeilen 10,11 und 12
geburten_ch_2010 %&gt;% 
  slice(10:12)
```

```
##   geb_day geb_mon geb_year sex  nat   name
## 1      19       3     2012   1 8100       
## 2       7       6     2012   1 8100 NADINE
## 3       2       8     2012   1 8100   Mike
```

]
.panel[.panel-name[top_n]
Mit `top_n()` können die Zeilen mit den höchsten (oder niedrigsten) Werten für eine bestimmte Variable gefiltert werden

```r
geburten_ch_2010 %&gt;% 
  group_by(geb_year,name) %&gt;% 
  count() %&gt;% 
  group_by(geb_year) %&gt;% 
  top_n(1,n) %&gt;% 
  head(2)
```

```
## # A tibble: 2 × 3
## # Groups:   geb_year [2]
##   geb_year name      n
##      &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
## 1     2012 ""       15
## 2     2016 ""       16
```

]
.panel[.panel-name[distinct]
Mit `distinct()` können Duplikate entfernt werden. Dazu werden einfach die Variablen aus denen die Duplikate entfernt werden sollen als Argumente mitgegeben. Setzt man `.keep_all=TRUE`, dann bleiben alle anderen Variablen des data.frames erhalten. Sonst bleiben nur die Spalten, die als Argument angegeben wurden. Bei der Entfernung der Duplikate wird immer der erste Wert behalten, der Rest wird entfernt.



```r
popular_names %&gt;% 
  distinct(geb_year,.keep_all = TRUE) %&gt;% 
  head(2)
```

```
## # A tibble: 2 × 3
## # Groups:   geb_year [2]
##   geb_year name      n
##      &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
## 1     2012 ""       15
## 2     2016 ""       16
```
]
]
---



























----
## stringr

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Oft muss in der Datenaufbereitung mit Text (=strings) gearbeitet werden. Dafür kann das `stringr` Package verwendet werden.

Für detailliertere Informationen findet sich [hier](https://github.com/rstudio/cheatsheets/blob/main/strings.pdf) ein empfehlenswertes Cheatsheet

Alle Funktionen in stringr beginnen mit str_ und nehmen einen Vektor von Strings (oder einen einzelnen String) als erstes Argument.

Die verwendung von sogenannten *regular expressions* ist möglich.

---
----
## stringr

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[str_detect]
Ermitteln, ob eine bestimmte Zeichenfolge im String enthalten ist.



```r
str_detect(c("Das ist ein Test", "Hello World"),
           pattern = "Test")
```

```
## [1]  TRUE FALSE
```

]
.panel[.panel-name[str_extract]
Text extrahieren


```r
str_extract(c("dasisteinTestmitstrings",
              "das_ist_ein_Test_mit_strings"), 
            pattern = "Test")
```

```
## [1] "Test" "Test"
```

]
.panel[.panel-name[str_replace]
Text ersetzen

```r
str_replace(c("dasisteinTestmitstrings",
              "das_ist_ein_Test_mit_strings_Test"), 
            pattern = "Test",
            replacement = "Versuch")
```

```
## [1] "dasisteinVersuchmitstrings"          
## [2] "das_ist_ein_Versuch_mit_strings_Test"
```
**ACHTUNG:** `str_replace` ersetzt das Pattern lediglich beim ersten Auftreten. Soll jedes Auftreten innerhalb des Strings ersetzt werden, muss die `str_replace_all` Funktion verwendet werden.
]
.panel[.panel-name[str_remove]
Text entfernen

```r
str_remove(c("dasisteinTestmitstrings",
              "das_ist_ein_Test_mit_strings"), 
            pattern = "Test")
```

```
## [1] "dasisteinmitstrings"      "das_ist_ein__mit_strings"
```
**ACHTUNG:** `str_remove` entfernt das Pattern lediglich beim ersten Auftreten. Soll jedes Auftreten innerhalb des Strings entfernt werden, muss die `str_remove_all` Funktion verwendet werden.
]

.panel[.panel-name[str_split]
Text zerteilen

```r
str_split(c("dasisteinTestmitstrings",
              "das_ist_ein_Test_mit_strings"), 
            pattern = "_")
```

```
## [[1]]
## [1] "dasisteinTestmitstrings"
## 
## [[2]]
## [1] "das"     "ist"     "ein"     "Test"    "mit"     "strings"
```
`str_split_fixed` und `str_split_n` sind verwandte Funktionen, die ebenfalls Text zerteilen können un zusätzliche Spezifikationen erlauben.
]
.panel[.panel-name[str_trim]
Leerzeichen an Anfang und Ende eines Strings entfernen

```r
str_trim(c("    Hello World      ", "    Test"))
```

```
## [1] "Hello World" "Test"
```

]
]

---
----
## Regular Expressions
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Regular Expressions (kurz "Regex" genannt) sind eine Art von Zeichenfolgen, die zur Suche nach Mustern in Texten verwendet werden. 

Mit Regex kann man komplexe Suchmuster definieren, die aus bestimmten Zeichenfolgen, Buchstaben, Zahlen, Sonderzeichen und Platzhaltern bestehen.

Beispiele für den Einsatz von Regex sind das Extrahieren von Telefonnummern aus Texten, das Überprüfen der Gültigkeit von E-Mail-Adressen oder das Ersetzen von bestimmten Zeichenfolgen in einer Datei.

---
----
## Regular Expressions: Beispiele
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[Telefonnummern extrahieren]
- Jede Zahl (digit) kann mit dem regex `\d` extrahiert werden.

```r
str_extract_all(c("Meine Nummer ist die 058345-5367",
                  "Meine Adresse ist Grabenstrasse 8, 8510 Frauenfeld"), 
                pattern = "\\d{6}-\\d{4}")
```

```
## [[1]]
## [1] "058345-5367"
## 
## [[2]]
## character(0)
```


]
.panel[.panel-name[Email extrahieren]
-  `.` (Punkt): matcht alles ausser Zeilenumbrüche
- `+`: einer oder mehr des voangengangenen Wertes
- `*`: null oder mehr des voangengangenen Wertes
- `[^\\s]`: matcht alles ausser Whitespaces
- `?\\.ch` und `?@`: Match muss mit `\\.ch` bzw. `@` enden

```r
str_extract_all(c("Meine Mailadresse ist felix.lorenz@tg.ch",
                  "felix.lorenz@tg wird nicht gematcht"), 
                pattern = "[^\\s]*?@.+?\\.ch")
```

```
## [[1]]
## [1] "felix.lorenz@tg.ch"
## 
## [[2]]
## character(0)
```
]
.panel[.panel-name[Weitere nützliche Regex]
Im Netz finden sich jede Menge nützliche Sammlungen

- [Top 15 Commonly Used Regex](https://digitalfortress.tech/tips/top-15-commonly-used-regex/)
- [Regex Tutorial](https://www3.ntu.edu.sg/home/ehchua/programming/howto/Regexe.html)
- [Regex schreiben und testen](https://regexr.com/)
- etc.

]
]
---
----
## Hands-On: Arbeiten mit stringr und Regular Expressions
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

1. Bringe `abstimmungen` in ein Tidy Format, sodass jeder Wert in `Ergebnis` einer eigenen Spalte entspricht&lt;br&gt;
Die dazugehörigen Werte sollen aus der Spalte `Volksabstimmungen (Ergebnisse Ebene Kanton seit 1866)` kommen.&lt;br&gt;
Nutze das tidyr package und eine der vohin besprochenen Funktionen um die Tabelle zu verbreitern (wide Format)&lt;br&gt;
Speichere das Ergebnis in `abstimmungen_tidy` 

2. Erstelle eine neue Variable `date`.&lt;br&gt;
Extrahiere dazu das Datum aus der Spalte `Datum und Vorlage`&lt;br&gt;
Nutze dafür den Regex `\\d\\d\\d\\d-\\d\\d-\\d\\d`

3. Entferne das Datum aus der Spalte `Datum und Vorlage` und wandle die `date` Spalte in ein von R lesbares Datum um.

4. Entferne die Leerzeichen anführenden Leerzeichen aus der Spalte `Datum und Vorlage` (" Test " -&gt; "Test")

<div class="countdown" id="timer_483341d4" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
----
## Good to know: stringi

`stringr` enthält zwar viele nützliche Funktionen im Umgang mit Strings, ist aber auf das Nötigste beschränkt. Eine weitreichende Erweiterung stellt das `stringi` package dar. In diesem Package sind wahrscheinlich alle Funktionen enthalten, die im Umgang mit Text notwendig sein könnten. Im Unterschied zu `stringr` beginnen `stringi` Funktionen nicht mit *str_*, sondern mit *stri_*
---

























----
## lubridate
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
- Da das arbeiten mit Datumsangaben in R oft unintuitiv ist, wurde das `lubridate` Package entwickelt
- Mit `lubridate` Können Datums- und Zeitangaben deutlich einfacher verarbeitet werden, als mit base R.

- `lubridate` kann sowohl Daten vom Typ `date` (Datum auf Tagesbasis) als auch vom Typ `datetime` (Genaues Datum mit Uhrzeit) verarbeiten.

 
---
----
## lubridate: Nützliche Funktionen
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
.panelset[
.panel[.panel-name[date]
- `lubridate` bietet Funktionen an, die quasi jedes Datumsformat erkennen und umwandeln kann. 
- Wichtig ist einzig die Reihenfolge (Tag-Monat-Jahr -&gt; `dmy()`; Jahr-Monat-Tag -&gt; `ymd()`)



```r
ymd("20221212")
```

```
## [1] "2022-12-12"
```

```r
dmy("02.03.2023")
```

```
## [1] "2023-03-02"
```


]
.panel[.panel-name[datetime]
-  gleiches gilt für Daten vom Typ `datetime` (gleiches Prinzip)

```r
dmy_hms("02.03.2023 11:41:12 Uhr")
```

```
## [1] "2023-03-02 11:41:12 UTC"
```
]
.panel[.panel-name[Daten runden und extrahieren]
- will man Daten auf z.B. auf Jahresbasis zusammenfassen müssen tgesaktuelle Daten gerundet werden


```r
new_date &lt;- round_date(dmy_hms("02.03.2023 11:41:12 Uhr"),unit = "year")
new_date
```

```
## [1] "2023-01-01 UTC"
```

- wenn nun nur das Jahr angezeigt werden soll, bietet `lubridate` ebenfalls eine Lösung


```r
year(new_date)
```

```
## [1] 2023
```
]
]


---
----
## Hands-On: lubridate und das Arbeiten mit Datumsangaben
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
1. Betrachten wir den Datensatz `geburten`. Wir möchten das Geburtsdatum noch genauer wissen und beziehen deshalb   die Geburtsstunde des Kindes mit ein. Demnach bilden wir aus dem Geburtsjahr (geb_year), dem Geburtsmonat (geb_mon),   dem Geburtstag und der Geburtsstunde eine neue Variable `geb_fulldate`, die ein von R lesbares Datum vom Typ `datetime` enthält.&lt;br&gt;
Selektiere den Datensatz vor der Berechnung so, dass nur die benötigten Variablen enthalten sind.
Erstelle einen neuen Datensatz `geburten_time` und füge die neue Spalte hinzu.

2. Was ist der Grund für die Warning Message wonach das parsing bei einigen Zeilen fehlgeschlagen ist?

3. Wie könnte man dieses Problem theoretisch lösen?

<div class="countdown" id="timer_427e0515" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---






















----

## Listen
.panelset[
.panel[.panel-name[Basics]
- im Unterschied zu Vektoren können Listen unterschiedlichste Datentypen enthalten

- jedes Listenelement kann man sich als eine Art  Container vorstellen, in dem der jeweilige Inhalt liegt

- Listen werden mit `list()` initialisiert

- jedem Listenelement kann ein Name zugewiesen werden
]
.panel[.panel-name[Zugriff (1)]
- auf Listenelmente kann *direkt* über deren Index oder Namen (wenn vorhanden) zugegriffen werden
- wichtig dabei sind die doppelten eckigen Klammern `[[]]` für direkten Zugriff

```r
new_list &lt;- list(a="hallo",4)
new_list[["a"]]
```

```
## [1] "hallo"
```

```r
new_list[[2]]
```

```
## [1] 4
```
]
.panel[.panel-name[Zugriff (2)]
- mit einfachen eckigen Klammern `[]` greift man über den Index auf den Container zu und erhält als Ergebnis eine Liste


```r
new_list[2]
```

```
## [[1]]
## [1] 4
```

```r
class(new_list[2])
```

```
## [1] "list"
```
]
.panel[.panel-name[Nested Lists]
- Listen können beliebig tief verschachtelt werden (*nested*)
- hierfür wird `list()` innerhalb der Liste verwendet
- Listen können so z.B. einfach in `JSON` umgewandelt werden (ähnliches Prinzip)

```r
nested_list &lt;- list(char = list(a = "halo",b="hi"), nums = list(1,2))
jsonlite::toJSON(nested_list,auto_unbox = T) %&gt;% jsonlite::prettify()
```

```
## {
##     "char": {
##         "a": "halo",
##         "b": "hi"
##     },
##     "nums": [
##         1,
##         2
##     ]
## }
## 
```
]
.panel[.panel-name[Nested Lists (2)]
- für den Zugriff können Indizes und Namen verschachtelt werden
- auch der `$`-Operator kann verwendet werden


```r
nested_list &lt;- list(char = list(a = "halo",b="hi"), nums = list(1,2))
nested_list$char$a
```

```
## [1] "halo"
```

```r
nested_list[["nums"]][[2]]
```

```
## [1] 2
```
]
]

---
----
## Listen (2)

.panelset[
.panel[.panel-name[Listen Bearbeiten]
- neue Listenelmente können einfach per Namen oder Index hinzugefügt werden

```r
new_list[[3]] &lt;- "neues Element"
new_list[["test"]] &lt;- "neu"
new_list
```

```
## $a
## [1] "hallo"
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] "neues Element"
## 
## $test
## [1] "neu"
```
]
.panel[.panel-name[Unlisten]
- Listen können mit `unlist()` zu Vektoren (soweit möglich) umgewandelt werden
- eine Liste von `data.frames` kann mit `dplyr::bind_rows` zu einem zusammenhängenden Datensatz umgewandelt werden

```r
unlist(new_list)
```

```
##               a                                            test 
##         "hallo"             "4" "neues Element"           "neu"
```
]
.panel[.panel-name[Listen mergen]
- mehrere Listen können mit dem `c()` Operator zusammengefügt werden


```r
full_list &lt;- c(new_list,nested_list)
```
]
]
---























----

## Conditional Statements

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- `Conditional Statements` (Bedingungen) sind hilfreich, wenn es z.B. darum geht numerische Daten in Kategorien einzuteilen

- "Wenn x dann y sonst z"

- in `dplyr`-Pipelines kann dazu entweder das klassische `ifelse()` oder die `case_when()` Funktion verwendet werden


---
----

## ifelse

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

.panelset[
.panel[.panel-name[Syntax]


```r
# Genereller Syntax
ifelse(Bedingung,wenn_wahr,wenn_falsch)
```
Mehrere `ifelse` Funktionen können auch verschachtelt werden. Anstelle eines `wenn_falsch` Wert wird dann ein weiteres `ifelse` Statement eingefügt.

```r
ifelse(Bedingung1,wenn_wahr1,
       ifelse(Bedingung2, wenn_wahr2, wenn_falsch))
```

]
.panel[.panel-name[Anwendung]

```r
geburten %&gt;% 
  select(age_m) %&gt;% 
  mutate(age_class = ifelse(age_m&lt;18,"unter 18",
                            ifelse(age_m&gt;=18, "18 oder älter", "unbekannt"))) %&gt;% 
  head(3)
```

```
##   age_m     age_class
## 1    28 18 oder älter
## 2    20 18 oder älter
## 3    31 18 oder älter
```
]
.panel[.panel-name[Problem]

Bei vielen verschachtelten `ifelse` Funktionen wird der Code unübersichtlich (zu viele Klammern, schwer zu bearbeiten)


```r
geburten %&gt;% 
  select(age_m) %&gt;% 
  mutate(age_class = ifelse(age_m &lt; 20,"unter 20",
                            ifelse(age_m&gt;=20 &amp; age_m&lt;25, "20 bis 24", 
                                   ifelse(age_m&gt;=25 &amp; age_m&lt;30, "25 bis 29", 
                                          ifelse(age_m&gt;=30 &amp; age_m&lt;35, "30 bis 34", 
                                                 ifelse(age_m&gt;=35 &amp; age_m&lt;40, "35 bis 39", 
                                                        ifelse(age_m&gt;=40, "40 und älter", "unbekannt"))))))) 
```
]
]


---
----

## dplyr::case_when

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

`case_when` bietet die Möglichkeit den Code in einer übersichtlicheren Form darzustellen.

.panelset[
.panel[.panel-name[Syntax]

- das Tilde-Symbol (`~`) kann mit `Ctrl+Alt+^` (zweimal drücken) erzeugt werden


```r
# Genereller Syntax
case_when(Bedingung ~ wenn_wahr,
          TRUE ~ wenn_falsch)
```
Mehrere Bedingungen werden einfach mit Komma getrennt. `TRUE ~ x` kennzeichnet den Wert der zurückgegeben wird, wenn keine Bedingung zutrifft.

```r
case_when(Bedingung1 ~ wenn_wahr1,
          Bedingung2 ~ wenn_wahr2,
          TRUE ~ wenn_falsch)
```

]
.panel[.panel-name[Anwendung]

```r
geburten %&gt;% 
  select(age_m) %&gt;% 
  mutate(age_class = case_when(age_m&lt;18 ~"unter 18",
                               age_m&gt;=18 ~ "18 oder älter",
                               TRUE ~ "unbekannt")) %&gt;% 
  head(3)
```

```
##   age_m     age_class
## 1    28 18 oder älter
## 2    20 18 oder älter
## 3    31 18 oder älter
```
]
.panel[.panel-name[Vorteil ggü. ifelse]

Mehrere Bedingungen können einfach unterinander geschrieben werden, ohne das jedes Mal eine neue Klammer geöffnet werden muss.

Der Code wird leichter lesbar und einfacher zu bearbeiten.

```r
geburten %&gt;% 
  select(age_m) %&gt;% 
  mutate(age_class = case_when(age_m &lt; 20 ~ "unter 20",
                               age_m&gt;=20 &amp; age_m&lt;25 ~ "20 bis 24",
                               age_m&gt;=25 &amp; age_m&lt;30 ~ "25 bis 29",
                               age_m&gt;=30 &amp; age_m&lt;35 ~ "30 bis 34",
                               age_m&gt;=35 &amp; age_m&lt;40 ~ "35 bis 39",
                               age_m&gt;=40 ~ "40 und älter",
                               TRUE ~ "unbekannt"))
```

```
##      age_m    age_class
## 1       28    25 bis 29
## 2       20    20 bis 24
## 3       31    30 bis 34
## 4       24    20 bis 24
## 5       38    35 bis 39
## 6       27    25 bis 29
## 7       26    25 bis 29
## 8       20    20 bis 24
## 9       27    25 bis 29
## 10      34    30 bis 34
## 11      25    25 bis 29
## 12      27    25 bis 29
## 13      22    20 bis 24
## 14      27    25 bis 29
## 15      26    25 bis 29
## 16      32    30 bis 34
## 17      32    30 bis 34
## 18      38    35 bis 39
## 19      28    25 bis 29
## 20      28    25 bis 29
## 21      29    25 bis 29
## 22      26    25 bis 29
## 23      34    30 bis 34
## 24      20    20 bis 24
## 25      29    25 bis 29
## 26      22    20 bis 24
## 27      35    35 bis 39
## 28      28    25 bis 29
## 29      23    20 bis 24
## 30      30    30 bis 34
## 31      29    25 bis 29
## 32      40 40 und älter
## 33      28    25 bis 29
## 34      30    30 bis 34
## 35      31    30 bis 34
## 36      21    20 bis 24
## 37      30    30 bis 34
## 38      30    30 bis 34
## 39      27    25 bis 29
## 40      30    30 bis 34
## 41      36    35 bis 39
## 42      31    30 bis 34
## 43      27    25 bis 29
## 44      31    30 bis 34
## 45      18     unter 20
## 46      32    30 bis 34
## 47      25    25 bis 29
## 48      26    25 bis 29
## 49      25    25 bis 29
## 50      30    30 bis 34
## 51      25    25 bis 29
## 52      25    25 bis 29
## 53      29    25 bis 29
## 54      22    20 bis 24
## 55      31    30 bis 34
## 56      36    35 bis 39
## 57      30    30 bis 34
## 58      27    25 bis 29
## 59      35    35 bis 39
## 60      32    30 bis 34
## 61      30    30 bis 34
## 62      33    30 bis 34
## 63      32    30 bis 34
## 64      30    30 bis 34
## 65      30    30 bis 34
## 66      23    20 bis 24
## 67      23    20 bis 24
## 68      31    30 bis 34
## 69      29    25 bis 29
## 70      21    20 bis 24
## 71      29    25 bis 29
## 72      27    25 bis 29
## 73      36    35 bis 39
## 74      33    30 bis 34
## 75      27    25 bis 29
## 76      27    25 bis 29
## 77      34    30 bis 34
## 78      30    30 bis 34
## 79      24    20 bis 24
## 80      26    25 bis 29
## 81      24    20 bis 24
## 82      20    20 bis 24
## 83      29    25 bis 29
## 84      27    25 bis 29
## 85      22    20 bis 24
## 86      24    20 bis 24
## 87      30    30 bis 34
## 88      28    25 bis 29
## 89      26    25 bis 29
## 90      26    25 bis 29
## 91      28    25 bis 29
## 92      27    25 bis 29
## 93      25    25 bis 29
## 94      34    30 bis 34
## 95      31    30 bis 34
## 96      24    20 bis 24
## 97      28    25 bis 29
## 98      30    30 bis 34
## 99      29    25 bis 29
## 100     32    30 bis 34
## 101     32    30 bis 34
## 102     30    30 bis 34
## 103     34    30 bis 34
## 104     37    35 bis 39
## 105     26    25 bis 29
## 106     32    30 bis 34
## 107     30    30 bis 34
## 108     37    35 bis 39
## 109     35    35 bis 39
## 110     29    25 bis 29
## 111     29    25 bis 29
## 112     28    25 bis 29
## 113     36    35 bis 39
## 114     31    30 bis 34
## 115     33    30 bis 34
## 116     26    25 bis 29
## 117     33    30 bis 34
## 118     33    30 bis 34
## 119     30    30 bis 34
## 120     26    25 bis 29
## 121     25    25 bis 29
## 122     27    25 bis 29
## 123     31    30 bis 34
## 124     31    30 bis 34
## 125     28    25 bis 29
## 126     36    35 bis 39
## 127     31    30 bis 34
## 128     34    30 bis 34
## 129     31    30 bis 34
## 130     34    30 bis 34
## 131     30    30 bis 34
## 132     26    25 bis 29
## 133     27    25 bis 29
## 134     33    30 bis 34
## 135     30    30 bis 34
## 136     25    25 bis 29
## 137     25    25 bis 29
## 138     24    20 bis 24
## 139     28    25 bis 29
## 140     25    25 bis 29
## 141     29    25 bis 29
## 142     24    20 bis 24
## 143     29    25 bis 29
## 144     24    20 bis 24
## 145     32    30 bis 34
## 146     28    25 bis 29
## 147     37    35 bis 39
## 148     19     unter 20
## 149     36    35 bis 39
## 150     26    25 bis 29
## 151     38    35 bis 39
## 152     25    25 bis 29
## 153     27    25 bis 29
## 154     27    25 bis 29
## 155     23    20 bis 24
## 156     25    25 bis 29
## 157     36    35 bis 39
## 158     27    25 bis 29
## 159     27    25 bis 29
## 160     35    35 bis 39
## 161     17     unter 20
## 162     32    30 bis 34
## 163     28    25 bis 29
## 164     25    25 bis 29
## 165     25    25 bis 29
## 166     24    20 bis 24
## 167     35    35 bis 39
## 168     39    35 bis 39
## 169     37    35 bis 39
## 170     19     unter 20
## 171     19     unter 20
## 172     32    30 bis 34
## 173     25    25 bis 29
## 174     29    25 bis 29
## 175     36    35 bis 39
## 176     33    30 bis 34
## 177     32    30 bis 34
## 178     40 40 und älter
## 179     36    35 bis 39
## 180     30    30 bis 34
## 181     29    25 bis 29
## 182     23    20 bis 24
## 183     24    20 bis 24
## 184     25    25 bis 29
## 185     25    25 bis 29
## 186     33    30 bis 34
## 187     26    25 bis 29
## 188     21    20 bis 24
## 189     23    20 bis 24
## 190     23    20 bis 24
## 191     34    30 bis 34
## 192     30    30 bis 34
## 193     31    30 bis 34
## 194     29    25 bis 29
## 195     31    30 bis 34
## 196     19     unter 20
## 197     32    30 bis 34
## 198     35    35 bis 39
## 199     35    35 bis 39
## 200     26    25 bis 29
## 201     27    25 bis 29
## 202     35    35 bis 39
## 203     30    30 bis 34
## 204     32    30 bis 34
## 205     21    20 bis 24
## 206     27    25 bis 29
## 207     34    30 bis 34
## 208     28    25 bis 29
## 209     31    30 bis 34
## 210     31    30 bis 34
## 211     21    20 bis 24
## 212     31    30 bis 34
## 213     31    30 bis 34
## 214     23    20 bis 24
## 215     28    25 bis 29
## 216     23    20 bis 24
## 217     26    25 bis 29
## 218     20    20 bis 24
## 219     29    25 bis 29
## 220     21    20 bis 24
## 221     25    25 bis 29
## 222     27    25 bis 29
## 223     27    25 bis 29
## 224     37    35 bis 39
## 225     31    30 bis 34
## 226     26    25 bis 29
## 227     22    20 bis 24
## 228     29    25 bis 29
## 229     21    20 bis 24
## 230     28    25 bis 29
## 231     18     unter 20
## 232     27    25 bis 29
## 233     30    30 bis 34
## 234     19     unter 20
## 235     25    25 bis 29
## 236     24    20 bis 24
## 237     29    25 bis 29
## 238     37    35 bis 39
## 239     33    30 bis 34
## 240     32    30 bis 34
## 241     31    30 bis 34
## 242     30    30 bis 34
## 243     30    30 bis 34
## 244     35    35 bis 39
## 245     30    30 bis 34
## 246     30    30 bis 34
## 247     42 40 und älter
## 248     34    30 bis 34
## 249     42 40 und älter
## 250     28    25 bis 29
## 251     26    25 bis 29
## 252     27    25 bis 29
## 253     28    25 bis 29
## 254     31    30 bis 34
## 255     32    30 bis 34
## 256     29    25 bis 29
## 257     31    30 bis 34
## 258     33    30 bis 34
## 259     25    25 bis 29
## 260     26    25 bis 29
## 261     19     unter 20
## 262     31    30 bis 34
## 263     32    30 bis 34
## 264     31    30 bis 34
## 265     21    20 bis 24
## 266     23    20 bis 24
## 267     23    20 bis 24
## 268     28    25 bis 29
## 269     37    35 bis 39
## 270     31    30 bis 34
## 271     25    25 bis 29
## 272     36    35 bis 39
## 273     28    25 bis 29
## 274     24    20 bis 24
## 275     25    25 bis 29
## 276     38    35 bis 39
## 277     32    30 bis 34
## 278     31    30 bis 34
## 279     24    20 bis 24
## 280     27    25 bis 29
## 281     28    25 bis 29
## 282     25    25 bis 29
## 283     30    30 bis 34
## 284     28    25 bis 29
## 285     28    25 bis 29
## 286     21    20 bis 24
## 287     27    25 bis 29
## 288     21    20 bis 24
## 289     33    30 bis 34
## 290     31    30 bis 34
## 291     24    20 bis 24
## 292     24    20 bis 24
## 293     31    30 bis 34
## 294     25    25 bis 29
## 295     20    20 bis 24
## 296     28    25 bis 29
## 297     41 40 und älter
## 298     30    30 bis 34
## 299     29    25 bis 29
## 300     32    30 bis 34
## 301     30    30 bis 34
## 302     26    25 bis 29
## 303     25    25 bis 29
## 304     26    25 bis 29
## 305     25    25 bis 29
## 306     30    30 bis 34
## 307     28    25 bis 29
## 308     24    20 bis 24
## 309     28    25 bis 29
## 310     31    30 bis 34
## 311     31    30 bis 34
## 312     26    25 bis 29
## 313     27    25 bis 29
## 314     24    20 bis 24
## 315     32    30 bis 34
## 316     26    25 bis 29
## 317     22    20 bis 24
## 318     29    25 bis 29
## 319     29    25 bis 29
## 320     31    30 bis 34
## 321     26    25 bis 29
## 322     25    25 bis 29
## 323     29    25 bis 29
## 324     28    25 bis 29
## 325     22    20 bis 24
## 326     31    30 bis 34
## 327     19     unter 20
## 328     25    25 bis 29
## 329     28    25 bis 29
## 330     29    25 bis 29
## 331     28    25 bis 29
## 332     28    25 bis 29
## 333     30    30 bis 34
## 334     30    30 bis 34
## 335     31    30 bis 34
## 336     21    20 bis 24
## 337     28    25 bis 29
## 338     38    35 bis 39
## 339     28    25 bis 29
## 340     25    25 bis 29
## 341     27    25 bis 29
## 342     22    20 bis 24
## 343     23    20 bis 24
## 344     29    25 bis 29
## 345     25    25 bis 29
## 346     18     unter 20
## 347     30    30 bis 34
## 348     28    25 bis 29
## 349     26    25 bis 29
## 350     33    30 bis 34
## 351     27    25 bis 29
## 352     33    30 bis 34
## 353     31    30 bis 34
## 354     30    30 bis 34
## 355     27    25 bis 29
## 356     28    25 bis 29
## 357     34    30 bis 34
## 358     34    30 bis 34
## 359     26    25 bis 29
## 360     26    25 bis 29
## 361     22    20 bis 24
## 362     29    25 bis 29
## 363     26    25 bis 29
## 364     31    30 bis 34
## 365     34    30 bis 34
## 366     33    30 bis 34
## 367     23    20 bis 24
## 368     37    35 bis 39
## 369     22    20 bis 24
## 370     22    20 bis 24
## 371     21    20 bis 24
## 372     31    30 bis 34
## 373     23    20 bis 24
## 374     34    30 bis 34
## 375     28    25 bis 29
## 376     30    30 bis 34
## 377     30    30 bis 34
## 378     34    30 bis 34
## 379     29    25 bis 29
## 380     27    25 bis 29
## 381     38    35 bis 39
## 382     27    25 bis 29
## 383     31    30 bis 34
## 384     29    25 bis 29
## 385     29    25 bis 29
## 386     31    30 bis 34
## 387     28    25 bis 29
## 388     26    25 bis 29
## 389     24    20 bis 24
## 390     25    25 bis 29
## 391     44 40 und älter
## 392     30    30 bis 34
## 393     26    25 bis 29
## 394     25    25 bis 29
## 395     27    25 bis 29
## 396     41 40 und älter
## 397     29    25 bis 29
## 398     22    20 bis 24
## 399     20    20 bis 24
## 400     38    35 bis 39
## 401     25    25 bis 29
## 402     24    20 bis 24
## 403     29    25 bis 29
## 404     22    20 bis 24
## 405     20    20 bis 24
## 406     27    25 bis 29
## 407     32    30 bis 34
## 408     27    25 bis 29
## 409     29    25 bis 29
## 410     28    25 bis 29
## 411     29    25 bis 29
## 412     27    25 bis 29
## 413     26    25 bis 29
## 414     32    30 bis 34
## 415     39    35 bis 39
## 416     23    20 bis 24
## 417     30    30 bis 34
## 418     30    30 bis 34
## 419     29    25 bis 29
## 420     27    25 bis 29
## 421     25    25 bis 29
## 422     29    25 bis 29
## 423     23    20 bis 24
## 424     27    25 bis 29
## 425     43 40 und älter
## 426     30    30 bis 34
## 427     39    35 bis 39
## 428     28    25 bis 29
## 429     22    20 bis 24
## 430     29    25 bis 29
## 431     25    25 bis 29
## 432     23    20 bis 24
## 433     29    25 bis 29
## 434     25    25 bis 29
## 435     34    30 bis 34
## 436     32    30 bis 34
## 437     24    20 bis 24
## 438     28    25 bis 29
## 439     25    25 bis 29
## 440     25    25 bis 29
## 441     32    30 bis 34
## 442     30    30 bis 34
## 443     31    30 bis 34
## 444     29    25 bis 29
## 445     29    25 bis 29
## 446     27    25 bis 29
## 447     20    20 bis 24
## 448     28    25 bis 29
## 449     33    30 bis 34
## 450     25    25 bis 29
## 451     31    30 bis 34
## 452     31    30 bis 34
## 453     32    30 bis 34
## 454     26    25 bis 29
## 455     29    25 bis 29
## 456     24    20 bis 24
## 457     28    25 bis 29
## 458     34    30 bis 34
## 459     28    25 bis 29
## 460     27    25 bis 29
## 461     33    30 bis 34
## 462     32    30 bis 34
## 463     31    30 bis 34
## 464     27    25 bis 29
## 465     35    35 bis 39
## 466     24    20 bis 24
## 467     24    20 bis 24
## 468     27    25 bis 29
## 469     23    20 bis 24
## 470     21    20 bis 24
## 471     30    30 bis 34
## 472     23    20 bis 24
## 473     28    25 bis 29
## 474     23    20 bis 24
## 475     30    30 bis 34
## 476     30    30 bis 34
## 477     29    25 bis 29
## 478     25    25 bis 29
## 479     35    35 bis 39
## 480     44 40 und älter
## 481     22    20 bis 24
## 482     32    30 bis 34
## 483     27    25 bis 29
## 484     34    30 bis 34
## 485     34    30 bis 34
## 486     30    30 bis 34
## 487     35    35 bis 39
## 488     28    25 bis 29
## 489     25    25 bis 29
## 490     25    25 bis 29
## 491     27    25 bis 29
## 492     22    20 bis 24
## 493     23    20 bis 24
## 494     37    35 bis 39
## 495     32    30 bis 34
## 496     28    25 bis 29
## 497     30    30 bis 34
## 498     22    20 bis 24
## 499     20    20 bis 24
## 500     31    30 bis 34
## 501     29    25 bis 29
## 502     33    30 bis 34
## 503     34    30 bis 34
## 504     26    25 bis 29
## 505     23    20 bis 24
## 506     31    30 bis 34
## 507     27    25 bis 29
## 508     27    25 bis 29
## 509     31    30 bis 34
## 510     25    25 bis 29
## 511     28    25 bis 29
## 512     35    35 bis 39
## 513     33    30 bis 34
## 514     25    25 bis 29
## 515     24    20 bis 24
## 516     35    35 bis 39
## 517     36    35 bis 39
## 518     34    30 bis 34
## 519     34    30 bis 34
## 520     31    30 bis 34
## 521     30    30 bis 34
## 522     31    30 bis 34
## 523     33    30 bis 34
## 524     29    25 bis 29
## 525     26    25 bis 29
## 526     36    35 bis 39
## 527     28    25 bis 29
## 528     28    25 bis 29
## 529     28    25 bis 29
## 530     34    30 bis 34
## 531     23    20 bis 24
## 532     33    30 bis 34
## 533     30    30 bis 34
## 534     22    20 bis 24
## 535     36    35 bis 39
## 536     30    30 bis 34
## 537     25    25 bis 29
## 538     31    30 bis 34
## 539     33    30 bis 34
## 540     29    25 bis 29
## 541     37    35 bis 39
## 542     32    30 bis 34
## 543     28    25 bis 29
## 544     36    35 bis 39
## 545     31    30 bis 34
## 546     31    30 bis 34
## 547     32    30 bis 34
## 548     23    20 bis 24
## 549     24    20 bis 24
## 550     30    30 bis 34
## 551     24    20 bis 24
## 552     30    30 bis 34
## 553     42 40 und älter
## 554     26    25 bis 29
## 555     24    20 bis 24
## 556     33    30 bis 34
## 557     30    30 bis 34
## 558     30    30 bis 34
## 559     25    25 bis 29
## 560     34    30 bis 34
## 561     39    35 bis 39
## 562     32    30 bis 34
## 563     28    25 bis 29
## 564     27    25 bis 29
## 565     30    30 bis 34
## 566     30    30 bis 34
## 567     23    20 bis 24
## 568     24    20 bis 24
## 569     17     unter 20
## 570     31    30 bis 34
## 571     27    25 bis 29
## 572     27    25 bis 29
## 573     23    20 bis 24
## 574     25    25 bis 29
## 575     30    30 bis 34
## 576     24    20 bis 24
## 577     28    25 bis 29
## 578     36    35 bis 39
## 579     25    25 bis 29
## 580     26    25 bis 29
## 581     32    30 bis 34
## 582     27    25 bis 29
## 583     27    25 bis 29
## 584     31    30 bis 34
## 585     40 40 und älter
## 586     29    25 bis 29
## 587     37    35 bis 39
## 588     30    30 bis 34
## 589     21    20 bis 24
## 590     25    25 bis 29
## 591     31    30 bis 34
## 592     29    25 bis 29
## 593     36    35 bis 39
## 594     35    35 bis 39
## 595     32    30 bis 34
## 596     20    20 bis 24
## 597     37    35 bis 39
## 598     31    30 bis 34
## 599     20    20 bis 24
## 600     29    25 bis 29
## 601     26    25 bis 29
## 602     29    25 bis 29
## 603     33    30 bis 34
## 604     28    25 bis 29
## 605     29    25 bis 29
## 606     29    25 bis 29
## 607     27    25 bis 29
## 608     39    35 bis 39
## 609     28    25 bis 29
## 610     25    25 bis 29
## 611     30    30 bis 34
## 612     32    30 bis 34
## 613     31    30 bis 34
## 614     26    25 bis 29
## 615     27    25 bis 29
## 616     25    25 bis 29
## 617     31    30 bis 34
## 618     36    35 bis 39
## 619     21    20 bis 24
## 620     28    25 bis 29
## 621     29    25 bis 29
## 622     28    25 bis 29
## 623     38    35 bis 39
## 624     35    35 bis 39
## 625     26    25 bis 29
## 626     32    30 bis 34
## 627     30    30 bis 34
## 628     27    25 bis 29
## 629     27    25 bis 29
## 630     33    30 bis 34
## 631     26    25 bis 29
## 632     34    30 bis 34
## 633     25    25 bis 29
## 634     31    30 bis 34
## 635     26    25 bis 29
## 636     35    35 bis 39
## 637     25    25 bis 29
## 638     26    25 bis 29
## 639     25    25 bis 29
## 640     28    25 bis 29
## 641     36    35 bis 39
## 642     23    20 bis 24
## 643     31    30 bis 34
## 644     37    35 bis 39
## 645     24    20 bis 24
## 646     28    25 bis 29
## 647     31    30 bis 34
## 648     36    35 bis 39
## 649     36    35 bis 39
## 650     29    25 bis 29
## 651     26    25 bis 29
## 652     22    20 bis 24
## 653     23    20 bis 24
## 654     26    25 bis 29
## 655     25    25 bis 29
## 656     28    25 bis 29
## 657     26    25 bis 29
## 658     30    30 bis 34
## 659     21    20 bis 24
## 660     27    25 bis 29
## 661     24    20 bis 24
## 662     27    25 bis 29
## 663     36    35 bis 39
## 664     33    30 bis 34
## 665     31    30 bis 34
## 666     35    35 bis 39
## 667     38    35 bis 39
## 668     31    30 bis 34
## 669     33    30 bis 34
## 670     30    30 bis 34
## 671     23    20 bis 24
## 672     28    25 bis 29
## 673     35    35 bis 39
## 674     21    20 bis 24
## 675     33    30 bis 34
## 676     40 40 und älter
## 677     29    25 bis 29
## 678     25    25 bis 29
## 679     31    30 bis 34
## 680     23    20 bis 24
## 681     26    25 bis 29
## 682     24    20 bis 24
## 683     28    25 bis 29
## 684     30    30 bis 34
## 685     23    20 bis 24
## 686     28    25 bis 29
## 687     32    30 bis 34
## 688     26    25 bis 29
## 689     35    35 bis 39
## 690     29    25 bis 29
## 691     26    25 bis 29
## 692     30    30 bis 34
## 693     20    20 bis 24
## 694     34    30 bis 34
## 695     30    30 bis 34
## 696     30    30 bis 34
## 697     36    35 bis 39
## 698     25    25 bis 29
## 699     28    25 bis 29
## 700     40 40 und älter
## 701     30    30 bis 34
## 702     32    30 bis 34
## 703     27    25 bis 29
## 704     24    20 bis 24
## 705     23    20 bis 24
## 706     31    30 bis 34
## 707     32    30 bis 34
## 708     33    30 bis 34
## 709     30    30 bis 34
## 710     29    25 bis 29
## 711     29    25 bis 29
## 712     35    35 bis 39
## 713     23    20 bis 24
## 714     30    30 bis 34
## 715     30    30 bis 34
## 716     29    25 bis 29
## 717     29    25 bis 29
## 718     29    25 bis 29
## 719     26    25 bis 29
## 720     20    20 bis 24
## 721     28    25 bis 29
## 722     29    25 bis 29
## 723     26    25 bis 29
## 724     31    30 bis 34
## 725     39    35 bis 39
## 726     28    25 bis 29
## 727     28    25 bis 29
## 728     28    25 bis 29
## 729     30    30 bis 34
## 730     25    25 bis 29
## 731     27    25 bis 29
## 732     35    35 bis 39
## 733     28    25 bis 29
## 734     29    25 bis 29
## 735     26    25 bis 29
## 736     27    25 bis 29
## 737     28    25 bis 29
## 738     26    25 bis 29
## 739     33    30 bis 34
## 740     20    20 bis 24
## 741     25    25 bis 29
## 742     23    20 bis 24
## 743     29    25 bis 29
## 744     32    30 bis 34
## 745     23    20 bis 24
## 746     31    30 bis 34
## 747     27    25 bis 29
## 748     25    25 bis 29
## 749     28    25 bis 29
## 750     24    20 bis 24
## 751     35    35 bis 39
## 752     29    25 bis 29
## 753     23    20 bis 24
## 754     27    25 bis 29
## 755     25    25 bis 29
## 756     33    30 bis 34
## 757     27    25 bis 29
## 758     28    25 bis 29
## 759     29    25 bis 29
## 760     26    25 bis 29
## 761     26    25 bis 29
## 762     33    30 bis 34
## 763     32    30 bis 34
## 764     30    30 bis 34
## 765     26    25 bis 29
## 766     26    25 bis 29
## 767     31    30 bis 34
## 768     28    25 bis 29
## 769     30    30 bis 34
## 770     27    25 bis 29
## 771     22    20 bis 24
## 772     32    30 bis 34
## 773     29    25 bis 29
## 774     30    30 bis 34
## 775     25    25 bis 29
## 776     29    25 bis 29
## 777     28    25 bis 29
## 778     29    25 bis 29
## 779     36    35 bis 39
## 780     31    30 bis 34
## 781     35    35 bis 39
## 782     29    25 bis 29
## 783     26    25 bis 29
## 784     33    30 bis 34
## 785     27    25 bis 29
## 786     22    20 bis 24
## 787     28    25 bis 29
## 788     31    30 bis 34
## 789     31    30 bis 34
## 790     38    35 bis 39
## 791     28    25 bis 29
## 792     28    25 bis 29
## 793     27    25 bis 29
## 794     29    25 bis 29
## 795     21    20 bis 24
## 796     NA    unbekannt
## 797     NA    unbekannt
## 798     NA    unbekannt
## 799     NA    unbekannt
## 800     NA    unbekannt
## 801     NA    unbekannt
## 802     NA    unbekannt
## 803     NA    unbekannt
## 804     NA    unbekannt
## 805     NA    unbekannt
## 806     NA    unbekannt
## 807     NA    unbekannt
## 808     NA    unbekannt
## 809     NA    unbekannt
## 810     NA    unbekannt
## 811     NA    unbekannt
## 812     NA    unbekannt
## 813     NA    unbekannt
## 814     NA    unbekannt
## 815     NA    unbekannt
## 816     NA    unbekannt
## 817     NA    unbekannt
## 818     NA    unbekannt
## 819     NA    unbekannt
## 820     NA    unbekannt
## 821     NA    unbekannt
## 822     NA    unbekannt
## 823     NA    unbekannt
## 824     NA    unbekannt
## 825     NA    unbekannt
## 826     NA    unbekannt
## 827     NA    unbekannt
## 828     NA    unbekannt
## 829     NA    unbekannt
## 830     NA    unbekannt
## 831     NA    unbekannt
## 832     NA    unbekannt
## 833     NA    unbekannt
## 834     NA    unbekannt
## 835     NA    unbekannt
## 836     NA    unbekannt
## 837     NA    unbekannt
## 838     NA    unbekannt
## 839     NA    unbekannt
## 840     NA    unbekannt
## 841     NA    unbekannt
## 842     NA    unbekannt
## 843     NA    unbekannt
## 844     NA    unbekannt
## 845     NA    unbekannt
## 846     NA    unbekannt
## 847     NA    unbekannt
## 848     NA    unbekannt
## 849     NA    unbekannt
## 850     NA    unbekannt
## 851     NA    unbekannt
## 852     NA    unbekannt
## 853     NA    unbekannt
## 854     NA    unbekannt
## 855     NA    unbekannt
## 856     NA    unbekannt
## 857     NA    unbekannt
## 858     NA    unbekannt
## 859     NA    unbekannt
## 860     NA    unbekannt
## 861     NA    unbekannt
## 862     NA    unbekannt
## 863     NA    unbekannt
## 864     NA    unbekannt
## 865     NA    unbekannt
## 866     NA    unbekannt
## 867     NA    unbekannt
## 868     NA    unbekannt
## 869     NA    unbekannt
## 870     NA    unbekannt
## 871     NA    unbekannt
## 872     NA    unbekannt
## 873     NA    unbekannt
## 874     NA    unbekannt
## 875     NA    unbekannt
## 876     NA    unbekannt
## 877     NA    unbekannt
## 878     NA    unbekannt
## 879     NA    unbekannt
## 880     NA    unbekannt
## 881     NA    unbekannt
## 882     NA    unbekannt
## 883     NA    unbekannt
## 884     NA    unbekannt
## 885     NA    unbekannt
## 886     NA    unbekannt
## 887     NA    unbekannt
## 888     NA    unbekannt
## 889     NA    unbekannt
## 890     NA    unbekannt
## 891     NA    unbekannt
## 892     NA    unbekannt
## 893     NA    unbekannt
## 894     NA    unbekannt
## 895     NA    unbekannt
## 896     NA    unbekannt
## 897     NA    unbekannt
## 898     NA    unbekannt
## 899     NA    unbekannt
## 900     NA    unbekannt
## 901     NA    unbekannt
## 902     NA    unbekannt
## 903     NA    unbekannt
## 904     NA    unbekannt
## 905     NA    unbekannt
## 906     NA    unbekannt
## 907     NA    unbekannt
## 908     NA    unbekannt
## 909     NA    unbekannt
## 910     NA    unbekannt
## 911     NA    unbekannt
## 912     NA    unbekannt
## 913     NA    unbekannt
## 914     NA    unbekannt
## 915     NA    unbekannt
## 916     NA    unbekannt
## 917     NA    unbekannt
## 918     NA    unbekannt
## 919     NA    unbekannt
## 920     NA    unbekannt
## 921     NA    unbekannt
## 922     NA    unbekannt
## 923     NA    unbekannt
## 924     NA    unbekannt
## 925     NA    unbekannt
## 926     NA    unbekannt
## 927     NA    unbekannt
## 928     NA    unbekannt
## 929     NA    unbekannt
## 930     NA    unbekannt
## 931     NA    unbekannt
## 932     NA    unbekannt
## 933     NA    unbekannt
## 934     NA    unbekannt
## 935     NA    unbekannt
## 936     NA    unbekannt
## 937     NA    unbekannt
## 938     NA    unbekannt
## 939     NA    unbekannt
## 940     NA    unbekannt
## 941     NA    unbekannt
## 942     NA    unbekannt
## 943     NA    unbekannt
## 944     NA    unbekannt
## 945     NA    unbekannt
## 946     NA    unbekannt
## 947     NA    unbekannt
## 948     NA    unbekannt
## 949     NA    unbekannt
## 950     NA    unbekannt
## 951     NA    unbekannt
## 952     NA    unbekannt
## 953     NA    unbekannt
## 954     NA    unbekannt
## 955     NA    unbekannt
## 956     NA    unbekannt
## 957     NA    unbekannt
## 958     NA    unbekannt
## 959     NA    unbekannt
## 960     NA    unbekannt
## 961     NA    unbekannt
## 962     NA    unbekannt
## 963     NA    unbekannt
## 964     NA    unbekannt
## 965     NA    unbekannt
## 966     NA    unbekannt
## 967     NA    unbekannt
## 968     NA    unbekannt
## 969     NA    unbekannt
## 970     NA    unbekannt
## 971     NA    unbekannt
## 972     NA    unbekannt
## 973     NA    unbekannt
## 974     NA    unbekannt
## 975     NA    unbekannt
## 976     NA    unbekannt
## 977     NA    unbekannt
## 978     NA    unbekannt
## 979     NA    unbekannt
## 980     NA    unbekannt
## 981     NA    unbekannt
## 982     NA    unbekannt
## 983     NA    unbekannt
## 984     NA    unbekannt
## 985     NA    unbekannt
## 986     NA    unbekannt
## 987     NA    unbekannt
## 988     NA    unbekannt
## 989     NA    unbekannt
## 990     NA    unbekannt
## 991     NA    unbekannt
## 992     NA    unbekannt
## 993     NA    unbekannt
## 994     NA    unbekannt
## 995     NA    unbekannt
## 996     NA    unbekannt
## 997     NA    unbekannt
## 998     NA    unbekannt
## 999     NA    unbekannt
## 1000    NA    unbekannt
## 1001    NA    unbekannt
## 1002    NA    unbekannt
## 1003    NA    unbekannt
## 1004    NA    unbekannt
## 1005    NA    unbekannt
## 1006    NA    unbekannt
## 1007    NA    unbekannt
## 1008    NA    unbekannt
## 1009    NA    unbekannt
## 1010    NA    unbekannt
## 1011    NA    unbekannt
## 1012    NA    unbekannt
## 1013    NA    unbekannt
## 1014    NA    unbekannt
## 1015    NA    unbekannt
## 1016    NA    unbekannt
## 1017    NA    unbekannt
## 1018    NA    unbekannt
## 1019    NA    unbekannt
## 1020    NA    unbekannt
## 1021    NA    unbekannt
## 1022    NA    unbekannt
## 1023    NA    unbekannt
## 1024    NA    unbekannt
## 1025    NA    unbekannt
## 1026    NA    unbekannt
## 1027    NA    unbekannt
## 1028    NA    unbekannt
## 1029    NA    unbekannt
## 1030    NA    unbekannt
## 1031    NA    unbekannt
## 1032    NA    unbekannt
## 1033    NA    unbekannt
## 1034    NA    unbekannt
## 1035    NA    unbekannt
## 1036    NA    unbekannt
## 1037    NA    unbekannt
## 1038    NA    unbekannt
## 1039    NA    unbekannt
## 1040    NA    unbekannt
## 1041    NA    unbekannt
## 1042    NA    unbekannt
## 1043    NA    unbekannt
## 1044    NA    unbekannt
## 1045    NA    unbekannt
## 1046    NA    unbekannt
## 1047    NA    unbekannt
## 1048    NA    unbekannt
## 1049    NA    unbekannt
## 1050    NA    unbekannt
## 1051    NA    unbekannt
## 1052    NA    unbekannt
## 1053    NA    unbekannt
## 1054    NA    unbekannt
## 1055    NA    unbekannt
## 1056    NA    unbekannt
## 1057    NA    unbekannt
## 1058    NA    unbekannt
## 1059    NA    unbekannt
## 1060    NA    unbekannt
## 1061    NA    unbekannt
## 1062    NA    unbekannt
## 1063    NA    unbekannt
## 1064    NA    unbekannt
## 1065    NA    unbekannt
## 1066    NA    unbekannt
## 1067    NA    unbekannt
## 1068    NA    unbekannt
## 1069    NA    unbekannt
## 1070    NA    unbekannt
## 1071    NA    unbekannt
## 1072    NA    unbekannt
## 1073    NA    unbekannt
## 1074    NA    unbekannt
## 1075    NA    unbekannt
## 1076    NA    unbekannt
## 1077    NA    unbekannt
## 1078    NA    unbekannt
## 1079    NA    unbekannt
## 1080    NA    unbekannt
## 1081    NA    unbekannt
## 1082    NA    unbekannt
## 1083    NA    unbekannt
## 1084    NA    unbekannt
## 1085    NA    unbekannt
## 1086    NA    unbekannt
## 1087    NA    unbekannt
## 1088    NA    unbekannt
## 1089    NA    unbekannt
## 1090    NA    unbekannt
## 1091    NA    unbekannt
## 1092    NA    unbekannt
## 1093    NA    unbekannt
## 1094    NA    unbekannt
## 1095    NA    unbekannt
## 1096    NA    unbekannt
## 1097    NA    unbekannt
## 1098    NA    unbekannt
## 1099    NA    unbekannt
## 1100    NA    unbekannt
## 1101    NA    unbekannt
## 1102    NA    unbekannt
## 1103    NA    unbekannt
## 1104    NA    unbekannt
## 1105    NA    unbekannt
## 1106    NA    unbekannt
## 1107    NA    unbekannt
## 1108    NA    unbekannt
## 1109    NA    unbekannt
## 1110    NA    unbekannt
## 1111    NA    unbekannt
## 1112    NA    unbekannt
## 1113    NA    unbekannt
## 1114    NA    unbekannt
## 1115    NA    unbekannt
## 1116    NA    unbekannt
## 1117    NA    unbekannt
## 1118    NA    unbekannt
## 1119    NA    unbekannt
## 1120    NA    unbekannt
## 1121    NA    unbekannt
## 1122    NA    unbekannt
## 1123    NA    unbekannt
## 1124    NA    unbekannt
## 1125    NA    unbekannt
## 1126    NA    unbekannt
## 1127    NA    unbekannt
## 1128    NA    unbekannt
## 1129    NA    unbekannt
## 1130    NA    unbekannt
## 1131    NA    unbekannt
## 1132    NA    unbekannt
## 1133    NA    unbekannt
## 1134    NA    unbekannt
## 1135    NA    unbekannt
## 1136    NA    unbekannt
## 1137    NA    unbekannt
## 1138    NA    unbekannt
## 1139    NA    unbekannt
## 1140    NA    unbekannt
## 1141    NA    unbekannt
## 1142    NA    unbekannt
## 1143    NA    unbekannt
## 1144    NA    unbekannt
## 1145    NA    unbekannt
## 1146    NA    unbekannt
## 1147    NA    unbekannt
## 1148    NA    unbekannt
## 1149    NA    unbekannt
## 1150    NA    unbekannt
## 1151    NA    unbekannt
## 1152    NA    unbekannt
## 1153    NA    unbekannt
## 1154    NA    unbekannt
## 1155    NA    unbekannt
## 1156    NA    unbekannt
## 1157    NA    unbekannt
## 1158    NA    unbekannt
## 1159    NA    unbekannt
## 1160    NA    unbekannt
## 1161    NA    unbekannt
## 1162    NA    unbekannt
## 1163    NA    unbekannt
## 1164    NA    unbekannt
## 1165    NA    unbekannt
## 1166    NA    unbekannt
## 1167    NA    unbekannt
## 1168    NA    unbekannt
## 1169    NA    unbekannt
## 1170    NA    unbekannt
## 1171    NA    unbekannt
## 1172    NA    unbekannt
## 1173    NA    unbekannt
## 1174    NA    unbekannt
## 1175    NA    unbekannt
## 1176    NA    unbekannt
## 1177    NA    unbekannt
## 1178    NA    unbekannt
## 1179    NA    unbekannt
## 1180    NA    unbekannt
## 1181    NA    unbekannt
## 1182    NA    unbekannt
## 1183    NA    unbekannt
## 1184    NA    unbekannt
## 1185    NA    unbekannt
## 1186    NA    unbekannt
## 1187    NA    unbekannt
## 1188    NA    unbekannt
## 1189    NA    unbekannt
## 1190    NA    unbekannt
## 1191    NA    unbekannt
## 1192    NA    unbekannt
## 1193    NA    unbekannt
## 1194    NA    unbekannt
## 1195    NA    unbekannt
## 1196    NA    unbekannt
## 1197    NA    unbekannt
## 1198    NA    unbekannt
## 1199    NA    unbekannt
## 1200    NA    unbekannt
## 1201    NA    unbekannt
## 1202    NA    unbekannt
## 1203    NA    unbekannt
## 1204    NA    unbekannt
## 1205    NA    unbekannt
## 1206    NA    unbekannt
## 1207    NA    unbekannt
## 1208    NA    unbekannt
## 1209    NA    unbekannt
## 1210    NA    unbekannt
## 1211    NA    unbekannt
## 1212    NA    unbekannt
## 1213    NA    unbekannt
## 1214    NA    unbekannt
## 1215    NA    unbekannt
## 1216    NA    unbekannt
## 1217    NA    unbekannt
## 1218    NA    unbekannt
## 1219    NA    unbekannt
## 1220    NA    unbekannt
## 1221    NA    unbekannt
## 1222    NA    unbekannt
## 1223    NA    unbekannt
## 1224    NA    unbekannt
## 1225    NA    unbekannt
## 1226    NA    unbekannt
## 1227    NA    unbekannt
## 1228    NA    unbekannt
## 1229    NA    unbekannt
## 1230    NA    unbekannt
## 1231    NA    unbekannt
## 1232    NA    unbekannt
## 1233    NA    unbekannt
## 1234    NA    unbekannt
## 1235    NA    unbekannt
## 1236    NA    unbekannt
## 1237    NA    unbekannt
## 1238    NA    unbekannt
## 1239    NA    unbekannt
## 1240    NA    unbekannt
## 1241    NA    unbekannt
## 1242    NA    unbekannt
## 1243    NA    unbekannt
## 1244    NA    unbekannt
## 1245    NA    unbekannt
## 1246    NA    unbekannt
## 1247    NA    unbekannt
## 1248    NA    unbekannt
## 1249    NA    unbekannt
## 1250    NA    unbekannt
## 1251    NA    unbekannt
## 1252    NA    unbekannt
## 1253    NA    unbekannt
## 1254    NA    unbekannt
## 1255    NA    unbekannt
## 1256    NA    unbekannt
## 1257    NA    unbekannt
## 1258    NA    unbekannt
## 1259    NA    unbekannt
## 1260    NA    unbekannt
## 1261    NA    unbekannt
## 1262    NA    unbekannt
## 1263    NA    unbekannt
## 1264    NA    unbekannt
## 1265    NA    unbekannt
## 1266    NA    unbekannt
## 1267    NA    unbekannt
## 1268    NA    unbekannt
## 1269    NA    unbekannt
## 1270    NA    unbekannt
## 1271    NA    unbekannt
## 1272    NA    unbekannt
## 1273    NA    unbekannt
## 1274    NA    unbekannt
## 1275    NA    unbekannt
## 1276    NA    unbekannt
## 1277    NA    unbekannt
## 1278    NA    unbekannt
## 1279    NA    unbekannt
## 1280    NA    unbekannt
## 1281    NA    unbekannt
## 1282    NA    unbekannt
## 1283    NA    unbekannt
## 1284    NA    unbekannt
## 1285    NA    unbekannt
## 1286    NA    unbekannt
## 1287    NA    unbekannt
## 1288    NA    unbekannt
## 1289    NA    unbekannt
## 1290    NA    unbekannt
## 1291    NA    unbekannt
## 1292    NA    unbekannt
## 1293    NA    unbekannt
## 1294    NA    unbekannt
## 1295    NA    unbekannt
## 1296    NA    unbekannt
## 1297    NA    unbekannt
## 1298    NA    unbekannt
## 1299    NA    unbekannt
## 1300    NA    unbekannt
## 1301    NA    unbekannt
## 1302    NA    unbekannt
## 1303    NA    unbekannt
## 1304    NA    unbekannt
## 1305    NA    unbekannt
## 1306    NA    unbekannt
## 1307    NA    unbekannt
## 1308    NA    unbekannt
## 1309    NA    unbekannt
## 1310    NA    unbekannt
## 1311    NA    unbekannt
## 1312    NA    unbekannt
## 1313    NA    unbekannt
## 1314    NA    unbekannt
## 1315    NA    unbekannt
## 1316    NA    unbekannt
## 1317    NA    unbekannt
## 1318    NA    unbekannt
## 1319    NA    unbekannt
## 1320    NA    unbekannt
## 1321    NA    unbekannt
## 1322    NA    unbekannt
## 1323    NA    unbekannt
## 1324    NA    unbekannt
## 1325    NA    unbekannt
## 1326    NA    unbekannt
## 1327    NA    unbekannt
## 1328    NA    unbekannt
## 1329    NA    unbekannt
## 1330    NA    unbekannt
## 1331    NA    unbekannt
## 1332    NA    unbekannt
## 1333    NA    unbekannt
## 1334    NA    unbekannt
## 1335    NA    unbekannt
## 1336    NA    unbekannt
## 1337    NA    unbekannt
## 1338    NA    unbekannt
## 1339    NA    unbekannt
## 1340    NA    unbekannt
## 1341    NA    unbekannt
## 1342    NA    unbekannt
## 1343    NA    unbekannt
## 1344    NA    unbekannt
## 1345    NA    unbekannt
## 1346    NA    unbekannt
## 1347    NA    unbekannt
## 1348    NA    unbekannt
## 1349    NA    unbekannt
## 1350    NA    unbekannt
## 1351    NA    unbekannt
## 1352    NA    unbekannt
## 1353    NA    unbekannt
## 1354    NA    unbekannt
## 1355    NA    unbekannt
## 1356    NA    unbekannt
## 1357    NA    unbekannt
## 1358    NA    unbekannt
## 1359    NA    unbekannt
## 1360    NA    unbekannt
## 1361    NA    unbekannt
## 1362    NA    unbekannt
## 1363    NA    unbekannt
## 1364    NA    unbekannt
## 1365    NA    unbekannt
## 1366    NA    unbekannt
## 1367    NA    unbekannt
## 1368    NA    unbekannt
## 1369    NA    unbekannt
## 1370    NA    unbekannt
## 1371    NA    unbekannt
## 1372    NA    unbekannt
## 1373    NA    unbekannt
## 1374    NA    unbekannt
## 1375    NA    unbekannt
## 1376    NA    unbekannt
## 1377    NA    unbekannt
## 1378    NA    unbekannt
## 1379    NA    unbekannt
## 1380    NA    unbekannt
## 1381    NA    unbekannt
## 1382    NA    unbekannt
## 1383    NA    unbekannt
## 1384    NA    unbekannt
## 1385    NA    unbekannt
## 1386    NA    unbekannt
## 1387    NA    unbekannt
## 1388    NA    unbekannt
## 1389    NA    unbekannt
## 1390    NA    unbekannt
## 1391    NA    unbekannt
## 1392    NA    unbekannt
## 1393    NA    unbekannt
## 1394    NA    unbekannt
## 1395    NA    unbekannt
## 1396    NA    unbekannt
## 1397    NA    unbekannt
## 1398    NA    unbekannt
## 1399    NA    unbekannt
## 1400    NA    unbekannt
## 1401    NA    unbekannt
## 1402    NA    unbekannt
## 1403    NA    unbekannt
## 1404    NA    unbekannt
## 1405    NA    unbekannt
## 1406    NA    unbekannt
## 1407    NA    unbekannt
## 1408    NA    unbekannt
## 1409    NA    unbekannt
## 1410    NA    unbekannt
## 1411    NA    unbekannt
## 1412    NA    unbekannt
## 1413    NA    unbekannt
## 1414    NA    unbekannt
## 1415    NA    unbekannt
## 1416    NA    unbekannt
## 1417    NA    unbekannt
## 1418    NA    unbekannt
## 1419    NA    unbekannt
## 1420    NA    unbekannt
## 1421    NA    unbekannt
## 1422    NA    unbekannt
## 1423    NA    unbekannt
## 1424    NA    unbekannt
## 1425    NA    unbekannt
## 1426    NA    unbekannt
## 1427    NA    unbekannt
## 1428    NA    unbekannt
## 1429    NA    unbekannt
## 1430    NA    unbekannt
## 1431    NA    unbekannt
## 1432    NA    unbekannt
## 1433    NA    unbekannt
## 1434    NA    unbekannt
## 1435    NA    unbekannt
## 1436    NA    unbekannt
## 1437    NA    unbekannt
## 1438    NA    unbekannt
## 1439    NA    unbekannt
## 1440    NA    unbekannt
## 1441    NA    unbekannt
## 1442    NA    unbekannt
## 1443    NA    unbekannt
## 1444    NA    unbekannt
## 1445    NA    unbekannt
## 1446    NA    unbekannt
## 1447    NA    unbekannt
## 1448    NA    unbekannt
## 1449    NA    unbekannt
## 1450    NA    unbekannt
## 1451    NA    unbekannt
## 1452    NA    unbekannt
## 1453    NA    unbekannt
## 1454    NA    unbekannt
## 1455    NA    unbekannt
## 1456    NA    unbekannt
## 1457    NA    unbekannt
## 1458    NA    unbekannt
## 1459    NA    unbekannt
## 1460    NA    unbekannt
## 1461    NA    unbekannt
## 1462    NA    unbekannt
## 1463    NA    unbekannt
## 1464    NA    unbekannt
## 1465    NA    unbekannt
## 1466    NA    unbekannt
## 1467    NA    unbekannt
## 1468    NA    unbekannt
## 1469    NA    unbekannt
## 1470    NA    unbekannt
## 1471    NA    unbekannt
## 1472    NA    unbekannt
## 1473    NA    unbekannt
## 1474    NA    unbekannt
## 1475    NA    unbekannt
## 1476    NA    unbekannt
## 1477    NA    unbekannt
## 1478    NA    unbekannt
## 1479    NA    unbekannt
## 1480    NA    unbekannt
## 1481    NA    unbekannt
## 1482    NA    unbekannt
## 1483    NA    unbekannt
## 1484    NA    unbekannt
## 1485    NA    unbekannt
## 1486    NA    unbekannt
## 1487    NA    unbekannt
## 1488    NA    unbekannt
## 1489    NA    unbekannt
## 1490    NA    unbekannt
## 1491    NA    unbekannt
## 1492    NA    unbekannt
## 1493    NA    unbekannt
## 1494    NA    unbekannt
## 1495    NA    unbekannt
## 1496    NA    unbekannt
## 1497    NA    unbekannt
## 1498    NA    unbekannt
## 1499    NA    unbekannt
## 1500    NA    unbekannt
## 1501    NA    unbekannt
## 1502    NA    unbekannt
## 1503    NA    unbekannt
## 1504    NA    unbekannt
## 1505    NA    unbekannt
## 1506    NA    unbekannt
## 1507    NA    unbekannt
## 1508    NA    unbekannt
## 1509    NA    unbekannt
## 1510    NA    unbekannt
## 1511    NA    unbekannt
## 1512    NA    unbekannt
## 1513    NA    unbekannt
## 1514    NA    unbekannt
## 1515    NA    unbekannt
## 1516    NA    unbekannt
## 1517    NA    unbekannt
## 1518    NA    unbekannt
## 1519    NA    unbekannt
## 1520    NA    unbekannt
## 1521    NA    unbekannt
## 1522    NA    unbekannt
## 1523    NA    unbekannt
## 1524    NA    unbekannt
## 1525    NA    unbekannt
## 1526    NA    unbekannt
## 1527    NA    unbekannt
## 1528    NA    unbekannt
## 1529    NA    unbekannt
## 1530    NA    unbekannt
## 1531    NA    unbekannt
## 1532    NA    unbekannt
## 1533    NA    unbekannt
## 1534    NA    unbekannt
## 1535    NA    unbekannt
## 1536    NA    unbekannt
## 1537    NA    unbekannt
## 1538    NA    unbekannt
## 1539    NA    unbekannt
## 1540    NA    unbekannt
## 1541    NA    unbekannt
## 1542    NA    unbekannt
## 1543    NA    unbekannt
## 1544    NA    unbekannt
## 1545    NA    unbekannt
## 1546    NA    unbekannt
## 1547    NA    unbekannt
## 1548    NA    unbekannt
## 1549    NA    unbekannt
## 1550    NA    unbekannt
## 1551    NA    unbekannt
## 1552    NA    unbekannt
## 1553    NA    unbekannt
## 1554    NA    unbekannt
## 1555    NA    unbekannt
## 1556    NA    unbekannt
## 1557    NA    unbekannt
## 1558    NA    unbekannt
## 1559    NA    unbekannt
## 1560    NA    unbekannt
## 1561    NA    unbekannt
## 1562    NA    unbekannt
## 1563    NA    unbekannt
## 1564    NA    unbekannt
## 1565    NA    unbekannt
## 1566    NA    unbekannt
## 1567    NA    unbekannt
## 1568    NA    unbekannt
## 1569    NA    unbekannt
## 1570    NA    unbekannt
## 1571    NA    unbekannt
## 1572    NA    unbekannt
## 1573    NA    unbekannt
## 1574    NA    unbekannt
## 1575    NA    unbekannt
## 1576    NA    unbekannt
## 1577    NA    unbekannt
## 1578    NA    unbekannt
## 1579    NA    unbekannt
## 1580    NA    unbekannt
## 1581    NA    unbekannt
## 1582    NA    unbekannt
## 1583    NA    unbekannt
## 1584    NA    unbekannt
## 1585    NA    unbekannt
## 1586    NA    unbekannt
## 1587    NA    unbekannt
## 1588    NA    unbekannt
## 1589    NA    unbekannt
## 1590    NA    unbekannt
## 1591    NA    unbekannt
## 1592    NA    unbekannt
## 1593    NA    unbekannt
## 1594    NA    unbekannt
## 1595    NA    unbekannt
## 1596    NA    unbekannt
## 1597    NA    unbekannt
## 1598    NA    unbekannt
## 1599    NA    unbekannt
## 1600    NA    unbekannt
## 1601    NA    unbekannt
## 1602    NA    unbekannt
## 1603    NA    unbekannt
## 1604    NA    unbekannt
## 1605    NA    unbekannt
## 1606    NA    unbekannt
## 1607    NA    unbekannt
## 1608    NA    unbekannt
## 1609    NA    unbekannt
## 1610    NA    unbekannt
## 1611    NA    unbekannt
## 1612    NA    unbekannt
## 1613    NA    unbekannt
## 1614    NA    unbekannt
## 1615    NA    unbekannt
## 1616    NA    unbekannt
## 1617    NA    unbekannt
## 1618    NA    unbekannt
## 1619    NA    unbekannt
## 1620    NA    unbekannt
## 1621    NA    unbekannt
## 1622    NA    unbekannt
## 1623    NA    unbekannt
## 1624    NA    unbekannt
## 1625    NA    unbekannt
## 1626    NA    unbekannt
## 1627    NA    unbekannt
## 1628    NA    unbekannt
## 1629    NA    unbekannt
## 1630    NA    unbekannt
## 1631    NA    unbekannt
## 1632    NA    unbekannt
## 1633    NA    unbekannt
## 1634    NA    unbekannt
## 1635    NA    unbekannt
## 1636    NA    unbekannt
## 1637    NA    unbekannt
## 1638    NA    unbekannt
## 1639    NA    unbekannt
## 1640    NA    unbekannt
## 1641    NA    unbekannt
## 1642    NA    unbekannt
## 1643    NA    unbekannt
## 1644    NA    unbekannt
## 1645    NA    unbekannt
## 1646    NA    unbekannt
## 1647    NA    unbekannt
## 1648    NA    unbekannt
## 1649    NA    unbekannt
## 1650    NA    unbekannt
## 1651    NA    unbekannt
## 1652    NA    unbekannt
## 1653    NA    unbekannt
## 1654    NA    unbekannt
## 1655    NA    unbekannt
## 1656    NA    unbekannt
## 1657    NA    unbekannt
## 1658    NA    unbekannt
## 1659    NA    unbekannt
## 1660    NA    unbekannt
## 1661    NA    unbekannt
## 1662    NA    unbekannt
## 1663    NA    unbekannt
## 1664    NA    unbekannt
## 1665    NA    unbekannt
## 1666    NA    unbekannt
## 1667    NA    unbekannt
## 1668    NA    unbekannt
## 1669    NA    unbekannt
## 1670    NA    unbekannt
## 1671    NA    unbekannt
## 1672    NA    unbekannt
## 1673    NA    unbekannt
## 1674    NA    unbekannt
## 1675    NA    unbekannt
## 1676    NA    unbekannt
## 1677    NA    unbekannt
## 1678    NA    unbekannt
## 1679    NA    unbekannt
## 1680    NA    unbekannt
## 1681    NA    unbekannt
## 1682    NA    unbekannt
## 1683    NA    unbekannt
## 1684    NA    unbekannt
## 1685    NA    unbekannt
## 1686    NA    unbekannt
## 1687    NA    unbekannt
## 1688    NA    unbekannt
## 1689    NA    unbekannt
## 1690    22    20 bis 24
## 1691    33    30 bis 34
## 1692    29    25 bis 29
## 1693    34    30 bis 34
## 1694    33    30 bis 34
## 1695    31    30 bis 34
## 1696    25    25 bis 29
## 1697    27    25 bis 29
## 1698    43 40 und älter
## 1699    41 40 und älter
## 1700    35    35 bis 39
## 1701    31    30 bis 34
## 1702    32    30 bis 34
## 1703    29    25 bis 29
## 1704    31    30 bis 34
## 1705    31    30 bis 34
## 1706    31    30 bis 34
## 1707    26    25 bis 29
## 1708    33    30 bis 34
## 1709    28    25 bis 29
## 1710    27    25 bis 29
## 1711    34    30 bis 34
## 1712    30    30 bis 34
## 1713    26    25 bis 29
## 1714    26    25 bis 29
## 1715    28    25 bis 29
## 1716    28    25 bis 29
## 1717    33    30 bis 34
## 1718    29    25 bis 29
## 1719    33    30 bis 34
## 1720    28    25 bis 29
## 1721    32    30 bis 34
## 1722    33    30 bis 34
## 1723    36    35 bis 39
## 1724    28    25 bis 29
## 1725    36    35 bis 39
## 1726    33    30 bis 34
## 1727    29    25 bis 29
## 1728    24    20 bis 24
## 1729    32    30 bis 34
## 1730    37    35 bis 39
## 1731    30    30 bis 34
## 1732    33    30 bis 34
## 1733    24    20 bis 24
## 1734    31    30 bis 34
## 1735    35    35 bis 39
## 1736    24    20 bis 24
## 1737    36    35 bis 39
## 1738    31    30 bis 34
## 1739    38    35 bis 39
## 1740    28    25 bis 29
## 1741    30    30 bis 34
## 1742    27    25 bis 29
## 1743    32    30 bis 34
## 1744    34    30 bis 34
## 1745    26    25 bis 29
## 1746    35    35 bis 39
## 1747    27    25 bis 29
## 1748    36    35 bis 39
## 1749    34    30 bis 34
## 1750    28    25 bis 29
## 1751    35    35 bis 39
## 1752    30    30 bis 34
## 1753    33    30 bis 34
## 1754    34    30 bis 34
## 1755    38    35 bis 39
## 1756    29    25 bis 29
## 1757    29    25 bis 29
## 1758    33    30 bis 34
## 1759    22    20 bis 24
## 1760    16     unter 20
## 1761    31    30 bis 34
## 1762    29    25 bis 29
## 1763    24    20 bis 24
## 1764    29    25 bis 29
## 1765    27    25 bis 29
## 1766    27    25 bis 29
## 1767    35    35 bis 39
## 1768    33    30 bis 34
## 1769    27    25 bis 29
## 1770    33    30 bis 34
## 1771    29    25 bis 29
## 1772    34    30 bis 34
## 1773    40 40 und älter
## 1774    33    30 bis 34
## 1775    24    20 bis 24
## 1776    27    25 bis 29
## 1777    23    20 bis 24
## 1778    31    30 bis 34
## 1779    21    20 bis 24
## 1780    24    20 bis 24
## 1781    28    25 bis 29
## 1782    32    30 bis 34
## 1783    29    25 bis 29
## 1784    37    35 bis 39
## 1785    28    25 bis 29
## 1786    38    35 bis 39
## 1787    28    25 bis 29
## 1788    34    30 bis 34
## 1789    34    30 bis 34
## 1790    26    25 bis 29
## 1791    28    25 bis 29
## 1792    23    20 bis 24
## 1793    23    20 bis 24
## 1794    33    30 bis 34
## 1795    20    20 bis 24
## 1796    24    20 bis 24
## 1797    24    20 bis 24
## 1798    24    20 bis 24
## 1799    29    25 bis 29
## 1800    26    25 bis 29
## 1801    27    25 bis 29
## 1802    32    30 bis 34
## 1803    21    20 bis 24
## 1804    30    30 bis 34
## 1805    33    30 bis 34
## 1806    35    35 bis 39
## 1807    34    30 bis 34
## 1808    36    35 bis 39
## 1809    30    30 bis 34
## 1810    23    20 bis 24
## 1811    30    30 bis 34
## 1812    40 40 und älter
## 1813    21    20 bis 24
## 1814    39    35 bis 39
## 1815    33    30 bis 34
## 1816    32    30 bis 34
## 1817    31    30 bis 34
## 1818    28    25 bis 29
## 1819    23    20 bis 24
## 1820    35    35 bis 39
## 1821    32    30 bis 34
## 1822    28    25 bis 29
## 1823    23    20 bis 24
## 1824    35    35 bis 39
## 1825    29    25 bis 29
## 1826    26    25 bis 29
## 1827    26    25 bis 29
## 1828    32    30 bis 34
## 1829    28    25 bis 29
## 1830    28    25 bis 29
## 1831    28    25 bis 29
## 1832    21    20 bis 24
## 1833    32    30 bis 34
## 1834    34    30 bis 34
## 1835    22    20 bis 24
## 1836    33    30 bis 34
## 1837    34    30 bis 34
## 1838    32    30 bis 34
## 1839    33    30 bis 34
## 1840    33    30 bis 34
## 1841    20    20 bis 24
## 1842    25    25 bis 29
## 1843    40 40 und älter
## 1844    29    25 bis 29
## 1845    30    30 bis 34
## 1846    30    30 bis 34
## 1847    29    25 bis 29
## 1848    31    30 bis 34
## 1849    28    25 bis 29
## 1850    33    30 bis 34
## 1851    33    30 bis 34
## 1852    32    30 bis 34
## 1853    33    30 bis 34
## 1854    33    30 bis 34
## 1855    30    30 bis 34
## 1856    35    35 bis 39
## 1857    29    25 bis 29
## 1858    32    30 bis 34
## 1859    39    35 bis 39
## 1860    27    25 bis 29
## 1861    30    30 bis 34
## 1862    32    30 bis 34
## 1863    30    30 bis 34
## 1864    35    35 bis 39
## 1865    22    20 bis 24
## 1866    25    25 bis 29
## 1867    31    30 bis 34
## 1868    28    25 bis 29
## 1869    29    25 bis 29
## 1870    27    25 bis 29
## 1871    25    25 bis 29
## 1872    30    30 bis 34
## 1873    32    30 bis 34
## 1874    33    30 bis 34
## 1875    23    20 bis 24
## 1876    36    35 bis 39
## 1877    29    25 bis 29
## 1878    28    25 bis 29
## 1879    25    25 bis 29
## 1880    28    25 bis 29
## 1881    31    30 bis 34
## 1882    31    30 bis 34
## 1883    21    20 bis 24
## 1884    33    30 bis 34
## 1885    31    30 bis 34
## 1886    28    25 bis 29
## 1887    23    20 bis 24
## 1888    32    30 bis 34
## 1889    24    20 bis 24
## 1890    28    25 bis 29
## 1891    28    25 bis 29
## 1892    37    35 bis 39
## 1893    23    20 bis 24
## 1894    36    35 bis 39
## 1895    23    20 bis 24
## 1896    25    25 bis 29
## 1897    29    25 bis 29
## 1898    28    25 bis 29
## 1899    26    25 bis 29
## 1900    34    30 bis 34
## 1901    29    25 bis 29
## 1902    32    30 bis 34
## 1903    28    25 bis 29
## 1904    26    25 bis 29
## 1905    26    25 bis 29
## 1906    28    25 bis 29
## 1907    22    20 bis 24
## 1908    26    25 bis 29
## 1909    32    30 bis 34
## 1910    26    25 bis 29
## 1911    27    25 bis 29
## 1912    25    25 bis 29
## 1913    26    25 bis 29
## 1914    30    30 bis 34
## 1915    30    30 bis 34
## 1916    34    30 bis 34
## 1917    26    25 bis 29
## 1918    23    20 bis 24
## 1919    19     unter 20
## 1920    28    25 bis 29
## 1921    29    25 bis 29
## 1922    32    30 bis 34
## 1923    21    20 bis 24
## 1924    37    35 bis 39
## 1925    31    30 bis 34
## 1926    31    30 bis 34
## 1927    40 40 und älter
## 1928    34    30 bis 34
## 1929    30    30 bis 34
## 1930    38    35 bis 39
## 1931    33    30 bis 34
## 1932    24    20 bis 24
## 1933    36    35 bis 39
## 1934    32    30 bis 34
## 1935    33    30 bis 34
## 1936    33    30 bis 34
## 1937    26    25 bis 29
## 1938    29    25 bis 29
## 1939    29    25 bis 29
## 1940    29    25 bis 29
## 1941    23    20 bis 24
## 1942    30    30 bis 34
## 1943    29    25 bis 29
## 1944    30    30 bis 34
## 1945    34    30 bis 34
## 1946    31    30 bis 34
## 1947    34    30 bis 34
## 1948    29    25 bis 29
## 1949    24    20 bis 24
## 1950    33    30 bis 34
## 1951    27    25 bis 29
## 1952    24    20 bis 24
## 1953    22    20 bis 24
## 1954    30    30 bis 34
## 1955    32    30 bis 34
## 1956    27    25 bis 29
## 1957    23    20 bis 24
## 1958    30    30 bis 34
## 1959    28    25 bis 29
## 1960    26    25 bis 29
## 1961    33    30 bis 34
## 1962    33    30 bis 34
## 1963    22    20 bis 24
## 1964    28    25 bis 29
## 1965    26    25 bis 29
## 1966    31    30 bis 34
## 1967    30    30 bis 34
## 1968    36    35 bis 39
## 1969    37    35 bis 39
## 1970    21    20 bis 24
## 1971    36    35 bis 39
## 1972    42 40 und älter
## 1973    26    25 bis 29
## 1974    28    25 bis 29
## 1975    32    30 bis 34
## 1976    35    35 bis 39
## 1977    34    30 bis 34
## 1978    33    30 bis 34
## 1979    24    20 bis 24
## 1980    40 40 und älter
## 1981    28    25 bis 29
## 1982    28    25 bis 29
## 1983    24    20 bis 24
## 1984    27    25 bis 29
## 1985    25    25 bis 29
## 1986    26    25 bis 29
## 1987    31    30 bis 34
## 1988    31    30 bis 34
## 1989    31    30 bis 34
## 1990    25    25 bis 29
## 1991    32    30 bis 34
## 1992    31    30 bis 34
## 1993    30    30 bis 34
## 1994    18     unter 20
## 1995    29    25 bis 29
## 1996    29    25 bis 29
## 1997    26    25 bis 29
## 1998    26    25 bis 29
## 1999    27    25 bis 29
## 2000    27    25 bis 29
## 2001    29    25 bis 29
## 2002    28    25 bis 29
## 2003    30    30 bis 34
## 2004    34    30 bis 34
## 2005    34    30 bis 34
## 2006    30    30 bis 34
## 2007    30    30 bis 34
## 2008    32    30 bis 34
## 2009    22    20 bis 24
## 2010    28    25 bis 29
## 2011    31    30 bis 34
## 2012    29    25 bis 29
## 2013    33    30 bis 34
## 2014    33    30 bis 34
## 2015    33    30 bis 34
## 2016    25    25 bis 29
## 2017    31    30 bis 34
## 2018    32    30 bis 34
## 2019    36    35 bis 39
## 2020    32    30 bis 34
## 2021    32    30 bis 34
## 2022    31    30 bis 34
## 2023    29    25 bis 29
## 2024    25    25 bis 29
## 2025    19     unter 20
## 2026    29    25 bis 29
## 2027    33    30 bis 34
## 2028    27    25 bis 29
## 2029    29    25 bis 29
## 2030    30    30 bis 34
## 2031    30    30 bis 34
## 2032    32    30 bis 34
## 2033    27    25 bis 29
## 2034    30    30 bis 34
## 2035    27    25 bis 29
## 2036    25    25 bis 29
## 2037    23    20 bis 24
## 2038    35    35 bis 39
## 2039    37    35 bis 39
## 2040    37    35 bis 39
## 2041    27    25 bis 29
## 2042    24    20 bis 24
## 2043    28    25 bis 29
## 2044    25    25 bis 29
## 2045    28    25 bis 29
## 2046    35    35 bis 39
## 2047    31    30 bis 34
## 2048    30    30 bis 34
## 2049    35    35 bis 39
## 2050    31    30 bis 34
## 2051    36    35 bis 39
## 2052    29    25 bis 29
## 2053    29    25 bis 29
## 2054    26    25 bis 29
## 2055    29    25 bis 29
## 2056    29    25 bis 29
## 2057    40 40 und älter
## 2058    31    30 bis 34
## 2059    31    30 bis 34
## 2060    23    20 bis 24
## 2061    31    30 bis 34
## 2062    36    35 bis 39
## 2063    26    25 bis 29
## 2064    29    25 bis 29
## 2065    29    25 bis 29
## 2066    23    20 bis 24
## 2067    33    30 bis 34
## 2068    26    25 bis 29
## 2069    29    25 bis 29
## 2070    28    25 bis 29
## 2071    29    25 bis 29
## 2072    28    25 bis 29
## 2073    26    25 bis 29
## 2074    25    25 bis 29
## 2075    25    25 bis 29
## 2076    29    25 bis 29
## 2077    29    25 bis 29
## 2078    29    25 bis 29
## 2079    38    35 bis 39
## 2080    29    25 bis 29
## 2081    31    30 bis 34
## 2082    23    20 bis 24
## 2083    23    20 bis 24
## 2084    29    25 bis 29
## 2085    32    30 bis 34
## 2086    32    30 bis 34
## 2087    32    30 bis 34
## 2088    32    30 bis 34
## 2089    23    20 bis 24
## 2090    25    25 bis 29
## 2091    39    35 bis 39
## 2092    21    20 bis 24
## 2093    31    30 bis 34
## 2094    28    25 bis 29
## 2095    31    30 bis 34
## 2096    23    20 bis 24
## 2097    29    25 bis 29
## 2098    24    20 bis 24
## 2099    25    25 bis 29
## 2100    33    30 bis 34
## 2101    34    30 bis 34
## 2102    34    30 bis 34
## 2103    24    20 bis 24
## 2104    42 40 und älter
## 2105    30    30 bis 34
## 2106    32    30 bis 34
## 2107    29    25 bis 29
## 2108    29    25 bis 29
## 2109    35    35 bis 39
## 2110    40 40 und älter
## 2111    33    30 bis 34
## 2112    36    35 bis 39
## 2113    30    30 bis 34
## 2114    30    30 bis 34
## 2115    24    20 bis 24
## 2116    33    30 bis 34
## 2117    26    25 bis 29
## 2118    24    20 bis 24
## 2119    33    30 bis 34
## 2120    29    25 bis 29
## 2121    35    35 bis 39
## 2122    23    20 bis 24
## 2123    25    25 bis 29
## 2124    31    30 bis 34
## 2125    35    35 bis 39
## 2126    23    20 bis 24
## 2127    32    30 bis 34
## 2128    30    30 bis 34
## 2129    35    35 bis 39
## 2130    33    30 bis 34
## 2131    30    30 bis 34
## 2132    28    25 bis 29
## 2133    30    30 bis 34
## 2134    37    35 bis 39
## 2135    29    25 bis 29
## 2136    27    25 bis 29
## 2137    27    25 bis 29
## 2138    32    30 bis 34
## 2139    33    30 bis 34
## 2140    33    30 bis 34
## 2141    31    30 bis 34
## 2142    27    25 bis 29
## 2143    26    25 bis 29
## 2144    32    30 bis 34
## 2145    28    25 bis 29
## 2146    38    35 bis 39
## 2147    38    35 bis 39
## 2148    25    25 bis 29
## 2149    30    30 bis 34
## 2150    28    25 bis 29
## 2151    26    25 bis 29
## 2152    30    30 bis 34
## 2153    24    20 bis 24
## 2154    26    25 bis 29
## 2155    27    25 bis 29
## 2156    26    25 bis 29
## 2157    36    35 bis 39
## 2158    35    35 bis 39
## 2159    31    30 bis 34
## 2160    26    25 bis 29
## 2161    31    30 bis 34
## 2162    32    30 bis 34
## 2163    24    20 bis 24
## 2164    26    25 bis 29
## 2165    34    30 bis 34
## 2166    31    30 bis 34
## 2167    33    30 bis 34
## 2168    27    25 bis 29
## 2169    36    35 bis 39
## 2170    28    25 bis 29
## 2171    33    30 bis 34
## 2172    33    30 bis 34
## 2173    27    25 bis 29
## 2174    32    30 bis 34
## 2175    36    35 bis 39
## 2176    27    25 bis 29
## 2177    32    30 bis 34
## 2178    28    25 bis 29
## 2179    30    30 bis 34
## 2180    23    20 bis 24
## 2181    43 40 und älter
## 2182    28    25 bis 29
## 2183    27    25 bis 29
## 2184    24    20 bis 24
## 2185    30    30 bis 34
## 2186    32    30 bis 34
## 2187    36    35 bis 39
## 2188    29    25 bis 29
## 2189    28    25 bis 29
## 2190    23    20 bis 24
## 2191    25    25 bis 29
## 2192    33    30 bis 34
## 2193    29    25 bis 29
## 2194    28    25 bis 29
## 2195    27    25 bis 29
## 2196    32    30 bis 34
## 2197    29    25 bis 29
## 2198    28    25 bis 29
## 2199    29    25 bis 29
## 2200    27    25 bis 29
## 2201    28    25 bis 29
## 2202    39    35 bis 39
## 2203    31    30 bis 34
## 2204    33    30 bis 34
## 2205    28    25 bis 29
## 2206    36    35 bis 39
## 2207    28    25 bis 29
## 2208    28    25 bis 29
## 2209    33    30 bis 34
## 2210    31    30 bis 34
## 2211    28    25 bis 29
## 2212    25    25 bis 29
## 2213    25    25 bis 29
## 2214    23    20 bis 24
## 2215    39    35 bis 39
## 2216    21    20 bis 24
## 2217    29    25 bis 29
## 2218    28    25 bis 29
## 2219    32    30 bis 34
## 2220    30    30 bis 34
## 2221    27    25 bis 29
## 2222    29    25 bis 29
## 2223    30    30 bis 34
## 2224    24    20 bis 24
## 2225    23    20 bis 24
## 2226    25    25 bis 29
## 2227    32    30 bis 34
## 2228    26    25 bis 29
## 2229    27    25 bis 29
## 2230    22    20 bis 24
## 2231    33    30 bis 34
## 2232    36    35 bis 39
## 2233    38    35 bis 39
## 2234    31    30 bis 34
## 2235    34    30 bis 34
## 2236    38    35 bis 39
## 2237    36    35 bis 39
## 2238    34    30 bis 34
## 2239    28    25 bis 29
## 2240    31    30 bis 34
## 2241    31    30 bis 34
## 2242    28    25 bis 29
## 2243    27    25 bis 29
## 2244    25    25 bis 29
## 2245    30    30 bis 34
## 2246    35    35 bis 39
## 2247    38    35 bis 39
## 2248    25    25 bis 29
## 2249    30    30 bis 34
## 2250    27    25 bis 29
## 2251    29    25 bis 29
## 2252    27    25 bis 29
## 2253    30    30 bis 34
## 2254    35    35 bis 39
## 2255    27    25 bis 29
## 2256    34    30 bis 34
## 2257    31    30 bis 34
## 2258    31    30 bis 34
## 2259    31    30 bis 34
## 2260    29    25 bis 29
## 2261    34    30 bis 34
## 2262    29    25 bis 29
## 2263    26    25 bis 29
## 2264    32    30 bis 34
## 2265    27    25 bis 29
## 2266    25    25 bis 29
## 2267    28    25 bis 29
## 2268    27    25 bis 29
## 2269    28    25 bis 29
## 2270    32    30 bis 34
## 2271    25    25 bis 29
## 2272    38    35 bis 39
## 2273    23    20 bis 24
## 2274    29    25 bis 29
## 2275    26    25 bis 29
## 2276    31    30 bis 34
## 2277    30    30 bis 34
## 2278    28    25 bis 29
## 2279    26    25 bis 29
## 2280    24    20 bis 24
## 2281    33    30 bis 34
## 2282    29    25 bis 29
## 2283    25    25 bis 29
## 2284    29    25 bis 29
## 2285    28    25 bis 29
## 2286    35    35 bis 39
## 2287    23    20 bis 24
## 2288    27    25 bis 29
## 2289    28    25 bis 29
## 2290    27    25 bis 29
## 2291    26    25 bis 29
## 2292    37    35 bis 39
## 2293    31    30 bis 34
## 2294    26    25 bis 29
## 2295    26    25 bis 29
## 2296    31    30 bis 34
## 2297    32    30 bis 34
## 2298    32    30 bis 34
## 2299    29    25 bis 29
## 2300    30    30 bis 34
## 2301    29    25 bis 29
## 2302    30    30 bis 34
## 2303    30    30 bis 34
## 2304    32    30 bis 34
## 2305    23    20 bis 24
## 2306    21    20 bis 24
## 2307    28    25 bis 29
## 2308    31    30 bis 34
## 2309    21    20 bis 24
## 2310    33    30 bis 34
## 2311    22    20 bis 24
## 2312    30    30 bis 34
## 2313    30    30 bis 34
## 2314    28    25 bis 29
## 2315    30    30 bis 34
## 2316    27    25 bis 29
## 2317    31    30 bis 34
## 2318    29    25 bis 29
## 2319    25    25 bis 29
## 2320    33    30 bis 34
## 2321    34    30 bis 34
## 2322    27    25 bis 29
## 2323    30    30 bis 34
## 2324    29    25 bis 29
## 2325    28    25 bis 29
## 2326    28    25 bis 29
## 2327    24    20 bis 24
## 2328    34    30 bis 34
## 2329    41 40 und älter
## 2330    34    30 bis 34
## 2331    30    30 bis 34
## 2332    31    30 bis 34
## 2333    22    20 bis 24
## 2334    27    25 bis 29
## 2335    33    30 bis 34
## 2336    30    30 bis 34
## 2337    28    25 bis 29
## 2338    37    35 bis 39
## 2339    36    35 bis 39
## 2340    33    30 bis 34
## 2341    33    30 bis 34
## 2342    30    30 bis 34
## 2343    26    25 bis 29
## 2344    32    30 bis 34
## 2345    31    30 bis 34
## 2346    24    20 bis 24
## 2347    19     unter 20
## 2348    29    25 bis 29
## 2349    29    25 bis 29
## 2350    31    30 bis 34
## 2351    22    20 bis 24
## 2352    30    30 bis 34
## 2353    29    25 bis 29
## 2354    31    30 bis 34
## 2355    35    35 bis 39
## 2356    33    30 bis 34
## 2357    29    25 bis 29
## 2358    30    30 bis 34
## 2359    30    30 bis 34
## 2360    33    30 bis 34
## 2361    24    20 bis 24
## 2362    27    25 bis 29
## 2363    34    30 bis 34
## 2364    32    30 bis 34
## 2365    37    35 bis 39
## 2366    29    25 bis 29
## 2367    29    25 bis 29
## 2368    29    25 bis 29
## 2369    25    25 bis 29
## 2370    27    25 bis 29
## 2371    26    25 bis 29
## 2372    28    25 bis 29
## 2373    29    25 bis 29
## 2374    32    30 bis 34
## 2375    26    25 bis 29
## 2376    29    25 bis 29
## 2377    25    25 bis 29
## 2378    34    30 bis 34
## 2379    27    25 bis 29
## 2380    39    35 bis 39
## 2381    26    25 bis 29
## 2382    32    30 bis 34
## 2383    31    30 bis 34
## 2384    21    20 bis 24
## 2385    36    35 bis 39
## 2386    30    30 bis 34
## 2387    30    30 bis 34
## 2388    21    20 bis 24
## 2389    34    30 bis 34
## 2390    27    25 bis 29
## 2391    21    20 bis 24
## 2392    29    25 bis 29
## 2393    30    30 bis 34
## 2394    30    30 bis 34
## 2395    23    20 bis 24
## 2396    28    25 bis 29
## 2397    24    20 bis 24
## 2398    30    30 bis 34
## 2399    25    25 bis 29
## 2400    27    25 bis 29
## 2401    28    25 bis 29
## 2402    27    25 bis 29
## 2403    28    25 bis 29
## 2404    29    25 bis 29
## 2405    24    20 bis 24
## 2406    33    30 bis 34
## 2407    25    25 bis 29
## 2408    24    20 bis 24
## 2409    20    20 bis 24
## 2410    28    25 bis 29
## 2411    29    25 bis 29
## 2412    24    20 bis 24
## 2413    21    20 bis 24
## 2414    38    35 bis 39
## 2415    39    35 bis 39
## 2416    22    20 bis 24
## 2417    29    25 bis 29
## 2418    22    20 bis 24
## 2419    24    20 bis 24
## 2420    36    35 bis 39
## 2421    34    30 bis 34
## 2422    25    25 bis 29
## 2423    31    30 bis 34
## 2424    31    30 bis 34
## 2425    37    35 bis 39
## 2426    28    25 bis 29
## 2427    29    25 bis 29
## 2428    27    25 bis 29
## 2429    35    35 bis 39
## 2430    34    30 bis 34
## 2431    29    25 bis 29
## 2432    29    25 bis 29
## 2433    31    30 bis 34
## 2434    33    30 bis 34
## 2435    22    20 bis 24
## 2436    34    30 bis 34
## 2437    24    20 bis 24
## 2438    31    30 bis 34
## 2439    31    30 bis 34
## 2440    30    30 bis 34
## 2441    29    25 bis 29
## 2442    30    30 bis 34
## 2443    32    30 bis 34
## 2444    27    25 bis 29
## 2445    33    30 bis 34
## 2446    31    30 bis 34
## 2447    25    25 bis 29
## 2448    34    30 bis 34
## 2449    28    25 bis 29
## 2450    39    35 bis 39
## 2451    22    20 bis 24
## 2452    31    30 bis 34
## 2453    37    35 bis 39
## 2454    35    35 bis 39
## 2455    34    30 bis 34
## 2456    36    35 bis 39
## 2457    22    20 bis 24
## 2458    21    20 bis 24
## 2459    31    30 bis 34
## 2460    39    35 bis 39
## 2461    33    30 bis 34
## 2462    32    30 bis 34
## 2463    30    30 bis 34
## 2464    36    35 bis 39
## 2465    32    30 bis 34
## 2466    31    30 bis 34
## 2467    30    30 bis 34
## 2468    27    25 bis 29
## 2469    27    25 bis 29
## 2470    22    20 bis 24
## 2471    34    30 bis 34
## 2472    35    35 bis 39
## 2473    31    30 bis 34
## 2474    33    30 bis 34
## 2475    27    25 bis 29
## 2476    31    30 bis 34
## 2477    24    20 bis 24
## 2478    38    35 bis 39
## 2479    32    30 bis 34
## 2480    21    20 bis 24
## 2481    33    30 bis 34
## 2482    34    30 bis 34
## 2483    32    30 bis 34
## 2484    33    30 bis 34
## 2485    35    35 bis 39
## 2486    25    25 bis 29
## 2487    33    30 bis 34
## 2488    30    30 bis 34
## 2489    29    25 bis 29
## 2490    32    30 bis 34
## 2491    32    30 bis 34
## 2492    35    35 bis 39
## 2493    36    35 bis 39
## 2494    30    30 bis 34
## 2495    32    30 bis 34
## 2496    21    20 bis 24
## 2497    32    30 bis 34
## 2498    37    35 bis 39
## 2499    26    25 bis 29
## 2500    29    25 bis 29
## 2501    35    35 bis 39
## 2502    29    25 bis 29
## 2503    31    30 bis 34
## 2504    35    35 bis 39
## 2505    42 40 und älter
## 2506    35    35 bis 39
## 2507    29    25 bis 29
## 2508    31    30 bis 34
## 2509    34    30 bis 34
## 2510    30    30 bis 34
## 2511    36    35 bis 39
## 2512    24    20 bis 24
## 2513    26    25 bis 29
## 2514    33    30 bis 34
## 2515    23    20 bis 24
## 2516    33    30 bis 34
## 2517    22    20 bis 24
## 2518    31    30 bis 34
## 2519    33    30 bis 34
## 2520    28    25 bis 29
## 2521    28    25 bis 29
## 2522    30    30 bis 34
## 2523    39    35 bis 39
## 2524    34    30 bis 34
## 2525    20    20 bis 24
## 2526    30    30 bis 34
## 2527    29    25 bis 29
## 2528    30    30 bis 34
## 2529    29    25 bis 29
## 2530    27    25 bis 29
## 2531    30    30 bis 34
## 2532    29    25 bis 29
## 2533    26    25 bis 29
## 2534    31    30 bis 34
## 2535    26    25 bis 29
## 2536    30    30 bis 34
## 2537    28    25 bis 29
## 2538    23    20 bis 24
## 2539    41 40 und älter
## 2540    27    25 bis 29
## 2541    29    25 bis 29
## 2542    25    25 bis 29
## 2543    28    25 bis 29
## 2544    36    35 bis 39
## 2545    26    25 bis 29
## 2546    33    30 bis 34
## 2547    28    25 bis 29
## 2548    36    35 bis 39
## 2549    35    35 bis 39
## 2550    29    25 bis 29
## 2551    28    25 bis 29
## 2552    25    25 bis 29
## 2553    32    30 bis 34
## 2554    27    25 bis 29
## 2555    27    25 bis 29
## 2556    35    35 bis 39
## 2557    27    25 bis 29
## 2558    32    30 bis 34
## 2559    33    30 bis 34
## 2560    42 40 und älter
## 2561    30    30 bis 34
## 2562    28    25 bis 29
## 2563    30    30 bis 34
## 2564    39    35 bis 39
## 2565    27    25 bis 29
## 2566    30    30 bis 34
## 2567    29    25 bis 29
## 2568    20    20 bis 24
## 2569    29    25 bis 29
## 2570    26    25 bis 29
## 2571    38    35 bis 39
## 2572    27    25 bis 29
## 2573    32    30 bis 34
## 2574    21    20 bis 24
## 2575    31    30 bis 34
## 2576    26    25 bis 29
## 2577    32    30 bis 34
## 2578    32    30 bis 34
## 2579    37    35 bis 39
## 2580    35    35 bis 39
## 2581    29    25 bis 29
## 2582    24    20 bis 24
## 2583    32    30 bis 34
## 2584    25    25 bis 29
## 2585    32    30 bis 34
## 2586    30    30 bis 34
## 2587    26    25 bis 29
## 2588    28    25 bis 29
## 2589    27    25 bis 29
## 2590    28    25 bis 29
## 2591    37    35 bis 39
## 2592    27    25 bis 29
## 2593    26    25 bis 29
## 2594    28    25 bis 29
## 2595    34    30 bis 34
## 2596    21    20 bis 24
## 2597    29    25 bis 29
## 2598    33    30 bis 34
## 2599    30    30 bis 34
## 2600    26    25 bis 29
## 2601    27    25 bis 29
## 2602    34    30 bis 34
## 2603    31    30 bis 34
## 2604    22    20 bis 24
## 2605    25    25 bis 29
## 2606    27    25 bis 29
## 2607    36    35 bis 39
## 2608    29    25 bis 29
## 2609    36    35 bis 39
## 2610    27    25 bis 29
## 2611    26    25 bis 29
## 2612    31    30 bis 34
## 2613    29    25 bis 29
## 2614    29    25 bis 29
## 2615    34    30 bis 34
## 2616    19     unter 20
## 2617    27    25 bis 29
## 2618    34    30 bis 34
## 2619    28    25 bis 29
## 2620    28    25 bis 29
## 2621    27    25 bis 29
## 2622    19     unter 20
## 2623    38    35 bis 39
## 2624    28    25 bis 29
## 2625    32    30 bis 34
## 2626    28    25 bis 29
## 2627    35    35 bis 39
## 2628    39    35 bis 39
## 2629    23    20 bis 24
## 2630    36    35 bis 39
## 2631    33    30 bis 34
## 2632    23    20 bis 24
## 2633    32    30 bis 34
## 2634    35    35 bis 39
## 2635    27    25 bis 29
## 2636    28    25 bis 29
## 2637    37    35 bis 39
## 2638    33    30 bis 34
## 2639    36    35 bis 39
## 2640    35    35 bis 39
## 2641    25    25 bis 29
## 2642    27    25 bis 29
## 2643    30    30 bis 34
## 2644    30    30 bis 34
## 2645    30    30 bis 34
## 2646    25    25 bis 29
## 2647    31    30 bis 34
## 2648    24    20 bis 24
## 2649    29    25 bis 29
## 2650    31    30 bis 34
## 2651    23    20 bis 24
## 2652    32    30 bis 34
## 2653    31    30 bis 34
## 2654    20    20 bis 24
## 2655    28    25 bis 29
## 2656    29    25 bis 29
## 2657    26    25 bis 29
## 2658    31    30 bis 34
## 2659    31    30 bis 34
## 2660    29    25 bis 29
## 2661    31    30 bis 34
## 2662    32    30 bis 34
## 2663    32    30 bis 34
## 2664    32    30 bis 34
## 2665    22    20 bis 24
## 2666    33    30 bis 34
## 2667    36    35 bis 39
## 2668    25    25 bis 29
## 2669    30    30 bis 34
## 2670    28    25 bis 29
## 2671    26    25 bis 29
## 2672    27    25 bis 29
## 2673    21    20 bis 24
## 2674    27    25 bis 29
## 2675    34    30 bis 34
## 2676    20    20 bis 24
## 2677    23    20 bis 24
## 2678    26    25 bis 29
## 2679    30    30 bis 34
## 2680    31    30 bis 34
## 2681    27    25 bis 29
## 2682    25    25 bis 29
## 2683    29    25 bis 29
## 2684    41 40 und älter
## 2685    29    25 bis 29
## 2686    20    20 bis 24
## 2687    29    25 bis 29
## 2688    31    30 bis 34
## 2689    31    30 bis 34
## 2690    21    20 bis 24
## 2691    32    30 bis 34
## 2692    32    30 bis 34
## 2693    31    30 bis 34
## 2694    35    35 bis 39
## 2695    29    25 bis 29
## 2696    30    30 bis 34
## 2697    35    35 bis 39
## 2698    32    30 bis 34
## 2699    30    30 bis 34
## 2700    29    25 bis 29
## 2701    39    35 bis 39
## 2702    25    25 bis 29
## 2703    32    30 bis 34
## 2704    41 40 und älter
## 2705    29    25 bis 29
## 2706    26    25 bis 29
## 2707    29    25 bis 29
## 2708    26    25 bis 29
## 2709    22    20 bis 24
## 2710    27    25 bis 29
## 2711    29    25 bis 29
## 2712    36    35 bis 39
## 2713    31    30 bis 34
## 2714    29    25 bis 29
## 2715    21    20 bis 24
## 2716    33    30 bis 34
## 2717    30    30 bis 34
## 2718    31    30 bis 34
## 2719    21    20 bis 24
## 2720    28    25 bis 29
## 2721    31    30 bis 34
## 2722    31    30 bis 34
## 2723    31    30 bis 34
## 2724    33    30 bis 34
## 2725    26    25 bis 29
## 2726    37    35 bis 39
## 2727    34    30 bis 34
## 2728    31    30 bis 34
## 2729    23    20 bis 24
## 2730    28    25 bis 29
## 2731    30    30 bis 34
## 2732    32    30 bis 34
## 2733    25    25 bis 29
## 2734    31    30 bis 34
## 2735    34    30 bis 34
## 2736    28    25 bis 29
## 2737    27    25 bis 29
## 2738    28    25 bis 29
## 2739    28    25 bis 29
## 2740    30    30 bis 34
## 2741    25    25 bis 29
## 2742    28    25 bis 29
## 2743    30    30 bis 34
## 2744    34    30 bis 34
## 2745    45 40 und älter
## 2746    24    20 bis 24
## 2747    29    25 bis 29
## 2748    42 40 und älter
## 2749    43 40 und älter
## 2750    31    30 bis 34
## 2751    29    25 bis 29
## 2752    26    25 bis 29
## 2753    26    25 bis 29
## 2754    26    25 bis 29
## 2755    29    25 bis 29
## 2756    29    25 bis 29
## 2757    37    35 bis 39
## 2758    35    35 bis 39
## 2759    28    25 bis 29
## 2760    29    25 bis 29
## 2761    30    30 bis 34
## 2762    30    30 bis 34
## 2763    32    30 bis 34
## 2764    28    25 bis 29
## 2765    32    30 bis 34
## 2766    31    30 bis 34
## 2767    27    25 bis 29
## 2768    35    35 bis 39
## 2769    32    30 bis 34
## 2770    32    30 bis 34
## 2771    29    25 bis 29
## 2772    21    20 bis 24
## 2773    24    20 bis 24
## 2774    26    25 bis 29
## 2775    26    25 bis 29
## 2776    27    25 bis 29
## 2777    25    25 bis 29
## 2778    28    25 bis 29
## 2779    29    25 bis 29
## 2780    33    30 bis 34
## 2781    25    25 bis 29
## 2782    30    30 bis 34
## 2783    35    35 bis 39
## 2784    27    25 bis 29
## 2785    31    30 bis 34
## 2786    29    25 bis 29
## 2787    28    25 bis 29
## 2788    27    25 bis 29
## 2789    24    20 bis 24
## 2790    36    35 bis 39
## 2791    32    30 bis 34
## 2792    30    30 bis 34
## 2793    25    25 bis 29
## 2794    25    25 bis 29
## 2795    30    30 bis 34
## 2796    25    25 bis 29
## 2797    35    35 bis 39
## 2798    25    25 bis 29
## 2799    29    25 bis 29
## 2800    29    25 bis 29
## 2801    35    35 bis 39
## 2802    28    25 bis 29
## 2803    27    25 bis 29
## 2804    37    35 bis 39
## 2805    34    30 bis 34
## 2806    36    35 bis 39
## 2807    26    25 bis 29
## 2808    29    25 bis 29
## 2809    28    25 bis 29
## 2810    26    25 bis 29
## 2811    25    25 bis 29
## 2812    20    20 bis 24
## 2813    21    20 bis 24
## 2814    30    30 bis 34
## 2815    25    25 bis 29
## 2816    27    25 bis 29
## 2817    36    35 bis 39
## 2818    29    25 bis 29
## 2819    30    30 bis 34
## 2820    35    35 bis 39
## 2821    35    35 bis 39
## 2822    27    25 bis 29
## 2823    26    25 bis 29
## 2824    27    25 bis 29
## 2825    27    25 bis 29
## 2826    29    25 bis 29
## 2827    36    35 bis 39
## 2828    25    25 bis 29
## 2829    25    25 bis 29
## 2830    31    30 bis 34
## 2831    38    35 bis 39
## 2832    27    25 bis 29
## 2833    35    35 bis 39
## 2834    34    30 bis 34
## 2835    35    35 bis 39
## 2836    21    20 bis 24
## 2837    34    30 bis 34
## 2838    22    20 bis 24
## 2839    24    20 bis 24
## 2840    28    25 bis 29
## 2841    36    35 bis 39
## 2842    32    30 bis 34
## 2843    33    30 bis 34
## 2844    35    35 bis 39
## 2845    22    20 bis 24
## 2846    17     unter 20
## 2847    26    25 bis 29
## 2848    24    20 bis 24
## 2849    33    30 bis 34
## 2850    30    30 bis 34
## 2851    32    30 bis 34
## 2852    30    30 bis 34
## 2853    28    25 bis 29
## 2854    31    30 bis 34
## 2855    27    25 bis 29
## 2856    32    30 bis 34
## 2857    28    25 bis 29
## 2858    36    35 bis 39
## 2859    32    30 bis 34
## 2860    32    30 bis 34
## 2861    29    25 bis 29
## 2862    23    20 bis 24
## 2863    24    20 bis 24
## 2864    24    20 bis 24
## 2865    33    30 bis 34
## 2866    32    30 bis 34
## 2867    28    25 bis 29
## 2868    31    30 bis 34
## 2869    29    25 bis 29
## 2870    24    20 bis 24
## 2871    25    25 bis 29
## 2872    22    20 bis 24
## 2873    33    30 bis 34
## 2874    32    30 bis 34
## 2875    27    25 bis 29
## 2876    28    25 bis 29
## 2877    31    30 bis 34
## 2878    31    30 bis 34
## 2879    27    25 bis 29
## 2880    21    20 bis 24
## 2881    34    30 bis 34
## 2882    30    30 bis 34
## 2883    22    20 bis 24
## 2884    32    30 bis 34
## 2885    33    30 bis 34
## 2886    26    25 bis 29
## 2887    20    20 bis 24
## 2888    36    35 bis 39
## 2889    31    30 bis 34
## 2890    27    25 bis 29
## 2891    37    35 bis 39
## 2892    26    25 bis 29
## 2893    34    30 bis 34
## 2894    26    25 bis 29
## 2895    23    20 bis 24
## 2896    34    30 bis 34
## 2897    28    25 bis 29
## 2898    23    20 bis 24
## 2899    38    35 bis 39
## 2900    39    35 bis 39
## 2901    28    25 bis 29
## 2902    37    35 bis 39
## 2903    31    30 bis 34
## 2904    29    25 bis 29
## 2905    26    25 bis 29
## 2906    27    25 bis 29
## 2907    29    25 bis 29
## 2908    24    20 bis 24
## 2909    35    35 bis 39
## 2910    31    30 bis 34
## 2911    38    35 bis 39
## 2912    30    30 bis 34
## 2913    30    30 bis 34
## 2914    34    30 bis 34
## 2915    29    25 bis 29
## 2916    26    25 bis 29
## 2917    36    35 bis 39
## 2918    24    20 bis 24
## 2919    34    30 bis 34
## 2920    35    35 bis 39
## 2921    30    30 bis 34
## 2922    24    20 bis 24
## 2923    34    30 bis 34
## 2924    30    30 bis 34
## 2925    29    25 bis 29
## 2926    35    35 bis 39
## 2927    28    25 bis 29
## 2928    38    35 bis 39
## 2929    30    30 bis 34
## 2930    30    30 bis 34
## 2931    28    25 bis 29
## 2932    29    25 bis 29
## 2933    29    25 bis 29
## 2934    30    30 bis 34
## 2935    22    20 bis 24
## 2936    39    35 bis 39
## 2937    28    25 bis 29
## 2938    29    25 bis 29
## 2939    30    30 bis 34
## 2940    36    35 bis 39
## 2941    39    35 bis 39
## 2942    25    25 bis 29
## 2943    27    25 bis 29
## 2944    25    25 bis 29
## 2945    33    30 bis 34
## 2946    33    30 bis 34
## 2947    26    25 bis 29
## 2948    36    35 bis 39
## 2949    19     unter 20
## 2950    27    25 bis 29
## 2951    39    35 bis 39
## 2952    29    25 bis 29
## 2953    29    25 bis 29
## 2954    30    30 bis 34
## 2955    27    25 bis 29
## 2956    32    30 bis 34
## 2957    21    20 bis 24
## 2958    25    25 bis 29
## 2959    20    20 bis 24
## 2960    36    35 bis 39
## 2961    24    20 bis 24
## 2962    32    30 bis 34
## 2963    28    25 bis 29
## 2964    30    30 bis 34
## 2965    29    25 bis 29
## 2966    32    30 bis 34
## 2967    20    20 bis 24
## 2968    27    25 bis 29
## 2969    28    25 bis 29
## 2970    23    20 bis 24
## 2971    30    30 bis 34
## 2972    24    20 bis 24
## 2973    23    20 bis 24
## 2974    31    30 bis 34
## 2975    31    30 bis 34
## 2976    29    25 bis 29
## 2977    32    30 bis 34
## 2978    23    20 bis 24
## 2979    32    30 bis 34
## 2980    36    35 bis 39
## 2981    28    25 bis 29
## 2982    33    30 bis 34
## 2983    28    25 bis 29
## 2984    30    30 bis 34
## 2985    34    30 bis 34
## 2986    34    30 bis 34
## 2987    37    35 bis 39
## 2988    31    30 bis 34
## 2989    24    20 bis 24
## 2990    30    30 bis 34
## 2991    26    25 bis 29
## 2992    28    25 bis 29
## 2993    38    35 bis 39
## 2994    38    35 bis 39
## 2995    25    25 bis 29
## 2996    25    25 bis 29
## 2997    27    25 bis 29
## 2998    16     unter 20
## 2999    23    20 bis 24
## 3000    21    20 bis 24
## 3001    27    25 bis 29
## 3002    34    30 bis 34
## 3003    22    20 bis 24
## 3004    24    20 bis 24
## 3005    23    20 bis 24
## 3006    23    20 bis 24
## 3007    41 40 und älter
## 3008    39    35 bis 39
## 3009    38    35 bis 39
## 3010    39    35 bis 39
## 3011    24    20 bis 24
## 3012    32    30 bis 34
## 3013    28    25 bis 29
## 3014    28    25 bis 29
## 3015    22    20 bis 24
## 3016    22    20 bis 24
## 3017    37    35 bis 39
## 3018    28    25 bis 29
## 3019    26    25 bis 29
## 3020    30    30 bis 34
## 3021    28    25 bis 29
## 3022    22    20 bis 24
## 3023    26    25 bis 29
## 3024    28    25 bis 29
## 3025    22    20 bis 24
## 3026    29    25 bis 29
## 3027    24    20 bis 24
## 3028    28    25 bis 29
## 3029    34    30 bis 34
## 3030    29    25 bis 29
## 3031    18     unter 20
## 3032    30    30 bis 34
## 3033    29    25 bis 29
## 3034    24    20 bis 24
## 3035    28    25 bis 29
## 3036    28    25 bis 29
## 3037    19     unter 20
## 3038    19     unter 20
## 3039    19     unter 20
## 3040    23    20 bis 24
## 3041    35    35 bis 39
## 3042    35    35 bis 39
## 3043    18     unter 20
## 3044    20    20 bis 24
## 3045    27    25 bis 29
## 3046    21    20 bis 24
## 3047    24    20 bis 24
## 3048    27    25 bis 29
## 3049    23    20 bis 24
## 3050    29    25 bis 29
## 3051    21    20 bis 24
## 3052    27    25 bis 29
## 3053    21    20 bis 24
## 3054    34    30 bis 34
## 3055    27    25 bis 29
## 3056    27    25 bis 29
## 3057    29    25 bis 29
## 3058    27    25 bis 29
## 3059    36    35 bis 39
## 3060    28    25 bis 29
## 3061    41 40 und älter
## 3062    25    25 bis 29
## 3063    29    25 bis 29
## 3064    27    25 bis 29
## 3065    19     unter 20
## 3066    23    20 bis 24
## 3067    25    25 bis 29
## 3068    25    25 bis 29
## 3069    27    25 bis 29
## 3070    23    20 bis 24
## 3071    24    20 bis 24
## 3072    22    20 bis 24
## 3073    31    30 bis 34
## 3074    28    25 bis 29
## 3075    25    25 bis 29
## 3076    25    25 bis 29
## 3077    22    20 bis 24
## 3078    25    25 bis 29
## 3079    26    25 bis 29
## 3080    18     unter 20
## 3081    29    25 bis 29
## 3082    28    25 bis 29
## 3083    34    30 bis 34
## 3084    31    30 bis 34
## 3085    31    30 bis 34
## 3086    29    25 bis 29
## 3087    20    20 bis 24
## 3088    27    25 bis 29
## 3089    20    20 bis 24
## 3090    30    30 bis 34
## 3091    25    25 bis 29
## 3092    26    25 bis 29
## 3093    28    25 bis 29
## 3094    27    25 bis 29
## 3095    27    25 bis 29
## 3096    31    30 bis 34
## 3097    30    30 bis 34
## 3098    26    25 bis 29
## 3099    26    25 bis 29
## 3100    22    20 bis 24
## 3101    18     unter 20
## 3102    27    25 bis 29
## 3103    24    20 bis 24
## 3104    30    30 bis 34
## 3105    34    30 bis 34
## 3106    33    30 bis 34
## 3107    29    25 bis 29
## 3108    22    20 bis 24
## 3109    26    25 bis 29
## 3110    31    30 bis 34
## 3111    25    25 bis 29
## 3112    27    25 bis 29
## 3113    24    20 bis 24
## 3114    24    20 bis 24
## 3115    22    20 bis 24
## 3116    24    20 bis 24
## 3117    22    20 bis 24
## 3118    29    25 bis 29
## 3119    30    30 bis 34
## 3120    30    30 bis 34
## 3121    22    20 bis 24
## 3122    36    35 bis 39
## 3123    24    20 bis 24
## 3124    32    30 bis 34
## 3125    22    20 bis 24
## 3126    22    20 bis 24
## 3127    25    25 bis 29
## 3128    24    20 bis 24
## 3129    32    30 bis 34
## 3130    22    20 bis 24
## 3131    31    30 bis 34
## 3132    21    20 bis 24
## 3133    24    20 bis 24
## 3134    31    30 bis 34
## 3135    29    25 bis 29
## 3136    24    20 bis 24
## 3137    33    30 bis 34
## 3138    24    20 bis 24
## 3139    24    20 bis 24
## 3140    25    25 bis 29
## 3141    27    25 bis 29
## 3142    24    20 bis 24
## 3143    21    20 bis 24
## 3144    30    30 bis 34
## 3145    23    20 bis 24
## 3146    26    25 bis 29
## 3147    23    20 bis 24
## 3148    29    25 bis 29
## 3149    22    20 bis 24
## 3150    23    20 bis 24
## 3151    32    30 bis 34
## 3152    32    30 bis 34
## 3153    31    30 bis 34
## 3154    29    25 bis 29
## 3155    25    25 bis 29
## 3156    30    30 bis 34
## 3157    23    20 bis 24
## 3158    22    20 bis 24
## 3159    21    20 bis 24
## 3160    28    25 bis 29
## 3161    27    25 bis 29
## 3162    28    25 bis 29
## 3163    22    20 bis 24
## 3164    31    30 bis 34
## 3165    38    35 bis 39
## 3166    28    25 bis 29
## 3167    34    30 bis 34
## 3168    23    20 bis 24
## 3169    20    20 bis 24
## 3170    29    25 bis 29
## 3171    23    20 bis 24
## 3172    23    20 bis 24
## 3173    25    25 bis 29
## 3174    22    20 bis 24
## 3175    23    20 bis 24
## 3176    30    30 bis 34
## 3177    25    25 bis 29
## 3178    24    20 bis 24
## 3179    27    25 bis 29
## 3180    25    25 bis 29
## 3181    29    25 bis 29
## 3182    32    30 bis 34
## 3183    34    30 bis 34
## 3184    23    20 bis 24
## 3185    31    30 bis 34
## 3186    19     unter 20
## 3187    22    20 bis 24
## 3188    31    30 bis 34
## 3189    28    25 bis 29
## 3190    22    20 bis 24
## 3191    22    20 bis 24
## 3192    29    25 bis 29
## 3193    28    25 bis 29
## 3194    30    30 bis 34
## 3195    23    20 bis 24
## 3196    22    20 bis 24
## 3197    26    25 bis 29
## 3198    25    25 bis 29
## 3199    24    20 bis 24
## 3200    24    20 bis 24
## 3201    27    25 bis 29
## 3202    20    20 bis 24
## 3203    27    25 bis 29
## 3204    23    20 bis 24
## 3205    33    30 bis 34
## 3206    35    35 bis 39
## 3207    27    25 bis 29
## 3208    28    25 bis 29
## 3209    24    20 bis 24
## 3210    30    30 bis 34
## 3211    31    30 bis 34
## 3212    21    20 bis 24
## 3213    24    20 bis 24
## 3214    33    30 bis 34
## 3215    33    30 bis 34
## 3216    27    25 bis 29
## 3217    38    35 bis 39
## 3218    32    30 bis 34
## 3219    23    20 bis 24
## 3220    25    25 bis 29
## 3221    30    30 bis 34
## 3222    27    25 bis 29
## 3223    23    20 bis 24
## 3224    26    25 bis 29
## 3225    31    30 bis 34
## 3226    30    30 bis 34
## 3227    30    30 bis 34
## 3228    33    30 bis 34
## 3229    28    25 bis 29
## 3230    31    30 bis 34
## 3231    30    30 bis 34
## 3232    23    20 bis 24
## 3233    34    30 bis 34
## 3234    22    20 bis 24
## 3235    33    30 bis 34
## 3236    23    20 bis 24
## 3237    25    25 bis 29
## 3238    34    30 bis 34
## 3239    22    20 bis 24
## 3240    24    20 bis 24
## 3241    25    25 bis 29
## 3242    27    25 bis 29
## 3243    24    20 bis 24
## 3244    35    35 bis 39
## 3245    23    20 bis 24
## 3246    33    30 bis 34
## 3247    30    30 bis 34
## 3248    35    35 bis 39
## 3249    24    20 bis 24
## 3250    26    25 bis 29
## 3251    21    20 bis 24
## 3252    27    25 bis 29
## 3253    26    25 bis 29
## 3254    29    25 bis 29
## 3255    28    25 bis 29
## 3256    29    25 bis 29
## 3257    26    25 bis 29
## 3258    22    20 bis 24
## 3259    23    20 bis 24
## 3260    23    20 bis 24
## 3261    31    30 bis 34
## 3262    24    20 bis 24
## 3263    20    20 bis 24
## 3264    37    35 bis 39
## 3265    27    25 bis 29
## 3266    39    35 bis 39
## 3267    21    20 bis 24
## 3268    33    30 bis 34
## 3269    34    30 bis 34
## 3270    25    25 bis 29
## 3271    26    25 bis 29
## 3272    25    25 bis 29
## 3273    18     unter 20
## 3274    33    30 bis 34
## 3275    32    30 bis 34
## 3276    26    25 bis 29
## 3277    28    25 bis 29
## 3278    28    25 bis 29
## 3279    25    25 bis 29
## 3280    28    25 bis 29
## 3281    28    25 bis 29
## 3282    26    25 bis 29
## 3283    29    25 bis 29
## 3284    25    25 bis 29
## 3285    24    20 bis 24
## 3286    26    25 bis 29
## 3287    20    20 bis 24
## 3288    42 40 und älter
## 3289    23    20 bis 24
## 3290    22    20 bis 24
## 3291    42 40 und älter
## 3292    22    20 bis 24
## 3293    32    30 bis 34
## 3294    26    25 bis 29
## 3295    23    20 bis 24
## 3296    24    20 bis 24
## 3297    23    20 bis 24
## 3298    27    25 bis 29
## 3299    27    25 bis 29
## 3300    26    25 bis 29
## 3301    30    30 bis 34
## 3302    29    25 bis 29
## 3303    27    25 bis 29
## 3304    30    30 bis 34
## 3305    31    30 bis 34
## 3306    23    20 bis 24
## 3307    23    20 bis 24
## 3308    19     unter 20
## 3309    31    30 bis 34
## 3310    31    30 bis 34
## 3311    25    25 bis 29
## 3312    31    30 bis 34
## 3313    33    30 bis 34
## 3314    22    20 bis 24
## 3315    31    30 bis 34
## 3316    23    20 bis 24
## 3317    34    30 bis 34
## 3318    29    25 bis 29
## 3319    24    20 bis 24
## 3320    27    25 bis 29
## 3321    29    25 bis 29
## 3322    21    20 bis 24
## 3323    23    20 bis 24
## 3324    27    25 bis 29
## 3325    23    20 bis 24
## 3326    34    30 bis 34
## 3327    29    25 bis 29
## 3328    24    20 bis 24
## 3329    27    25 bis 29
## 3330    33    30 bis 34
## 3331    22    20 bis 24
## 3332    21    20 bis 24
## 3333    25    25 bis 29
## 3334    26    25 bis 29
## 3335    22    20 bis 24
## 3336    23    20 bis 24
## 3337    25    25 bis 29
## 3338    25    25 bis 29
## 3339    24    20 bis 24
## 3340    38    35 bis 39
## 3341    22    20 bis 24
## 3342    37    35 bis 39
## 3343    30    30 bis 34
## 3344    27    25 bis 29
## 3345    22    20 bis 24
## 3346    23    20 bis 24
## 3347    35    35 bis 39
## 3348    18     unter 20
## 3349    28    25 bis 29
## 3350    32    30 bis 34
## 3351    29    25 bis 29
## 3352    35    35 bis 39
## 3353    32    30 bis 34
## 3354    42 40 und älter
## 3355    27    25 bis 29
## 3356    27    25 bis 29
## 3357    34    30 bis 34
## 3358    24    20 bis 24
## 3359    32    30 bis 34
## 3360    22    20 bis 24
## 3361    35    35 bis 39
## 3362    25    25 bis 29
## 3363    36    35 bis 39
## 3364    30    30 bis 34
## 3365    26    25 bis 29
## 3366    20    20 bis 24
## 3367    30    30 bis 34
## 3368    36    35 bis 39
## 3369    29    25 bis 29
## 3370    27    25 bis 29
## 3371    30    30 bis 34
## 3372    26    25 bis 29
## 3373    30    30 bis 34
## 3374    34    30 bis 34
## 3375    26    25 bis 29
## 3376    26    25 bis 29
## 3377    27    25 bis 29
## 3378    22    20 bis 24
## 3379    39    35 bis 39
## 3380    33    30 bis 34
## 3381    27    25 bis 29
## 3382    37    35 bis 39
## 3383    37    35 bis 39
## 3384    38    35 bis 39
## 3385    23    20 bis 24
## 3386    31    30 bis 34
## 3387    24    20 bis 24
## 3388    28    25 bis 29
## 3389    23    20 bis 24
## 3390    44 40 und älter
## 3391    30    30 bis 34
## 3392    26    25 bis 29
## 3393    31    30 bis 34
## 3394    28    25 bis 29
## 3395    35    35 bis 39
## 3396    33    30 bis 34
## 3397    36    35 bis 39
## 3398    23    20 bis 24
## 3399    33    30 bis 34
## 3400    27    25 bis 29
## 3401    29    25 bis 29
## 3402    19     unter 20
## 3403    29    25 bis 29
## 3404    32    30 bis 34
## 3405    36    35 bis 39
## 3406    32    30 bis 34
## 3407    32    30 bis 34
## 3408    31    30 bis 34
## 3409    28    25 bis 29
## 3410    37    35 bis 39
## 3411    32    30 bis 34
## 3412    31    30 bis 34
## 3413    21    20 bis 24
## 3414    30    30 bis 34
## 3415    29    25 bis 29
## 3416    25    25 bis 29
## 3417    31    30 bis 34
## 3418    21    20 bis 24
## 3419    19     unter 20
## 3420    32    30 bis 34
## 3421    27    25 bis 29
## 3422    29    25 bis 29
## 3423    29    25 bis 29
## 3424    23    20 bis 24
## 3425    35    35 bis 39
## 3426    28    25 bis 29
## 3427    28    25 bis 29
## 3428    28    25 bis 29
## 3429    27    25 bis 29
## 3430    32    30 bis 34
## 3431    38    35 bis 39
## 3432    23    20 bis 24
## 3433    34    30 bis 34
## 3434    28    25 bis 29
## 3435    29    25 bis 29
## 3436    38    35 bis 39
## 3437    42 40 und älter
## 3438    36    35 bis 39
## 3439    35    35 bis 39
## 3440    35    35 bis 39
## 3441    33    30 bis 34
## 3442    30    30 bis 34
## 3443    30    30 bis 34
## 3444    26    25 bis 29
## 3445    26    25 bis 29
## 3446    35    35 bis 39
## 3447    29    25 bis 29
## 3448    28    25 bis 29
## 3449    31    30 bis 34
## 3450    31    30 bis 34
## 3451    27    25 bis 29
## 3452    29    25 bis 29
## 3453    30    30 bis 34
## 3454    35    35 bis 39
## 3455    24    20 bis 24
## 3456    19     unter 20
## 3457    27    25 bis 29
## 3458    23    20 bis 24
## 3459    22    20 bis 24
## 3460    37    35 bis 39
## 3461    29    25 bis 29
## 3462    30    30 bis 34
## 3463    28    25 bis 29
## 3464    22    20 bis 24
## 3465    26    25 bis 29
## 3466    29    25 bis 29
## 3467    35    35 bis 39
## 3468    37    35 bis 39
## 3469    32    30 bis 34
## 3470    28    25 bis 29
## 3471    29    25 bis 29
## 3472    36    35 bis 39
## 3473    33    30 bis 34
## 3474    35    35 bis 39
## 3475    33    30 bis 34
## 3476    33    30 bis 34
## 3477    29    25 bis 29
## 3478    35    35 bis 39
## 3479    27    25 bis 29
## 3480    39    35 bis 39
## 3481    26    25 bis 29
## 3482    35    35 bis 39
## 3483    27    25 bis 29
## 3484    31    30 bis 34
## 3485    39    35 bis 39
## 3486    39    35 bis 39
## 3487    34    30 bis 34
## 3488    25    25 bis 29
## 3489    39    35 bis 39
## 3490    35    35 bis 39
## 3491    27    25 bis 29
## 3492    34    30 bis 34
## 3493    36    35 bis 39
## 3494    36    35 bis 39
## 3495    32    30 bis 34
## 3496    27    25 bis 29
## 3497    29    25 bis 29
## 3498    33    30 bis 34
## 3499    28    25 bis 29
## 3500    30    30 bis 34
## 3501    26    25 bis 29
## 3502    36    35 bis 39
## 3503    24    20 bis 24
## 3504    30    30 bis 34
## 3505    30    30 bis 34
## 3506    35    35 bis 39
## 3507    29    25 bis 29
## 3508    41 40 und älter
## 3509    19     unter 20
## 3510    26    25 bis 29
## 3511    19     unter 20
## 3512    30    30 bis 34
## 3513    27    25 bis 29
## 3514    24    20 bis 24
## 3515    33    30 bis 34
## 3516    30    30 bis 34
## 3517    32    30 bis 34
## 3518    34    30 bis 34
## 3519    34    30 bis 34
## 3520    23    20 bis 24
## 3521    33    30 bis 34
## 3522    31    30 bis 34
## 3523    20    20 bis 24
## 3524    30    30 bis 34
## 3525    34    30 bis 34
## 3526    34    30 bis 34
## 3527    33    30 bis 34
## 3528    24    20 bis 24
## 3529    33    30 bis 34
## 3530    33    30 bis 34
## 3531    32    30 bis 34
## 3532    27    25 bis 29
## 3533    32    30 bis 34
## 3534    32    30 bis 34
## 3535    23    20 bis 24
## 3536    29    25 bis 29
## 3537    33    30 bis 34
## 3538    31    30 bis 34
## 3539    31    30 bis 34
## 3540    27    25 bis 29
## 3541    30    30 bis 34
## 3542    27    25 bis 29
## 3543    21    20 bis 24
## 3544    31    30 bis 34
## 3545    36    35 bis 39
## 3546    31    30 bis 34
## 3547    30    30 bis 34
## 3548    32    30 bis 34
## 3549    34    30 bis 34
## 3550    26    25 bis 29
## 3551    20    20 bis 24
## 3552    21    20 bis 24
## 3553    30    30 bis 34
## 3554    30    30 bis 34
## 3555    31    30 bis 34
## 3556    31    30 bis 34
## 3557    33    30 bis 34
## 3558    25    25 bis 29
## 3559    40 40 und älter
## 3560    31    30 bis 34
## 3561    30    30 bis 34
## 3562    32    30 bis 34
## 3563    29    25 bis 29
## 3564    20    20 bis 24
## 3565    24    20 bis 24
## 3566    26    25 bis 29
## 3567    34    30 bis 34
## 3568    30    30 bis 34
## 3569    24    20 bis 24
## 3570    28    25 bis 29
## 3571    32    30 bis 34
## 3572    24    20 bis 24
## 3573    26    25 bis 29
## 3574    37    35 bis 39
## 3575    32    30 bis 34
## 3576    30    30 bis 34
## 3577    25    25 bis 29
## 3578    24    20 bis 24
## 3579    21    20 bis 24
## 3580    23    20 bis 24
## 3581    24    20 bis 24
## 3582    33    30 bis 34
## 3583    39    35 bis 39
## 3584    30    30 bis 34
## 3585    29    25 bis 29
## 3586    33    30 bis 34
## 3587    26    25 bis 29
## 3588    32    30 bis 34
## 3589    37    35 bis 39
## 3590    31    30 bis 34
## 3591    39    35 bis 39
## 3592    33    30 bis 34
## 3593    30    30 bis 34
## 3594    28    25 bis 29
## 3595    30    30 bis 34
## 3596    32    30 bis 34
## 3597    21    20 bis 24
## 3598    31    30 bis 34
## 3599    23    20 bis 24
## 3600    24    20 bis 24
## 3601    24    20 bis 24
## 3602    21    20 bis 24
## 3603    17     unter 20
## 3604    37    35 bis 39
## 3605    26    25 bis 29
## 3606    28    25 bis 29
## 3607    26    25 bis 29
## 3608    24    20 bis 24
## 3609    32    30 bis 34
## 3610    32    30 bis 34
## 3611    28    25 bis 29
## 3612    26    25 bis 29
## 3613    33    30 bis 34
## 3614    32    30 bis 34
## 3615    22    20 bis 24
## 3616    31    30 bis 34
## 3617    21    20 bis 24
## 3618    29    25 bis 29
## 3619    27    25 bis 29
## 3620    25    25 bis 29
## 3621    33    30 bis 34
## 3622    20    20 bis 24
## 3623    31    30 bis 34
## 3624    30    30 bis 34
## 3625    33    30 bis 34
## 3626    23    20 bis 24
## 3627    34    30 bis 34
## 3628    30    30 bis 34
## 3629    37    35 bis 39
## 3630    29    25 bis 29
## 3631    24    20 bis 24
## 3632    35    35 bis 39
## 3633    32    30 bis 34
## 3634    22    20 bis 24
## 3635    28    25 bis 29
## 3636    29    25 bis 29
## 3637    33    30 bis 34
## 3638    26    25 bis 29
## 3639    25    25 bis 29
## 3640    34    30 bis 34
## 3641    29    25 bis 29
## 3642    30    30 bis 34
## 3643    33    30 bis 34
## 3644    29    25 bis 29
## 3645    33    30 bis 34
## 3646    29    25 bis 29
## 3647    18     unter 20
## 3648    27    25 bis 29
## 3649    35    35 bis 39
## 3650    22    20 bis 24
## 3651    32    30 bis 34
## 3652    19     unter 20
## 3653    32    30 bis 34
## 3654    34    30 bis 34
## 3655    30    30 bis 34
## 3656    28    25 bis 29
## 3657    26    25 bis 29
## 3658    33    30 bis 34
## 3659    43 40 und älter
## 3660    39    35 bis 39
## 3661    24    20 bis 24
## 3662    32    30 bis 34
## 3663    28    25 bis 29
## 3664    30    30 bis 34
## 3665    29    25 bis 29
## 3666    24    20 bis 24
## 3667    30    30 bis 34
## 3668    30    30 bis 34
## 3669    27    25 bis 29
## 3670    27    25 bis 29
## 3671    20    20 bis 24
## 3672    23    20 bis 24
## 3673    28    25 bis 29
## 3674    38    35 bis 39
## 3675    19     unter 20
## 3676    30    30 bis 34
## 3677    21    20 bis 24
## 3678    39    35 bis 39
## 3679    39    35 bis 39
## 3680    32    30 bis 34
## 3681    38    35 bis 39
## 3682    31    30 bis 34
## 3683    33    30 bis 34
## 3684    31    30 bis 34
## 3685    29    25 bis 29
## 3686    31    30 bis 34
## 3687    30    30 bis 34
## 3688    29    25 bis 29
## 3689    23    20 bis 24
## 3690    28    25 bis 29
## 3691    30    30 bis 34
## 3692    20    20 bis 24
## 3693    38    35 bis 39
## 3694    32    30 bis 34
## 3695    39    35 bis 39
## 3696    30    30 bis 34
## 3697    33    30 bis 34
## 3698    25    25 bis 29
## 3699    25    25 bis 29
## 3700    29    25 bis 29
## 3701    37    35 bis 39
## 3702    28    25 bis 29
## 3703    32    30 bis 34
## 3704    33    30 bis 34
## 3705    37    35 bis 39
## 3706    32    30 bis 34
## 3707    31    30 bis 34
## 3708    35    35 bis 39
## 3709    30    30 bis 34
## 3710    24    20 bis 24
## 3711    30    30 bis 34
## 3712    34    30 bis 34
## 3713    25    25 bis 29
## 3714    35    35 bis 39
## 3715    41 40 und älter
## 3716    34    30 bis 34
## 3717    29    25 bis 29
## 3718    34    30 bis 34
## 3719    34    30 bis 34
## 3720    38    35 bis 39
## 3721    33    30 bis 34
## 3722    24    20 bis 24
## 3723    28    25 bis 29
## 3724    33    30 bis 34
## 3725    23    20 bis 24
## 3726    33    30 bis 34
## 3727    33    30 bis 34
## 3728    26    25 bis 29
## 3729    24    20 bis 24
## 3730    27    25 bis 29
## 3731    39    35 bis 39
## 3732    29    25 bis 29
## 3733    35    35 bis 39
## 3734    36    35 bis 39
## 3735    28    25 bis 29
## 3736    28    25 bis 29
## 3737    27    25 bis 29
## 3738    34    30 bis 34
## 3739    40 40 und älter
## 3740    23    20 bis 24
## 3741    24    20 bis 24
## 3742    30    30 bis 34
## 3743    33    30 bis 34
## 3744    31    30 bis 34
## 3745    30    30 bis 34
## 3746    25    25 bis 29
## 3747    36    35 bis 39
## 3748    25    25 bis 29
## 3749    34    30 bis 34
## 3750    35    35 bis 39
## 3751    27    25 bis 29
## 3752    20    20 bis 24
## 3753    31    30 bis 34
## 3754    28    25 bis 29
## 3755    29    25 bis 29
## 3756    33    30 bis 34
## 3757    33    30 bis 34
## 3758    29    25 bis 29
## 3759    34    30 bis 34
## 3760    29    25 bis 29
## 3761    32    30 bis 34
## 3762    28    25 bis 29
## 3763    33    30 bis 34
## 3764    26    25 bis 29
## 3765    29    25 bis 29
## 3766    29    25 bis 29
## 3767    32    30 bis 34
## 3768    27    25 bis 29
## 3769    29    25 bis 29
## 3770    30    30 bis 34
## 3771    30    30 bis 34
## 3772    24    20 bis 24
## 3773    31    30 bis 34
## 3774    30    30 bis 34
## 3775    34    30 bis 34
## 3776    39    35 bis 39
## 3777    27    25 bis 29
## 3778    24    20 bis 24
## 3779    33    30 bis 34
## 3780    35    35 bis 39
## 3781    30    30 bis 34
## 3782    30    30 bis 34
## 3783    32    30 bis 34
## 3784    22    20 bis 24
## 3785    20    20 bis 24
## 3786    24    20 bis 24
## 3787    37    35 bis 39
## 3788    35    35 bis 39
## 3789    22    20 bis 24
## 3790    22    20 bis 24
## 3791    31    30 bis 34
## 3792    31    30 bis 34
## 3793    36    35 bis 39
## 3794    26    25 bis 29
## 3795    27    25 bis 29
## 3796    32    30 bis 34
## 3797    36    35 bis 39
## 3798    25    25 bis 29
## 3799    37    35 bis 39
## 3800    32    30 bis 34
## 3801    30    30 bis 34
## 3802    31    30 bis 34
## 3803    30    30 bis 34
## 3804    35    35 bis 39
## 3805    33    30 bis 34
## 3806    33    30 bis 34
## 3807    28    25 bis 29
## 3808    30    30 bis 34
## 3809    29    25 bis 29
## 3810    23    20 bis 24
## 3811    33    30 bis 34
## 3812    30    30 bis 34
## 3813    26    25 bis 29
## 3814    23    20 bis 24
## 3815    35    35 bis 39
## 3816    29    25 bis 29
## 3817    31    30 bis 34
## 3818    26    25 bis 29
## 3819    35    35 bis 39
## 3820    27    25 bis 29
## 3821    39    35 bis 39
## 3822    30    30 bis 34
## 3823    30    30 bis 34
## 3824    20    20 bis 24
## 3825    37    35 bis 39
## 3826    29    25 bis 29
## 3827    35    35 bis 39
## 3828    33    30 bis 34
## 3829    29    25 bis 29
## 3830    19     unter 20
## 3831    32    30 bis 34
## 3832    30    30 bis 34
## 3833    28    25 bis 29
## 3834    28    25 bis 29
## 3835    32    30 bis 34
## 3836    24    20 bis 24
## 3837    24    20 bis 24
## 3838    27    25 bis 29
## 3839    31    30 bis 34
## 3840    39    35 bis 39
## 3841    24    20 bis 24
## 3842    35    35 bis 39
## 3843    31    30 bis 34
## 3844    28    25 bis 29
## 3845    19     unter 20
## 3846    31    30 bis 34
## 3847    30    30 bis 34
## 3848    27    25 bis 29
## 3849    25    25 bis 29
## 3850    25    25 bis 29
## 3851    27    25 bis 29
## 3852    26    25 bis 29
## 3853    32    30 bis 34
## 3854    43 40 und älter
## 3855    18     unter 20
## 3856    38    35 bis 39
## 3857    40 40 und älter
## 3858    28    25 bis 29
## 3859    28    25 bis 29
## 3860    22    20 bis 24
## 3861    32    30 bis 34
## 3862    30    30 bis 34
## 3863    25    25 bis 29
## 3864    33    30 bis 34
## 3865    39    35 bis 39
## 3866    21    20 bis 24
## 3867    23    20 bis 24
## 3868    35    35 bis 39
## 3869    29    25 bis 29
## 3870    41 40 und älter
## 3871    30    30 bis 34
## 3872    31    30 bis 34
## 3873    22    20 bis 24
## 3874    26    25 bis 29
## 3875    36    35 bis 39
## 3876    36    35 bis 39
## 3877    29    25 bis 29
## 3878    24    20 bis 24
## 3879    36    35 bis 39
## 3880    39    35 bis 39
## 3881    22    20 bis 24
## 3882    35    35 bis 39
## 3883    28    25 bis 29
## 3884    33    30 bis 34
## 3885    27    25 bis 29
## 3886    25    25 bis 29
## 3887    31    30 bis 34
## 3888    32    30 bis 34
## 3889    35    35 bis 39
## 3890    27    25 bis 29
## 3891    24    20 bis 24
## 3892    22    20 bis 24
## 3893    24    20 bis 24
## 3894    23    20 bis 24
## 3895    31    30 bis 34
## 3896    30    30 bis 34
## 3897    32    30 bis 34
## 3898    23    20 bis 24
## 3899    21    20 bis 24
## 3900    32    30 bis 34
## 3901    22    20 bis 24
## 3902    34    30 bis 34
## 3903    23    20 bis 24
## 3904    32    30 bis 34
## 3905    37    35 bis 39
## 3906    40 40 und älter
## 3907    32    30 bis 34
## 3908    30    30 bis 34
## 3909    28    25 bis 29
## 3910    23    20 bis 24
## 3911    33    30 bis 34
## 3912    35    35 bis 39
## 3913    22    20 bis 24
## 3914    24    20 bis 24
## 3915    39    35 bis 39
## 3916    29    25 bis 29
## 3917    30    30 bis 34
## 3918    34    30 bis 34
## 3919    31    30 bis 34
## 3920    30    30 bis 34
## 3921    31    30 bis 34
## 3922    20    20 bis 24
## 3923    31    30 bis 34
## 3924    37    35 bis 39
## 3925    24    20 bis 24
## 3926    31    30 bis 34
## 3927    31    30 bis 34
## 3928    33    30 bis 34
## 3929    37    35 bis 39
## 3930    30    30 bis 34
## 3931    28    25 bis 29
## 3932    36    35 bis 39
## 3933    20    20 bis 24
## 3934    26    25 bis 29
## 3935    28    25 bis 29
## 3936    28    25 bis 29
## 3937    33    30 bis 34
## 3938    25    25 bis 29
## 3939    31    30 bis 34
## 3940    34    30 bis 34
## 3941    26    25 bis 29
## 3942    22    20 bis 24
## 3943    37    35 bis 39
## 3944    27    25 bis 29
## 3945    37    35 bis 39
## 3946    32    30 bis 34
## 3947    29    25 bis 29
## 3948    31    30 bis 34
## 3949    25    25 bis 29
## 3950    38    35 bis 39
## 3951    23    20 bis 24
## 3952    32    30 bis 34
## 3953    32    30 bis 34
## 3954    30    30 bis 34
## 3955    27    25 bis 29
## 3956    35    35 bis 39
## 3957    36    35 bis 39
## 3958    31    30 bis 34
## 3959    19     unter 20
## 3960    27    25 bis 29
## 3961    39    35 bis 39
## 3962    36    35 bis 39
## 3963    32    30 bis 34
## 3964    31    30 bis 34
## 3965    27    25 bis 29
## 3966    31    30 bis 34
## 3967    20    20 bis 24
## 3968    33    30 bis 34
## 3969    42 40 und älter
## 3970    34    30 bis 34
## 3971    34    30 bis 34
## 3972    35    35 bis 39
## 3973    22    20 bis 24
## 3974    21    20 bis 24
## 3975    35    35 bis 39
## 3976    28    25 bis 29
## 3977    19     unter 20
## 3978    23    20 bis 24
## 3979    32    30 bis 34
## 3980    37    35 bis 39
## 3981    30    30 bis 34
## 3982    24    20 bis 24
## 3983    29    25 bis 29
## 3984    32    30 bis 34
## 3985    24    20 bis 24
## 3986    22    20 bis 24
## 3987    23    20 bis 24
## 3988    35    35 bis 39
## 3989    22    20 bis 24
## 3990    20    20 bis 24
## 3991    35    35 bis 39
## 3992    24    20 bis 24
## 3993    36    35 bis 39
## 3994    26    25 bis 29
## 3995    32    30 bis 34
## 3996    30    30 bis 34
## 3997    24    20 bis 24
## 3998    27    25 bis 29
## 3999    33    30 bis 34
## 4000    29    25 bis 29
```
]
]

---
----
## Hands-On: Conditional Statements: case_when und ifelse

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Erstelle den Datensatz `geburten_nat_eltern` aus dem `geburten` Datensatz:
- **Spalten auswählen:** behalte nur stat_jahr, nat_m und nat_V
- **Filtern:** nur Daten behalten die keine NAs in nat_m oder nat_V enthalten (Staatsangehörigkeit Mutter und Vater) besitzen

Verwende Conditional Statements um die neue Variable `eltern_nat_type` zu erstellen:
- Wenn **beide Elternteile Ausländer** sind, soll **"beide Elternteile Ausländer"** eingetragen werden  
- Wenn **beide Elternteile Schweizer** sind, soll **"beide Elternteile Schweizer"** eingetragen werden    
- Wenn der **Vater Ausländer** ist, soll **"Vater Ausländer"** eingetragen werden                       
- Wenn die **Mutter Ausländerin** ist, soll **"Mutter Ausländer"** eingetragen werden                           
- Wenn **keine der Kategorien zutrifft** soll **"unbekannt"** eingetragen werden (Kontrolle) 


---
----

## baseR: if...else

- eine andere Form von `Conditional Statements` ist die in anderen Sprachen oft verwendete `if...else` Notierung
- diese wird vor allem in Loops und Funktionen  verwendet
- ein `if` braucht in R nicht zwingend ein `else` 

.panelset[
.panel[.panel-name[mit else]


```r
x = 3

if (x %% 2 == 0){
  print("x ist eine gerade Zahl")
} else {
  print("x ist eine ungerade Zahl")
}
```

```
## [1] "x ist eine ungerade Zahl"
```

]
.panel[.panel-name[ohne else]

```r
x = 4

if (x %% 2 == 0){
  print("x ist eine gerade Zahl")
}
```

```
## [1] "x ist eine gerade Zahl"
```
]
]



---
----

## baseR: if...else

.panelset[
.panel[.panel-name[Bsp. 1]
Ein `else` Statement ist nicht unbedingt notwendig, wenn nur in einem einzigen Prüffall etwas unternommen werden soll

```r
x = 3

if (x %% 2 != 0){
  x &lt;- x+1
} 

x
```

```
## [1] 4
```

]
.panel[.panel-name[Bsp. 2]
Wenn mehrere, sich gegenseitig ausschliessende Bedingungen abgeprüft werden sollen, kann die spezielle `else if` Schreibweise verwendet werden


```r
alter &lt;- 45

if (alter &gt;= 70) {
  altersklasse &lt;- "70 und älter"
} else if (alter &gt;= 50) {
  altersklasse &lt;- "50 bis 69"
} else if (alter &gt;= 30) {
  altersklasse &lt;- "30 bis 49"
}
print(altersklasse)
```

```
## [1] "30 bis 49"
```
]

.panel[.panel-name[Bsp. 3]
Für kompliziertere Prüfungen können `if` statements auch verschachtelt werden

```r
dienstjahre &lt;- 5
bewertung &lt;- "Gut"

if (bewertung == "Sehr gut"){
  bonus &lt;- 5000
} else if (bewertung == "Gut"){
  if (dienstjahre&gt;=10){
    bonus &lt;- 3000
  } else {
    bonus &lt;- 2500
  }
} else {
  bonus &lt;- 0
}
```

]
]
---


























----
## baseR: loops und apply

- grundlegender Baustein in allen Programmiersprachen

- wird verwendet um Code wiederholt auszuführen (Loop = Schleife)

- ist dort nützlich, wo es vieler Iterationen bedarf

- in allen Programmiersprachen gibt es `for` und `while` Loops

- R bietet zusätzlich noch die Funktionen aus der `apply` Familie, die ein ähnliches Ergebnis liefern

- Wenn man einen Loop erstellen möchte, beginnt man am besten damit, den gewünschten Arbeitsablauf auf *ein* Listenelement anzuwenden.

---
----

## baseR: for-loop

.pull-left[
**Für jedes Element `i` in Vektor `x` führe Hauptteil aus**
&lt;br&gt;
&lt;br&gt;
`for` Loops bestehen aus zwei Bestandteilen:
  1. eine Kopfzeile, die die Anzahl an Iterationen angibt (in runden Klammern `()`)
  2. einen Hauptteil, der einen Codeblock enthält, der bei jeder Iteration einmal ausgeführt wird (in geschweiften Klammern `{}`)



```r
for (i in x){ # Kopfzeile
   # Hauptteil
  do_something()
}
```
  
]
.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/forloop.png" alt="https://universeofdatascience.com/wp-content/uploads/2021/06/Loops_in_R-1024x576.png" width="70%" /&gt;
&lt;p class="caption"&gt;https://universeofdatascience.com/wp-content/uploads/2021/06/Loops_in_R-1024x576.png&lt;/p&gt;
&lt;/div&gt;

]


---
----

## baseR: for-loop

.panelset[
.panel[.panel-name[Bsp. 1]
- Zuweisungen sind essentiell bei Loops
- Wenn Daten nicht zugewiesen werden sind sie nachher nicht im  Environment verfügbar
- Zuweisungen die ausschliesslich innerhalb des loops geschehen sind nicht im globalen environment verfügbar

```r
for (i in 1:3){
  temp &lt;- paste0("Iteration Nr. ",i)
}
temp
```

```
## [1] "Iteration Nr. 3"
```

]
.panel[.panel-name[Bsp. 2]
- Elemente können auch direkt verwendet werden

```r
new_list &lt;- list()
for (elem in c("A","B","C")){
  new_list[[elem]] &lt;- tolower(elem)
}
new_list
```

```
## $A
## [1] "a"
## 
## $B
## [1] "b"
## 
## $C
## [1] "c"
```
]
.panel[.panel-name[Bsp. 3]
- mit `seq_along` werden die Indizes (=Positionen) für einen Vektor gebildet


```r
vec &lt;- c("A","B","C")
for (i in seq_along(vec)){
  print(paste0(vec[i],i))
}
```

```
## [1] "A1"
## [1] "B2"
## [1] "C3"
```
]
]

---
----

## baseR: while-loop

.pull-left[
**Solange `i` kleiner gleich `y`  führe Hauptteil aus und erhöhe `i` anschliessend um 1**
&lt;br&gt;
&lt;br&gt;
- `while` Loops können, wenn fehlerhaft programmiert, unendlich lange laufen
- der Parameter `i` muss in diesem Fall vor dem Loop initialisiert werden




```r
i = 1
while (i &lt;= y){
  do_something()
  i=i+1
}
```
  
]
.pull-right[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/whileloop.png" alt="https://universeofdatascience.com/wp-content/uploads/2021/06/Loops_in_R-1024x576.png" width="70%" /&gt;
&lt;p class="caption"&gt;https://universeofdatascience.com/wp-content/uploads/2021/06/Loops_in_R-1024x576.png&lt;/p&gt;
&lt;/div&gt;

]

---
----
## baseR: while-loop

.panelset[
.panel[.panel-name[Bsp. 1]
Wie oft wird `"Hello World"` im unten stehenden while Loop ausgegeben?

```r
y = 3
i = 1

while (i &lt;= y){
  print("Hello World")
}
```

]
.panel[.panel-name[Lösung. 1]
Abbruchbedingungen müssen korrekt initialisert werden um einen unendlichen Loop zu vermeiden

```r
y = 3
i = 1

while (i &lt;= y){
  print("Hello World")
  i &lt;- i+1
}
```

```
## [1] "Hello World"
## [1] "Hello World"
## [1] "Hello World"
```
]
]


---
----
## baseR: Loops und Conditional Statements
- kombiniert sind Loops und Conditional Statements mächtige Werkzeuge in R
- elementar sind dafür die Befehle `break` und `next`

.panelset[
.panel[.panel-name[break]
Mit `break` kann ein Loop an einer bestimmten Stelle (z.B. bei Erfüllung einer bestimmten Bedingung) vorzeitigabgebrochen werden.

```r
for (i in c(1,3,6,8)){
  if (i %% 2 == 0){
    print(i)
    break
  }
}
```

```
## [1] 6
```

]
.panel[.panel-name[next]
Mit `next` kann zur nächsten Iteration gesprungen werden ohne den gesamten Codebody auszuführen

```r
for (i in c(1,2,3,5)){
  if (i %% 2 == 0){
    next # alles nach dieser Zeile wird übersprungen
  }
  print(i)
}
```

```
## [1] 1
## [1] 3
## [1] 5
```
]

]

---
----

## Hands-On: Loops und Conditional Statements


.panelset[
.panel[.panel-name[Aufgabe]
Lade den Datensatz `Daten/firma.rds` und berechne die jährlichen Auszahlungsbeträge pro Mitarbeiter inklusive Boni:

- Mitarbeiter mit einem Monatslohn über 10000 bekommen keinen Bonus
- **Sehr Gut** bewertete Mitarbeiter bekommen einen Bonus in Höhe von **70% ihres Monatseinkommens**
- **Gut** bewertete Mitarbeiter bekommen einen Bonus von **40% ihres Monatseinkommens**, bei **10 oder mehr Dienstjahren** bekommen sie **50%**
- Bewertungen, die weder `Gut` noch `Sehr Gut` sind bekommen den Standardbonus von **300 CHF**

&lt;p&gt;Schreibe einen Loop, welcher eine Liste befüllt mit dem String "NAME erhält AUSZAHLUNG CHF im Jahr inkl. Bonus" für jede/n MitarbeiterIn im Datensatz.&lt;/p&gt;
&lt;p&gt;Sollte ein/e MitarbiertIn keinen Bonus erhalten, sollte der String wie folgt aussehen: "NAME erhält AUSZAHLUNG CHF im Jahr. NAME erhält keinen Bonus"&lt;/p&gt;

]
.panel[.panel-name[Tipps]
**Tipps:**
- Nutze einen for loop
- Arbeite die Bedingungen der Reihe nach ab
- Verwende verschachtelte if Statements, wenn mehrere bedingungen erfüllt sein müssen
]

.panel[.panel-name[Ergebnis]

```
## [[1]]
## [1] "Marta erhält 144000 CHF im Jahr. Marta erhält keinen Bonus."
## 
## [[2]]
## [1] "Mario erhält 120650 CHF im Jahr inkl. Bonus."
## 
## [[3]]
## [1] "Miro erhält 76200 CHF im Jahr inkl. Bonus."
## 
## [[4]]
## [1] "Moni erhält 52080 CHF im Jahr inkl. Bonus."
## 
## [[5]]
## [1] "Theo erhält 192000 CHF im Jahr. Theo erhält keinen Bonus."
## 
## [[6]]
## [1] "Karla erhält 90300 CHF im Jahr inkl. Bonus."
```
]
]


---
----
## apply vs. loops

Die apply-Famile bietet eine Alternative zu klassischen loops.


.panelset[
.panel[.panel-name[Vorteile]

- man benötigt deutlich weniger Code (keine Zuweisungen, Counter, Abbruchbedingungen etc.)

- beugt dem Erzeugen von "Spaghetti-Code" vor, da leichter lesbar

- Variablen innerhalb der Funktion werden nicht im Global Environment gespeichert (keine Gefahr der versehentlichen Überschreibung)

]
.panel[.panel-name[Nachteile]

- kompliziertere Abläufe können mit den apply Funktionen nicht nativ realisiert werden

- klassische Loops können viel feiner definiert werden

- Es können Iterationen erzeugt werden, bei denen das Ergebnis auf der vorigen Iteration beruht

**Ein generelles Ablehnen von Loops, wie es von manchen Autoren propagiert wird ist mMn Quatsch!**
]
]

---
----
## Die apply-Familie

Aus der Erfahrung sind `lapply, sapply` und `apply` die am meisten genutzen Funktionen.

.panelset[
.panel[.panel-name[lapply]
Anwendung einer Funktion auf jedes Element einer Liste/eines Vektors und gibt eine Liste zurück.


```r
num_list &lt;- list(a = c(3,8,6), b = c(1,15,3), c = c(32,15,16))

lapply(num_list, mean)
```

```
## $a
## [1] 5.666667
## 
## $b
## [1] 6.333333
## 
## $c
## [1] 21
```

]
.panel[.panel-name[sapply]
Gleiche Funktionsweise wie `lapply`, gibt aber - wenn möglich - einen Vektor und sonst eine Matrix als Ergebnis zurück.


```r
sapply(num_list, mean)
```

```
##         a         b         c 
##  5.666667  6.333333 21.000000
```
]
.panel[.panel-name[tapply &amp; aggregate]
Berechnung einer Kennzahl (mean, median, min, max, etc.) für jede Faktor-Variable in einem Vektor.

```r
df &lt;- data.frame(fac = c("a","a","b","b","c","c"),
                num = c(4,8,6,5,7,9))

tapply(df$num, as.factor(df$fac),mean)
```

```
##   a   b   c 
## 6.0 5.5 8.0
```

]
.panel[.panel-name[mapply]
Anwendung einer Funktion auf die korrespondierenden Elemente von mehreren Listen.

```r
num_list &lt;- list(a = c(3,8,6), b = c(1,15,3), c = c(32,15,16))
num_list2 &lt;- list(a = c(1,2,3), b = c(4,5,6), c = c(7,8,9))

mapply(sum, num_list, num_list2)
```

```
##  a  b  c 
## 23 34 87
```

]
.panel[.panel-name[apply]
Anwendung einer Funktion auf die Elemente eines data.frames oder einer Matrix. Gibt Vektor oder Liste zurück.
Apply kann entweder reihenweise, spaltenweise oder elementweise operieren.

```r
df &lt;- data.frame(fac = c("a","a","b","b","c","c"),
                num = c(4,8,6,5,7,9))

apply(df, 1, paste0, collapse="_")
```

```
## [1] "a_4" "a_8" "b_6" "b_5" "c_7" "c_9"
```
]
]

---
----
## Die apply-Familie: Syntax

In allen Funktionen aus der `apply`-Familie können Funktionen mit oder ohne Parameter oder eigene sog. [anonymus functions](https://coolbutuseless.github.io/2019/03/13/anonymous-functions-in-r-part-1/) verwednet werden.
.panelset[
.panel[.panel-name[Generell]
Bei allen `apply`-Funktionen muss ein Objekt (oder mehrere) sowie eine Funktion angegeben werden, welche auf die Elemente des Objekts angewendet wird.

Bei `lapply` kann dies eine Liste oder ein Vektor sein, welche als erstes Argument an die Funktion mitgegeben wird. Das zweite Argument ist die Funktion.


```r
# Generell
lapply(vec_or_list, func)
```
]
.panel[.panel-name[Ohne Args.]
Wenn keine zusätzlichen Argumente für diei Funktion benötigt werden (z.B. `mean()`), kann die Funktion einfach **ohne Klammern** als Argument mitgegeben werden.


```r
# Keine Argumente
lapply(num_list, mean)
```

```
## $a
## [1] 5.666667
## 
## $b
## [1] 6.333333
## 
## $c
## [1] 21
```
]
.panel[.panel-name[Mit Args.]
Argumente, welche normalerweise in die Klammer hinter der Funktion geschrieben werden (`mean(.,na.rm=TRUE)`), werden im Falle von `apply`-Funktionen mit Komma getrennt aufgelistet (`mean,na.rm=TRUE`)


```r
# Mit Argumenten
lapply(num_list[1:2], mean,na.rm=TRUE)
```

```
## $a
## [1] 5.666667
## 
## $b
## [1] 6.333333
```
]
.panel[.panel-name[Anonym. (1)]
[Anonymus Functions](https://coolbutuseless.github.io/2019/03/13/anonymous-functions-in-r-part-1/) (auch *lambda expression* genannt) sind Funktionen, denen kein Name zugeordnet wird und die nur im Zusammehang der apply Funktion existieren


```r
# Mit Argumenten
lapply(num_list[1:2], function(x){
  temp &lt;- paste0("Die Summe ist ",sum(x))
  return(temp)
})
```

```
## $a
## [1] "Die Summe ist 17"
## 
## $b
## [1] "Die Summe ist 19"
```
]
.panel[.panel-name[Anonym. (2)]
Um den Code übersichtlicher zu gestalten und die ungewohnte Schreibweise mit der Kommatrenung zu vermeiden, können auch andere Funktionen als `Anonymus Functions` notiert werden.  


```r
# Mit Argumenten
lapply(num_list[1:2], function(x){
  mean(x,na.rm=TRUE)
})
```

```
## $a
## [1] 5.666667
## 
## $b
## [1] 6.333333
```

]
]
---
----
## Anwendungsbeispiel: Mehrere Files einlesen





```r
abstimmungen_path &lt;- "Daten/Ebene_Gemeinden" 
csv_files &lt;- list.files(path = abstimmungen_path, pattern = "*.csv", full.names = T) 
```
Alle gezeigten Beispiele liefern dasselbe Ergebnis

.panelset[
.panel[.panel-name[for-loop]

```r
for_list &lt;- list()
for(file in csv_files){
  for_list[[file]] &lt;- read_csv2(file,
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
}
```

]
.panel[.panel-name[while-loop]

```r
while_list &lt;- list()
i = 1
while(i &lt;= length(csv_files)){
  while_list[[i]] &lt;- read_csv2(csv_files[i],
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
  i = i + 1
}
```

]
.panel[.panel-name[lapply]

```r
lapply_list &lt;- lapply(csv_files,function(file){
  df &lt;- read_csv2(file,
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
  return(df)
})
```

]
]
---
----
## Hands-On: apply-Funktionen

*Gegeben ist ein Auszug aus dem Mikrezensus Mobilität und Verkehr 2021 (haush_sample.rds) sowie eine Liste von Fahrzeugklassen*

Für jede Fahrzeuklasse soll ein Datensatz erstellt werden, welcher den Mittelwert und die Gesamtnzahl der Fahrzeuge in der entsprechenden Fahrzeugklasse pro Bezirk enthält. Verwende eine passende apply Funktion.

**Erläuterung:**
- Reihen bei denen die Anzahl kleiner 0 ist sind `NAs` und müssen entfernt werden
- filtere die entsprechende Fahrzeugklasse
- gruppiere die Daten nach Bezirk
- nutze summarise um die Kennzahlen zu errechnen

**TIPP:** Wenn man Funktionen in einem Loop oder einer apply Funktion verwenden möchte, beginnt man am besten damit, die Funktion auf *ein* Listenelement anzuwenden. Anschliessend kann man den Arbeitsablauf in eine Schleife packen. 



---
----
## purrr: Iterationen im tidyverse

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Mit den `map` Funktionen aus dem `purrr` Package können ebenfalls schleifenartige Iterationen durchgeführt werden (wie `apply`).

- Der Vorteil gegenüber `apply` Funktionen und klassischen Loops liegt darin, dass `map` Funktionen in eine mit `%&gt;%` oder `|&gt;` erzeugte Pipeline integriert werden können

- Link zum [Cheatsheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/purrr.pdf)

.panelset[
.panel[.panel-name[for-loop]

```r
for_list &lt;- list()
for(file in csv_files){
  for_list[[file]] &lt;- read_csv2(file,
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
}
```

]
.panel[.panel-name[while-loop]

```r
while_list &lt;- list()
i = 1
while(i &lt;= length(csv_files)){
  while_list[[i]] &lt;- read_csv2(csv_files[i],
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
  i = i + 1
}
```

]
.panel[.panel-name[lapply]

```r
lapply_list &lt;- lapply(csv_files,function(file){
  df &lt;- read_csv2(file,
                  locale = locale(encoding = "latin1"),
                  col_types = cols(.default = "c"))
  return(df)
})
```

]
.panel[.panel-name[map]

```r
map_list &lt;- csv_files %&gt;% 
  map(read_csv2,
      locale = locale(encoding = "latin1"),
      col_types = cols(.default = "c"))
```
]
]

---
----
## purr: Tilde-Punkt Notierung für Funktionen

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- Um den Code übersichtlicher zu gestalten, kann die die Tilde-Punkt-Verknüpfung für anonyme Funktionen verwenden 

**Aus**

```r
function(x){
  sum(x)
}
```

**wird** 


```r
~{sum(.x)}
```

Diese Schreibweise ist kein Muss, wird aber bei `purrr` oft verwendet. Es ist daher wichtig zu verstehen, was diese Schreibweise bedeutet, um nachher z.B. Beiträge auf `StackOverflow` verstehen zu können.

---
----
## purrr::map()

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- je nach gewünschtem Output unterscheiden sich die `map` Funktionen

.panelset[
.panel[.panel-name[map]
- `map` ist im Prinzip äquivalent zu `lapply`

```r
# Liste von CSV files einlesen
# Wir erhalten eine Liste von data.frames bzw. tibbles
map_list &lt;- csv_files %&gt;% 
  map(read_csv2,
      locale = locale(encoding = "latin1"),
      col_types = cols(.default = "c"))

class(map_list)
```

```
## [1] "list"
```

]
.panel[.panel-name[map_df (1)]

```r
# Ja Anteil nach Bezirk berechnen und alles in einen zusammenhängenden Datensatz schreiben
map_dataframe &lt;- map_list %&gt;% 
  map_df(~ .x %&gt;% 
           group_by(DATUM_ABSTIMMUNG,VORLAGE_BEZEICHNUNG,BEZIRK_NAME) %&gt;% 
           summarise(eing_stimmen = sum(as.numeric(EINGELEGTE_STIMMEN)),
                     ja = sum(as.numeric(JA_STIMMEN))) %&gt;% 
           mutate(ja_vote = ja/eing_stimmen))

class(map_dataframe)
```

```
## [1] "grouped_df" "tbl_df"     "tbl"        "data.frame"
```

]
.panel[.panel-name[map_df (2)]

```r
head(map_dataframe,5)
```

```
## # A tibble: 5 × 6
## # Groups:   DATUM_ABSTIMMUNG, VORLAGE_BEZEICHNUNG [1]
##   DATUM_ABSTIMMUNG VORLAGE_BEZEICHNUNG    BEZIRK_NAME eing_stimmen    ja ja_vote
##   &lt;chr&gt;            &lt;chr&gt;                  &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 16.05.2004       Gesetz zum Vollzug de… Arbon              10234  3938   0.385
## 2 16.05.2004       Gesetz zum Vollzug de… Bischofsze…         7496  2925   0.390
## 3 16.05.2004       Gesetz zum Vollzug de… Diessenhof…         1879   750   0.399
## 4 16.05.2004       Gesetz zum Vollzug de… Frauenfeld         12437  5431   0.437
## 5 16.05.2004       Gesetz zum Vollzug de… Kreuzlingen         8981  3621   0.403
```

]
.panel[.panel-name[map_chr]
- bei `map_chr` muss das Ergebnis der Funktion innerhalb von `map_chr` immer die Länge `1` haben. Sonst kann kein Vektor erstellt werden

```r
# Namen der einzelnen Vorlagen extrahieren als vektor
map_character &lt;- map_list %&gt;% 
  map_chr(~ .x[["VORLAGE_BEZEICHNUNG"]] %&gt;% unique())

map_character[c(1:4)]
```

```
## [1] "Gesetz zum Vollzug der Bundesgesetzgebung über den Erwerb von Grundstücken durch Personen im Ausland"                                   
## [2] "Beschulss des Grossen Rates über das Kreditbegehren von 28.2 Mio. Franken für den Erweiterungsbau des Berufsbildungszentrums Weinfelden"
## [3] "Beschluss des Grossen Rates über das Kreditbegehren von 11'950'000 Franken für den Neubau des Verwaltungsgebäudes II in Frauenfeld"     
## [4] "Beschluss des Grossen Rates betreffend Erweiterung des Strassennetzes durch eine neue Kantonsstrasse (\"Südumfahrung Kreuzlinge\")"
```
]
.panel[.panel-name[map_dbl]
- bei `map_dbl` muss das Ergebnis der Funktion innerhalb von `map_dbl` immer ein einzelner `double` (Fliesskommazahl oder Integer) sein.

```r
# Gesamtanzahl der Stimmberechtigten bei den jeweiligen Abstimmungen
map_double &lt;- map_list %&gt;% 
  map_dbl(~ sum(as.numeric(.x$STIMMBERECHTIGTE)))

map_double
```

```
##  [1] 145312 145946 146648 147242 147242 148022 148022 148474 148474 151082
## [11] 151082 152610 153000 153477 153477 154304 154304 154785 155001 156757
## [21] 156757 156757 157174 157174 157174 157174 157174 157917 159165 159907
## [31] 159907 165730 166492 166796
```
]
]
---
----
## purrr: Weitere nützliche Funktionen

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- `purrr` beinhaltet noch einige weitere nützliche Funktionen, vor allem im Umgang mit `Listen`

.panelset[
.panel[.panel-name[keep]
`keep` behält nur die Elemente, die eine bestimmte Bedingung erfüllen 

```r
# Abstimmungen mit im Schnitt mehr als 50% Stimmbeteiligung pro gGemeinde
hohe_beteiligung &lt;- map_list %&gt;% 
  keep(~{mean(as.numeric(.x[["STIMMBETEILIGUNG"]]))&gt;50})
length(map_list)
```

```
## [1] 34
```

```r
length(hohe_beteiligung)
```

```
## [1] 6
```
]
.panel[.panel-name[discard]
`discard` bildet das gegenstück zu `keep`

```r
# Abstimmungen mit im Schnitt 50% oder weniger Stimmbeteiligung pro Gemeinde
niedrige_beteiligung &lt;- map_list %&gt;% 
  discard(~{mean(as.numeric(.x[["STIMMBETEILIGUNG"]]))&gt;50})
length(hohe_beteiligung)
```

```
## [1] 6
```

```r
length(niedrige_beteiligung)
```

```
## [1] 28
```

]
.panel[.panel-name[every]
Trifft Bedingung auf **jedes** Element der Liste zu?

```r
# Ist die durchschnittliche Stimmbeteilung in den Gemeinden immer über 30%?
map_list %&gt;% 
  some(~{mean(as.numeric(.x[["STIMMBETEILIGUNG"]]))&gt;30})
```

```
## [1] TRUE
```

]
.panel[.panel-name[some]
Trifft Bedingung auf **mindestens ein** Element der Liste zu?

```r
# Gibt es Abstimmungen mit durchschnittlicher Stimmbeteilung in den Gemeinden von über 70%?
map_list %&gt;% 
  some(~{mean(as.numeric(.x[["STIMMBETEILIGUNG"]]))&gt;70})
```

```
## [1] FALSE
```
]
]

---
----
## purrr: Weitere nützliche Funktionen

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- `purrr` beinhaltet noch einige weitere nützliche Funktionen, vor allem im Umgang mit `Listen`

.panelset[
.panel[.panel-name[pluck (1)]
`pluck` hilft dabei auf Elemente in einer Liste zuzugreifen. Besonders hilfreich ist dies wenn Listen stark verschachtelt sind

```r
nested_list &lt;-
  list(
    a = list(1, 2, 3),
    b = list(b1 = c("a","b"), 
             b2 = TRUE),
    c = list(c1 = list(c1_1 = c(1, 2, 3, 4), 
                       c1_2 = c("h", "i", "j")
    ))
  )
```
]
.panel[.panel-name[pluck (2)]
Es kann Ebene für Ebene das Element nach Namen ausgewählt werden

```r
nested_list %&gt;% 
  pluck("b","b1")
```

```
## [1] "a" "b"
```

```r
# Gleich wie nested_list[["b"]][["b1"]]
```
]
.panel[.panel-name[pluck (3)]
Ebenso können auch die Indizes der einzelnen Listen verwendet werden

```r
nested_list %&gt;% 
  pluck(2,1)
```

```
## [1] "a" "b"
```

```r
# Gleich wie nested_list[[2]][[1]]
```
]
.panel[.panel-name[pluck (4)]
Wenn ein Element nicht existiert, wird kein `Error`, sondern `NULL` zurückgegeben (Vorteil wenn man es z.B. in Funktionen verwendet)

```r
nested_list %&gt;% 
  pluck(2,1)
```

```
## [1] "a" "b"
```

```r
# Gleich wie nested_list[[2]][[1]]
```
]
.panel[.panel-name[pluck (5)]
Listen Werte können auch gesetzt werden

```r
#set
pluck(nested_list,2,1) &lt;- "test"
#get
nested_list %&gt;% 
  pluck(2,1) 
```

```
## [1] "test"
```
]
]

---
----

## Hands-On: purrr¨

**Aufgabe:**

Im Aufgaben-File befinden sich ein `apply`-Workflow und ein Workflow, der einen `for-loop` beinhaltet.
Betrachte deren Ergebnisse.
Konvertiere die beiden Workflows in eine Pipeline unter Verwendung der `map` Funktionen. Achte darauf die passenden `map` Funktionen zu verwenden und keine unnötigen Zusatzschritte zu unternehmen.


**Aufgabe:**

Gegeben ist die Liste `gr_data_bezirke`. Sie enthält Daten zu den Kandidatenstimmen bei den Grossratswahlen 2012-2020. Jedes der 15 Listenelmente stellt das Ergebnis eines Bezirks in einem bestimmten Jahr dar. 

Erstelle einen zusammenhängenden Datensatz, der den/die Kandidierende/n für jedes Jahr und jeden Bezirk mit den Meisten Stimmen enthält. Der Datensatz soll ausserdem den Bezirknamen und das Jahr enthalten, damit man das Ergebnis später nachvollzihen kann. Verwende die passende map Funktion.

Der Datensatz `meiste_stimmen_bezirk` enthält das Ergebnis

---
----
## Nice to know: purrr
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://purrr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://purrr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Weiterführende Informationen zum `purr` Package:

- [Blogbeitrag von Rebecca Barter](https://www.rebeccabarter.com/blog/2019-08-19_purrr)

- [Vergleich purrr vs. apply](https://jtr13.github.io/spring19/ss5593&amp;fq2150.html)

- [purrr-Tutorial auf R-bloggers](https://www.r-bloggers.com/2020/05/one-stop-tutorial-on-purrr-package-in-r/)

- [Blog von Fatih Emre Ozturk](https://medium.com/@ozturkfemre/purr-in-r-a-powerful-tool-for-iteration-d4eb6c0b2d20)

- [Das purrr-Cookbook von Statistik Dresden (deutsch)](https://jkruppa.github.io/programing-purrr-furrr.html#sec-purrr)









---























----
## Funktionen

Eigene Funktionen sind hilfreich, wenn Code immer wieder ausgeführt werden muss. Im Vergleich zu copy-paste von Code ergeben sich folgende Vorteile:

1. Lesbarer Code: Du kannst deinen Funktionen aussagekräftige Namen geben, sodass andere sofort wissen, was in der Funktion passiert.

2. Erleichtertes Korrigieren: Sollte sich etwas ändern musst du nicht jeden kopierten Codeblock einzeln bearbeiten sondern nur die Funktion einmalig.

3. Weniger Flüchtigkeitsfehler: veränderst du zum Beispiel bei einem Code Block die Vaiablenzuweisung bei der Kopie aber nicht, kann das zu Problemen führen. Diese entstehen mit Funktionen erst gar nicht



---
----

## Komponenten von Funktionen
.panelset[
.panel[.panel-name[formals]
- eine Liste von Argumenten, die an die Funktion übergeben werden
- jedes Argument hat einen Namen (hier `vektor`) und es kann ein Objekt (Wert, oder sogar Funktion zugewisen werden)

```r
durchschnitt &lt;- function(`vektor`){
  # Ein Kommentar, der den Body beschreibt
  temp &lt;- sum(vektor)/length(vektor)
  return(temp)
}
```

Mit der `formals()` Funktionen können die Argumente aufgerufen werden. mit `?durchschnitt` kann ausserdem die Dokumentation (sofern vorhanden) eingesehen werden. 

```r
formals(durchschnitt)
```

```
## $vektor
```
]
.panel[.panel-name[body (1)]
- der Code der in der Funktion ausgeführt wird und zwischen `{ }` steht

```r
durchschnitt &lt;- function(vektor)`{`
  # Ein Kommentar, der den Body beschreibt
  temp &lt;- sum(vektor)/length(vektor) #&lt;&lt;
  return(temp) #&lt;&lt;
 `}`
```
]
.panel[.panel-name[body (2)]
Mit `attr(funktionsname, "srcref")` können sowohl der Funktions-Body als auch Inline-Kommentare sichtbar gemacht werden.

```r
attr(durchschnitt, "srcref")
```

```
## function(`vektor`){
##   # Ein Kommentar, der den Body beschreibt
##   temp &lt;- sum(vektor)/length(vektor)
##   return(temp)
## }
```
Die `body()` Funktion zeigt nur den Body ohne Kommentare
]
.panel[.panel-name[environment]

]
]

---
----
## Funktionen: Wichtige Konzepte

.panelset[
.panel[.panel-name[Name Masking]
Namen, die innerhalb einer Funktion definiert werden, "maskieren" Namen, die ausserhalb derFunktion definiert wurden.

```r
x &lt;- 10
f1 &lt;- function() {
  x &lt;- 1
  return(x)
}
f1()
```

```
## [1] 1
```
Die Variable ausserhalb der Funktion bleibt unverändert. Gleichzeitig verwendet die Funktion, das `x` welches **innerhalb** der Funktion verwendet wird. Die Zuweisung ausserhalb der Funktion hat keinen Einfluss

]
.panel[.panel-name[Funktionen vs. Variablen]

Es kann zu Problemen kommen, wenn Funktionen und nicht Funktionen den gleichen Namen tragen.

Daher ist wichtig zu vermeiden, dass dieser Fall auftritt. Namen sollten jeweils nur für **ein** Objekt verwendet werden.

]
.panel[.panel-name[Dynamic Lookup]
Vorsicht ist geboten, wenn man eine Variable ausserhalb der Funktion definiert und diese dann in der Funktion verwendet.

```r
x &lt;- 10
f2 &lt;- function() {
  return(x)
}
f2()
```

```
## [1] 10
```

R sieht, schaut als erstes, ob die Variable `x` irgendwo in der Funktion definiert wurde. Da dies nicht der Fall ist schaut R als nächstes ausserhalb der Variable im Globalen Environment. Dort wird `x` in diesem Fall gefunden und zurückgegeben.

]
.panel[.panel-name["Neustart"]
Das Environment einer Funktion wird bei jeder Ausführung zurückgesetzt. Zuweisungen bleiben somit nur für einen Durchlauf bestehen.

```r
f3 &lt;- function() {
  if (!exists("a")) { 
    a &lt;- 1 
  }  else { 
      a &lt;- a + 1 
  }
  a
}
f3()
```

```
## [1] 1
```
]
]

---
----
## Funktionen: Wichtige Konzepte

.panelset[
.panel[.panel-name[Lazy Evaluation]
- `Lazy Evaluation` bedeutet im Falle von R Funktionen, dass Argumenete erst dann evaluiert werden, wenn sie wirklich aufgerufen werden.
- Wenn ein Argument in einer Funktion nie verwendet wird, entsteht auch keine Fehlermeldung
- Das bietet den Vorteil dass potentiell aufwändige Berechnungen nur dann ausgeführt werden, wenn diese wirklich benötigt werden

```r
f4 &lt;- function(y) {
  x &lt;- 1
  return(x)
}
f4()
```

```
## [1] 1
```
]
.panel[.panel-name[Default Argumente]
- Dank `Lazy Evaluation` können in Funktionen default Argumente mitgegeben werden
- Wenn kein expliziter Wert angegeben wird, verwendet die Funktion den default Wert
- Diese können jedoch auch einfach überschrieben werden

```r
f5 &lt;- function(y=10) {
  return(y)
}
f5()
```

```
## [1] 10
```

```r
f5(50)
```

```
## [1] 50
```
]
.panel[.panel-name[Mehr Informationen]

Ausführlichere Informationen und mehr Beispiele zu den Konzepten findet ihr in [Hadley Wickhams Buch "Advanced R"](https://adv-r.hadley.nz/functions.html#lexical-scoping)

]
]

---
----
## Funktionen: Wichtige Konzepte

1. Jedes Objekt, das innerhalb einer Funktion erzeugt wird (einschließlich der Argumente, die an die Funktion übergeben werden), wird entfernt, wenn ein Funktionsdurchlauf abgeschlossen ist.

2. Existiert ein Objekt nicht innerhalb der Funktion, sucht R nach einem Objekt außerhalb der Funktion.

3. Argumenete werden erst dann evaluiert, wenn sie wirklich aufgerufen werden (*Lazy Evaluation*)

4. In R-Funktionen ist es möglich den Argumenten default Werte zuzuweisen

.bg-washed-green.b--dark-green.ba.bw2.br3.shadow-5.ph4.mt5.b[
Alles, was innerhalb einer Funktion verwendet werden muss, sollte als Argument übergeben werden. Alles, was von einer Funktion gespeichert werden muss, sollte zurückgegeben werden

]
 
---
----
## Funktionen erstellen

Eine Funktion wird mit dem `function()` Keyword definiert.

```r
durchschnitt &lt;- function(vektor){
  temp &lt;- sum(vektor)/length(vektor)
  return(temp)
}
wert &lt;- durchschnitt(c(5,6,2,7,8))
wert
```

```
## [1] 5.6
```
.panelset[
.panel[.panel-name[Name]
- `durchschnitt` ist in diesem Fall der Name der Funktion. Somit kann sie mit `durchschnitt()` aufgerufen werden
- wir haben die `anonymus functions` bereits kennen gelernt. Diese besitzen *keinen* Namen
]
.panel[.panel-name[Argumente]
Das einzige Argument dieser Funktion ist `vektor`. Eine Funktion kann unbegrenzt Argumente besitzen oder aber keines. 
]
.panel[.panel-name[Return]
Um das Ergebnis einer Funktion einer neuen Variable zuweisen zu können, wird ein `return` Statement verwendet.
]
]
---
----
## Return Value
Return bildet den Abschluss einer Funktion. Alles was nach einem `return()` Statement im Funktions-Body folgt, wird nicht mehr ausgeführt.
In R- Funktionen gibt es implizite als auch explizite `return` Statements.
.panelset[
.panel[.panel-name[Implizites Return]
Wenn kein `return()` definiert wird, wird der letzte **ausgegebene** Wert in der Funktion zurückgegben.

```r
f5 &lt;- function(y) {
  y
}
f5(20)
```

```
## [1] 20
```
]
.panel[.panel-name[Explizites Return]
Meiner Meinung nach empfiehlt es sich **immer** ein `return()` Statement zu verwenden, wenn ein Wert zurückgegeben werden soll. Dies macht den Code einfacher lesbar.

```r
f6 &lt;- function(y) {
  return(y)
}
f6(20)
```

```
## [1] 20
```
]
]

---
----
## Sprechende Funktionen

- der Sinn von Funktionen liegt unter anderem darin, den Code für Menschen einfacher verständlich zu machen.

- es ist daher sehr wichtig den eigenen Funktionen *sprechende* Namen zu geben

- idealerweise sind Namen kurz und klar, im Zweifel ist es aber wichtiger klar als kurz zu sein, da die RStudio-Autovervollständigung dabei hilft auch lange Namen einzugeben

- deutsche Funktionsnamen sind völlig okay, aber auf keinen Fall sollten Umlaute verwendet werden



---
----
## Funktionen: Best Practices

Best Practice laut [R for Data Science](https://r4ds.had.co.nz/functions.html#functions-are-for-humans-and-computers)
.panelset[
.panel[.panel-name[Verben/Nomen]
- generell sollten Funktionen Verben sein und Argumente Nomen
- Nomen sollten nur dann als Funktionsnamen verwendet werden, wenn das angedachte Verb zu "generisch" klingt (z.B. “get”, “compute”, “calculate” oder “determine”)

```r
# Zu kurzer Name
f()
# Weder ein Verb noch beschreibend
my_awesome_function()
# Lang aber klar
impute_missing()
collapse_years()
```
]
.panel[.panel-name[Mehrere Wörter]
- besteht ein Funktionsname aus mehreren Worten, empfiehlt sich die Trennung mit `_` (*snake_case*) 
- alternativ kann *camelCase* verwendet werden (erstes Wort klein, alle folgenden Worte mit grosse Anfangsbuchstaben)
- Wichtig ist **Konsistenz** (mische nicht *snake_case* und *camelCase*, wenn mehrere Funktionen erstellt werden)

```r
camelCaseFunction()

snake_case_function()
```
]
.panel[.panel-name[Kommentare]

- kommentiere innerhalb des Funktions-Body in dem du `#` verwendest

- beim Kommentieren gilt: Versuche zu beschreiben, **warum** du etwas tust und nicht **was** du tust.
.bg-light-gray.b--dark-gray.ba.bw2.br3.shadow-5.ph4.mt2[
Do you need to add some intermediate variables with useful names? Do you need to break out a subcomponent of a large function so you can name it? However, your code can never capture the reasoning behind your decisions: why did you choose this approach instead of an alternative? What else did you try that didn’t work? It’s a great idea to capture that sort of thinking in a comment.
.tr[
— Hadley Wickham, R for Data Science, Chapter 19.3
]
]
]
.panel[.panel-name[Argumente]

- Argumente sollten wie Funktionen selbst aussagekräftige Namen besitzen (generell Nomen)

- es gibt einige spezielle Argumente, für die sich eine einheitliche Benennung durchgesetzt hat. Diese findet ihr [hier](https://r4ds.had.co.nz/functions.html#choosing-names)

- ein guter Tipp ist es ausserdem, sich Argumente bestehender Funktionen anzusehen

]
]

---
----
## Funktionen: Conditions

Ein R Workflow (oder eine Funktion) kann unterbrochen werden, um einen speziellen Zustand (*condition*) zu siganlisieren.

In R gibt es generell drei `conditions`:

1. **Error:** Ein Fehler im Ablauf, der ein weiterlaufen verhindert -&gt; Der Prozess stopt an der Stelle, an der der Fehler aufgetreten ist.
2. **Warning:** Weist auf ein mögliches Problem hin, das das Programm nicht anhält, sondern den Benutzer warnt
3. **Info:** Gibt informatives Feedback über den laufenden Prozess, ohne einen Fehler oder eine Warnung zu implizieren


---
----
## Funktionen: Conditions

In Funktionen können eigene `conditions` erzeugt werden. Das ist wichtig, da es dem Benutzer später hilft herauszufinden, was er/sie womöglich falsch gemacht hat. 

.panelset[
.panel[.panel-name[stop]
Mit `stop()` kann ein *Error* erzeugt werden

```r
f7 &lt;- function(x){
  if (!is.numeric(x)){
    stop(paste0("Der Wert für x (",x,") ist nicht numerisch."))
  }
  return(x*7)
}
f7("2")
```

```
## Error in f7("2"): Der Wert für x (2) ist nicht numerisch.
```
]
.panel[.panel-name[warning]
Mit `warning()` kann eine *Warning Message* erzeugt werden


```r
f7 &lt;- function(x){
  if (!is.numeric(x)){
    x &lt;- as.numeric(x)
    warning("x wurde zu numeric konvertiert")
  }
  return(x*7)
}
f7("2")
```

```
## Warning in f7("2"): x wurde zu numeric konvertiert
```

```
## [1] 14
```
]
.panel[.panel-name[message]
`message()` erzeugt eine `Info Message` 

```r
f8 &lt;- function(x){
  if (is.numeric(x)){
    message("x ist ein numerischer Wert")
  }
  return(x*7)
}
f8(2)
```

```
## x ist ein numerischer Wert
```

```
## [1] 14
```
]
]


---
----

## Hands-On: Funktionen

1. Schreibe eine eigene Funktion zur Berechnung der Varianz eines numerischen Vektors und nenne sie `varianz`
`$$\mathrm{Var}(x) = \frac{1}{n - 1} \sum_{i=1}^n (x_i - \bar{x}) ^2$$`
**Erklärung:**
- `\(n\)` ist die Stichprobengrösse (-&gt; die Anzahl der Elemente im Vektor)
- `\(x_i\)` ist der Wert von Vektor `\(x\)` an Stelle `\(i\)`
- `\(\bar{x}\)` ist der Mittelwert von Vektor `\(x\)`
- `\(\sum_{i=1}^n (x_i - \bar{x}) ^2\)` bedeuted das alle Ergebnisse von `\((x_i - \bar{x}) ^2\)` für jedes Element im vektor aufsummiert werden.
---



























----
## ggplot2: Daten visualisieren

&lt;figure class="logo-fig logo-title1"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title2"&gt;
  &lt;a href='https://readxl.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readxl.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title3"&gt;
  &lt;a href='https://haven.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://haven.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title4"&gt;
  &lt;a href='https://dplyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://dplyr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title5"&gt;
  &lt;a href='https://tidyr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://tidyr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title6"&gt;
  &lt;a href='https://stringr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://stringr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title7"&gt;
  &lt;a href='https://lubridate.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://lubridate.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title8"&gt;
  &lt;a href='https://magrittr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://magrittr.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

&lt;figure class="logo-fig logo-title9"&gt;
  &lt;a href='https://forcats.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://forcats.tidyverse.org/logo.png' class='logo' style ="opacity: 0.5;"/&gt;
  &lt;/a&gt;
&lt;/figure&gt;


&lt;figure class="logo-fig logo-title10"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo' /&gt;
  &lt;/a&gt;
&lt;/figure&gt;




---
----
## ggplot2: Daten visualisieren
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

- ggplot2 bietet eine einfache Möglichkeit, datenbasierte Grafiken zu erstellen, ohne komplizierte Grafikbefehle schreiben zu müssen

- ggplot2 verwendet das Grammar of Graphics-Konzept, das auf einfache Syntax und klare Struktur setzt.

- durch Hinzufügen von Ebenen (Layers) können Grafiken angepasst werden

- das Buch [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/toolbox.html) bietet umfangreiche Informationen

---
----
## ggplot2: Vom Datensatz zur Grafik
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
.panelset[
.panel[.panel-name[Beschreibung]
Eine Grafik in ggplot2 wird immer über den `ggplot()` Befehl initialisiert und besteht aus drei Grundbestandteilen
- **data:** ein Datenobjekt, auf werlches sich die Grafik bezieht
- **aesthetic mappings:** Datenvariablen werden bestimmten ästhetischen Eigenschaften zugeordnet, wie z.B. Farbe, Größe, Form, Position, etc.
- **geom:** in welcher Form die Daten visualisiert werden sollen (z.B. Scatter, Linien, Balken, etc.)

]
.panel[.panel-name[Code]


```r
library(ggplot2)
set.seed(1234)
index &lt;- sample(1:nrow(geburten),2000)
geburten_sample &lt;- geburten[index,]

ggplot(data = geburten_sample, aes(x=age_v, y=age_m))+
  geom_point()
```
]
.panel[.panel-name[Grafik]
Alter des Vaters auf der x-Achse und Alter der Mutter auf der y-Achses

&lt;img src="index_files/figure-html/unnamed-chunk-475-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
]

---
----
## ggplot2: Aesthetic Mappings
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
.panelset[
.panel[.panel-name[Beschreibung]
- Mit **aesthetic mappings** können Datenvariablen  bestimmten ästhetischen Eigenschaften, wie z.B. Farbe, Größe, Form, Position, etc. zugeordnet werden.
- sie werden innerhalb des `aes()` Befehls definiert
- `aes()` kann sowohl für die ganze Grafik innerhalb des `ggplot()` Befehls verwendet werden oder aber für jeden Layer seperat.
- aesthetics können auch ausserhalb von `aes()` definiert werde, wenn kein Variablenbezug nötig ist 
- beim mapping spielt auch der Datentyp eine wichtige Rolle

&lt;p&gt;Eine Übersicht über mögliche aesthetics findet ihr z.B. &lt;a href = 'https://ggplot2.tidyverse.org/articles/ggplot2-specs.html'&gt;hier&lt;/a&gt;&lt;/p&gt;

]
.panel[.panel-name[Bsp 1]
Die Datenpunkte sollen je nach Geschlecht (`sex`) unterschiedlich eingefärbt werden

```r
ggplot(data = geburten_sample, aes(x=age_v, y=age_m, color = sex))+
  geom_point()
```
]
.panel[.panel-name[Fig 1]
&lt;img src="index_files/figure-html/unnamed-chunk-477-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
.panel[.panel-name[Bsp 2]
`sex` wird als numerische Variable erkannt weshalb eine Umwandlung nötig ist

```r
ggplot(data = geburten_sample, aes(x=age_v, y=age_m, color = as.factor(sex)))+
  geom_point()
```
]
.panel[.panel-name[Fig 2]
&lt;img src="index_files/figure-html/unnamed-chunk-479-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
.panel[.panel-name[Bsp 3]
Ausserhalb des `aes()` Befehls können auch statische Variablen als aesthetics definiert werden (siehe [hier](https://ggplot2-book.org/layers.html#setting-mapping))

```r
ggplot(data = geburten_sample, aes(x=age_v, y=age_m, color = as.factor(sex)))+
  geom_point(shape = 15)
```
]
.panel[.panel-name[Fig 3]
&lt;img src="index_files/figure-html/unnamed-chunk-481-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
]

---
----

## ggplot2: geoms
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
.panelset[
.panel[.panel-name[Beschreibung]
- **geoms** definieren die Form in der Daten dargestellt werden
- jedes geom ist zweidimensional und benötigt daher `x` und `y` aestheics, um die Position festzulegen
- jedem geom können die aesthetics `color` und `size` zugeordnet werden
- ausserdem gibt es geom-spezifische aesthetics (z.b. `linetype` für `geom_line()`)


&lt;p&gt;Eine Übersicht über verfügbare geoms findet ihr z.B. &lt;a href = 'https://ggplot2.tidyverse.org/reference/#geoms'&gt;hier&lt;/a&gt;&lt;/p&gt;

]
.panel[.panel-name[Bsp]
- Die Grafik leidet bisher unter *overplotting* (= mehrere Datenpunkte liegen direkt übereinander)
- Mit `geom_jitter` anstelle von `geom_point` kann eine minimale künstliche Varianz erzeugt werden, welche die Grafik aussagekräftiger macht

```r
ggplot(data = geburten_sample, aes(x=age_v, y=age_m, color = as.factor(sex)))+
  geom_jitter(shape = 15)
```
]
.panel[.panel-name[Fig]
&lt;img src="index_files/figure-html/unnamed-chunk-483-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
]


---
----

## ggplot2: geoms (Beispiele)
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
.panelset[
.panel[.panel-name[Bsp 1]
- Balkendiagramm des Altersunterschied zwischen Vätern und Müttern über Zeit
- Pipeline enthält sowohl Datenaufbereitung als auch -visualisierung (nicht immer empfehlenswert)

```r
geburten %&gt;% 
  mutate(age_diff = age_v-age_m) %&gt;% 
  group_by(stat_jahr) %&gt;% 
  summarise(mean_dif =mean(age_diff,na.rm = T)) %&gt;% 
  ggplot(aes(x= stat_jahr,y=mean_dif)) + 
  geom_bar(stat = "identity")
```


]
.panel[.panel-name[Fig 1]
&lt;img src="index_files/figure-html/unnamed-chunk-485-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
.panel[.panel-name[Bsp 2]
- Hinzufügen einer Linie als zusätzlicher Layer

```r
geburten %&gt;% 
  mutate(age_diff = age_v-age_m) %&gt;% 
  group_by(stat_jahr) %&gt;% 
  summarise(mean_dif =mean(age_diff,na.rm = T)) %&gt;% 
  ggplot(aes(x= stat_jahr,y=mean_dif)) + 
  geom_bar(stat = "identity") +
  geom_line(linetype = "dashed", color = "red")
```
]
.panel[.panel-name[Fig 2]
&lt;img src="index_files/figure-html/unnamed-chunk-487-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
.panel[.panel-name[Bsp 3]
- Durchschnittliches Alter der Mutter und des Vaters bei Geburt
- Mehrere Linien mit unterscheidlichen Positionen

```r
geburten %&gt;% 
  group_by(stat_jahr) %&gt;% 
  summarise(mean_m =mean(age_m,na.rm = T), #Durchschnittliches Alter der Mutter
            mean_v = mean(age_v,na.rm = T)) %&gt;% #Durchschnittliches Alter des Vaters
  ggplot(aes(x= stat_jahr)) + 
  geom_line(aes(y=mean_v), color = "red") +
  geom_line(aes(y=mean_m), color = "blue")
```
]
.panel[.panel-name[Fig 3]
&lt;img src="index_files/figure-html/unnamed-chunk-489-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
.panel[.panel-name[Bsp 4]
- Ermittlung von Missing Values

```r
geburten %&gt;% 
  group_by(stat_jahr) %&gt;% 
  summarise(age_m_na =sum(is.na(age_m))/n(), #Anteil NAs beim Alter der Mutter
            age_v_na =sum(is.na(age_v))/n()) %&gt;% #Anteil NAs beim Alter des Vaters
  ggplot(aes(x= stat_jahr)) + 
  geom_line(aes(y=age_v_na), color = "red") +
  geom_line(aes(y=age_m_na), color = "blue")
```
]
.panel[.panel-name[Fig 3]
&lt;img src="index_files/figure-html/unnamed-chunk-491-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]
]


---
----
## Beispiel: Parteistärke



---
----

## Hands-On: Daten visualisieren mit ggplot2

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

Stelle das erreichte Alter von Männern und Frauen im Zeitverlauf gegenüber.

- Schaue dir den vorbereiten Datensatz `heirat_mod` an, bevor du die Visualisierung angehst 
- Erzeuge ein Liniendiagramm, welches die Altersentwicklung von Männern und Frauen bei der Hochzeit abbildet
- Das Liniendiagramm soll eine Linie pro Geschlecht enthalten. Beide Linien sollen unterschiedliche Farben haben.   
- Füge einen Titel sowie eine Beschriftung für X- und Y-Achse hinzu.
- Verwende dafür die labs() Funktion (`?ggplot2::labs()` für Hilfe)

<div class="countdown" id="timer_c5514f7e" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
----

## ggplot2: Good to know
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ggplot2.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://ggplot2.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
Ein vertieftes Einsteigen in die Feinheiten von `ggplot2` sprengt den Rahmen dieses Workshops.&lt;br&gt;&lt;br&gt;
Daher sei noch einmal auf das Buch [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/) verwiesen. Hier ist besonders das Kapitel [Build a plot layer by layer](https://ggplot2-book.org/layers.html#layers) interessant, welches die notwendigen Schritte zur Erstellung von Grafiken erläutert. Daebi wird auch auf das Styling einer Grafik eingegangen. &lt;br&gt;
&lt;br&gt;
Mit dem [plotly](https://plotly-r.com/) Package ist es ausserdem möglich statische Grafiken in interaktive Grafiken zu transformieren

---




















----

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## Einlesen von CSV-Dateien


- CSV-Dateien sind ein häufiges Format für Datenaustausch.
- Typische Probleme beim Einlesen:
  - **Kodierung** (z.B. `UTF-8`, `latin1`, Umlaute).
  - Unterschiedliche **Trennzeichen** (z.B. `,`, `;`, `\t`).
  - **Unklare Struktur** (fehlende Header, unregelmäßige Daten).

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen

**Problem:** 
- Falsche Darstellung von Zeichen wie Umlauten (`ä`, `ö`, `ü`)
- Unterschiedliche Trennzeichen (z.B. `,`, `;`, `\t`)

**Grund:**
- Das Encoding beim einlesen ist nicht korrekt gesetzt. Oft ensteht dies, wenn csv Dateien direkt aus Excel heraus erstellt werden. Diese csv-Dateien sind dann oft in `latin1` und nicht im Standardformat `utf-8` kodiert.
- Beim Export aus Excel wird in der Regel ein Semikolon (`;`) anstelle des üblichen Kommas (`,`) als Trennezichen gesetzt

**Lösung:**
Encoding und Trennzeichen können manuell eingestellt werden

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Exkurs: Encoding

.panelset[
.panel[.panel-name[Idee]

- Encoding übersetzt Zeichen in Zahlen (Bytes), die der Computer speichern und verarbeiten kann.

- Verschiedene Encodings nutzen unterschiedliche Zahlenfolgen, um dasselbe Zeichen darzustellen.

- Verschiedene Encodings liegen unterschieldliche Lookup Tabellen zu Grunde aus denen das jeweils dargestellte Zeichen mit dem entsrechenden Code entnommen wird
]
.panel[.panel-name[Encodingvarianten]


  - **ASCII**: Basis-Lookup-Tabelle (nur englische Buchstaben, Zahlen, Symbole).
    - `A` = `65`, `B` = `66`.
  - **latin1** (ISO-8859-1): Erweiterung von ASCII, unterstützt europäische Sonderzeichen.
    - `ä` = `0xE4`.
  - **UTF-8**: Modernes Unicode-Encoding, speichert Zeichen mit 1-4 Bytes.
    - `ä` = `0xC3 0xA4`.
  - **UTF-16**: Unicode mit 2 Bytes für viele Zeichen.
    - `ä` = `0x00E4`.

]
.panel[.panel-name[Beispiel]
  
**Speichern das Wort `München` in einer Datei:**
- Bytes in **UTF-8**: `0x4D 0xC3 0xBC 0x6E 0x63 0x68 0x65 0x6E`.
- Bytes in **latin1**: `0x4D 0xFC 0x6E 0x63 0x68 0x65 0x6E`.

Wird die Datei mit falschem Encoding gelesen:
  - **UTF-8** gelesen als latin1: `MÃ¼nchen` statt `München`.
]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Ausgangsdaten

.panelset[
.panel[.panel-name[Variante 1]

**UTF-8 und Komma als Trennzeichen**

- Umlaute werden in Excel nicht korrekt angezeigt
- Excel hat Probleme damit CSVs anzuzeigen, die in `utf-8` kodiert sind

![CSV Variante 1](img/csv_v1.png)
]
.panel[.panel-name[Variante 2]

**latin1 und Komma als Trennzeichen**

- Trennzeichen wird nicht korrekt interpretiert

![CSV Variante 2](img/csv_v2.png)
]
.panel[.panel-name[Variante 3]

**UTF-8 und Semikolon als Trennzeichen**

- Umlaute werden in Excel nicht korrekt angezeigt

![CSV Variante 3](img/csv_v3.png)
]
.panel[.panel-name[Variante 4]

**latin1-8 und Semikolon als Trennzeichen**

- korrekte Darstellung

![CSV Variante 4](img/csv_v4.png)
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Daten einlesen

.panelset[
.panel[.panel-name[Variante 1]

**UTF-8 und Komma als Trennzeichen**


```r
library(readr)
csv_v1 &lt;- read_csv("Daten/geb_csv1.csv")
```

```
## Rows: 4 Columns: 5
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (3): id, name, gemeinde_m
## dbl (2): stat_jahr, geb_year
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```
]
.panel[.panel-name[Variante 2]

**latin1 und Komma als Trennzeichen**


```r
library(readr)
csv_v2 &lt;- read_csv("Daten/geb_csv2.csv")
```

```
## Rows: 4 Columns: 1
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (1): stat_jahr,"id","geb_year","name","gemeinde_m"
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```
]
.panel[.panel-name[Variante 3]

**UTF-8 und Semikolon als Trennzeichen**


```r
library(readr)
csv_v3 &lt;- read_csv("Daten/geb_csv3.csv")
```

```
## Rows: 5 Columns: 1
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (1): stat_jahr;id;geb_year;name;gemeinde_m
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```
]
.panel[.panel-name[Variante 4]

**latin1-8 und Semikolon als Trennzeichen**


```r
library(readr)
csv_v4 &lt;- read_csv("Daten/geb_csv4.csv")
```

```
## Rows: 7 Columns: 1
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (1): stat_jahr;id;geb_year;name;gemeinde_m
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```
]
]



---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Daten anschauen

.panelset[
.panel[.panel-name[Variante 1]

**UTF-8 und Komma als Trennzeichen**


```r
head(csv_v1,3)
```

```
## # A tibble: 3 × 5
##   stat_jahr id    geb_year name        gemeinde_m
##       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
## 1      2016 x         2016 Amélie Lea  x         
## 2      2005 x         2005 Joséphine   x         
## 3      2010 x         2010 Lara Bärbel x
```
]
.panel[.panel-name[Variante 2]

**latin1 und Komma als Trennzeichen**


```r
head(csv_v2,3)
```

```
## # A tibble: 3 × 1
##   `stat_jahr,"id","geb_year","name","gemeinde_m"`
##   &lt;chr&gt;                                          
## 1 "2016,x,2016,\"Am\xe9lie Lea\",x"              
## 2 "2005,x,2005,\"Jos\xe9phine\",x"               
## 3 "2010,x,2010,\"Lara B\xe4rbel\",x"
```
]
.panel[.panel-name[Variante 3]

**UTF-8 und Semikolon als Trennzeichen**


```r
head(csv_v3,3)
```

```
## # A tibble: 3 × 1
##   `stat_jahr;id;geb_year;name;gemeinde_m`
##   &lt;chr&gt;                                  
## 1 2016;x;2016;Amélie Lea;x               
## 2 2005;x;2005;Joséphine;x                
## 3 2010;x;2010;Lara Bärbel;x
```
]
.panel[.panel-name[Variante 4]

**latin1-8 und Semikolon als Trennzeichen**


```r
head(csv_v4,3)
```

```
## # A tibble: 3 × 1
##   `stat_jahr;id;geb_year;name;gemeinde_m`
##   &lt;chr&gt;                                  
## 1 "2016;x;2016;Am\xe9lie Lea;x"          
## 2 "2005;x;2005;Jos\xe9phine;x"           
## 3 "2010;x;2010;Lara B\xe4rbel;x"
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Einleseprozess korrigieren

.panelset[
.panel[.panel-name[Variante 1]

**UTF-8 und Komma als Trennzeichen**
- keine Anpassung nötig, da Daten bereits korrekt eingelesen sind


```r
csv_v1 &lt;- read_csv("Daten/geb_csv1.csv",show_col_types = FALSE)
head(csv_v1,3)
```

```
## # A tibble: 3 × 5
##   stat_jahr id    geb_year name        gemeinde_m
##       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
## 1      2016 x         2016 Amélie Lea  x         
## 2      2005 x         2005 Joséphine   x         
## 3      2010 x         2010 Lara Bärbel x
```
]
.panel[.panel-name[Variante 2]

**latin1 und Komma als Trennzeichen**
- Anpassung des Encodings mithilfe der `locale()` Funktion


```r
csv_v2 &lt;- read_csv("Daten/geb_csv2.csv", locale = locale(encoding = "latin1"),show_col_types = FALSE)
head(csv_v2,3)
```

```
## # A tibble: 3 × 1
##   `stat_jahr,"id","geb_year","name","gemeinde_m"`
##   &lt;chr&gt;                                          
## 1 "2016,x,2016,\"Amélie Lea\",x"                 
## 2 "2005,x,2005,\"Joséphine\",x"                  
## 3 "2010,x,2010,\"Lara Bärbel\",x"
```
]
.panel[.panel-name[Variante 3]

**UTF-8 und Semikolon als Trennzeichen**
- Anpassung des Trennzeichens.
- `read_delim` ist die Basisfunktion für alle `read_`-Funktionen. Hier können sämtliche Optionen selbst definiert werden


```r
csv_v3 &lt;- read_delim("Daten/geb_csv3.csv", delim = ";",show_col_types = FALSE)
head(csv_v3,3)
```

```
## # A tibble: 3 × 5
##   stat_jahr id    geb_year name        gemeinde_m
##       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
## 1      2016 x         2016 Amélie Lea  x         
## 2      2005 x         2005 Joséphine   x         
## 3      2010 x         2010 Lara Bärbel x
```
]
.panel[.panel-name[Variante 4]

**latin1-8 und Semikolon als Trennzeichen**
- Anpassung des Trennzeichens und des Encodings.


```r
csv_v4 &lt;- read_delim("Daten/geb_csv4.csv", delim = ";",locale = locale(encoding = "latin1"),show_col_types = FALSE)
head(csv_v4,3)
```

```
## # A tibble: 3 × 5
##   stat_jahr id    geb_year name        gemeinde_m
##       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     
## 1      2016 x         2016 Amélie Lea  x         
## 2      2005 x         2005 Joséphine   x         
## 3      2010 x         2010 Lara Bärbel x
```
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Zu beachten

- Das Encoding sollte nach dem Einlesen direkt überprüft werden.

- Problematisch wird es dann, wenn falsch kodierte Daten erneut in anderer Kodierung abgespeichert werden. In diesem Fall kann das Encoding beim Einlesen nicht mehr ohne weiteres geändert werden, da die falsch kodierten Zeichen dann als tatsächlich interpretierte Zeichen interpretiert werden.

- Beim Abspeichern gibt R allerdings bereits eine Warnmeldung aus 





---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: Zu beachten

.panelset[
.panel[.panel-name[Einlesen mit falscher Kodierung]

- in `latin1` kodierte Daten ohne Umwandlung als `utf-8` abspeichern


```r
csv_v2 &lt;- read_csv("Daten/geb_csv2.csv",show_col_types = FALSE)
write.csv(csv_v2,"Daten/geb_csv2_falsch.csv",fileEncoding = "utf-8",row.names = F)
```

```
## Warning in utils::write.table(csv_v2, "Daten/geb_csv2_falsch.csv", fileEncoding
## = "utf-8", : invalid char string in output conversion

## Warning in utils::write.table(csv_v2, "Daten/geb_csv2_falsch.csv", fileEncoding
## = "utf-8", : invalid char string in output conversion

## Warning in utils::write.table(csv_v2, "Daten/geb_csv2_falsch.csv", fileEncoding
## = "utf-8", : invalid char string in output conversion

## Warning in utils::write.table(csv_v2, "Daten/geb_csv2_falsch.csv", fileEncoding
## = "utf-8", : invalid char string in output conversion
```
]
.panel[.panel-name[Einlesen (1)]

- Einlesen im beim Zwischenspeichern definierten `utf-8` 


```r
csv_v2_falsch &lt;- read_csv("Daten/geb_csv2_falsch.csv",show_col_types = FALSE)
```

```
## Warning: One or more parsing issues, call `problems()` on your data frame for details,
## e.g.:
##   dat &lt;- vroom(...)
##   problems(dat)
```

```r
head(csv_v2_falsch,3)
```

```
## # A tibble: 2 × 1
##   `stat_jahr,"id","geb_year","name","gemeinde_m"`
##   &lt;chr&gt;                                          
## 1 "2016,x,2016,\"Am\n2005,x,2005,\"Jos"          
## 2 "2010,x,2010,\"Lara B\n1999,x,1999,\"Seval K"
```
]
.panel[.panel-name[Einlesen (2)]

- Einlesen im ursprünglich richtigen `latin1`
- Daten sind falsch abgelegt. Das Ändern des Encodings hat nun keine Auswirkung mehr


```r
csv_v2_falsch &lt;- read_csv("Daten/geb_csv2_falsch.csv",locale = locale(encoding = "latin1"),show_col_types = FALSE)
```

```
## Warning: One or more parsing issues, call `problems()` on your data frame for details,
## e.g.:
##   dat &lt;- vroom(...)
##   problems(dat)
```

```r
head(csv_v2_falsch,3)
```

```
## # A tibble: 2 × 1
##   `stat_jahr,"id","geb_year","name","gemeinde_m"`
##   &lt;chr&gt;                                          
## 1 "2016,x,2016,\"Am\n2005,x,2005,\"Jos"          
## 2 "2010,x,2010,\"Lara B\n1999,x,1999,\"Seval K"
```
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: SONDERFÄLLE

- in der Regel reicht es, zwischen `utf-8` und `latin-1` zu wählen, da so die meisten Fälle abgedeckt werden

- SAS exportiert csv Dateien per Default im `Windows-1512`-Encoding, da das default Encoding vom Betriebssystem und der Konfiguration der SAS-Sitzung abhängt. Dieses Encoding basiert zwar auf `latin1`, enthält aber zusätzlich weitere Zeichen aus westlichen Sprachen.

- Ein Problem ergibt sich zum Beispiel, wenn der **Halbgeviertstrich (–)** (nicht zu verwechseln mit dem Bindestrich (-)) verwendet wird. Dieser existiert nicht in der `latin1` Kodierungstabelle und wird daher falsch interpretiert 

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Kodierung und Trennzeichen: SONDERFÄLLE


.panelset[
.panel[.panel-name[Einlesen in utf-8]



```r
csv_sas &lt;- read_delim("Daten/1_Sozialhilfequote_Bezüger_Dossiers_Gde_2023.csv",delim = ";",show_col_types = F)
csv_sas |&gt; slice(42) |&gt; select(GdenameTG,Quote_Kategorie)
```

```
## # A tibble: 1 × 2
##   GdenameTG                Quote_Kategorie   
##   &lt;chr&gt;                    &lt;chr&gt;             
## 1 "Kradolf-Sch\xf6nenberg" "Quote 1,0\x961,9"
```
]
.panel[.panel-name[Einlesen mit latin1]



```r
csv_sas_lat &lt;- read_delim("Daten/1_Sozialhilfequote_Bezüger_Dossiers_Gde_2023.csv",delim = ";",locale = locale(encoding = "latin1"),show_col_types = F)
csv_sas_lat |&gt; slice(42) |&gt; select(GdenameTG,Quote_Kategorie)
```

```
## # A tibble: 1 × 2
##   GdenameTG           Quote_Kategorie     
##   &lt;chr&gt;               &lt;chr&gt;               
## 1 Kradolf-Schönenberg "Quote 1,0\u00961,9"
```
]
.panel[.panel-name[Einlesen mit Windows-1252]



```r
csv_sas_win &lt;- read_delim("Daten/1_Sozialhilfequote_Bezüger_Dossiers_Gde_2023.csv",delim = ";",locale = locale(encoding = "Windows-1252"),show_col_types = F)
csv_sas_win |&gt; slice(42) |&gt; select(GdenameTG,Quote_Kategorie)
```

```
## # A tibble: 1 × 2
##   GdenameTG           Quote_Kategorie
##   &lt;chr&gt;               &lt;chr&gt;          
## 1 Kradolf-Schönenberg Quote 1,0–1,9
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Daten Zwischenspeichern

- in R sollten Zwischenspeihcerungen die nur in R weiterverwendet werden sollen **IMMER** im RDS-Format abgespeichert werden.

- Dieses R-eigene Format ist speichereffizient und speichert alle R-Objekte genau so wie sie sind

- Wenn csv geladen wird, sollte `readr::read_csv()` anstatt von `read.csv()` benutzt werden, da es besonders bei grossen Datensätzen (&gt;100MB) ca. 5 mal schneller ist.

- Weiterführende Infos zum effizienten einlesen [hier](https://bookdown.org/csgillespie/efficientR/input-output.html)
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://readr.tidyverse.org' target="_blank"&gt;
    &lt;img src='https://readr.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Daten Zwischenspeichern

![](index_files/figure-html/unnamed-chunk-534-1.png)&lt;!-- --&gt;
---





















----

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ycphs.github.io/openxlsx/' target="_blank"&gt;
    &lt;img src='https://i2.wp.com/mfatihtuzen.netlify.app/posts/2024-11-04_openxlsx/openxlsx.png?w=578&amp;ssl=1' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;



## Einführung in `openxlsx`

- Leichtgewichtiges R-Package für Excel-Dateien

- Lesen, Schreiben und Formatieren von `.xlsx`-Dateien

- Keine externe Software (z. B. Excel) erforderlich.

- basiert auf sog. `workbook` objekten

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ycphs.github.io/openxlsx/' target="_blank"&gt;
    &lt;img src='https://i2.wp.com/mfatihtuzen.netlify.app/posts/2024-11-04_openxlsx/openxlsx.png?w=578&amp;ssl=1' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## openxlsx: Sheets erstellen und Daten eintragen

.panelset[
.panel[.panel-name[Erklärung]

- ein `workbook` kann entweder mit `createWorkbook()` neu erstellt werden oder eine `xlsx`-Datei kann mit `loadWorkbook()` zum bearbeiten eingelesen werden

- Neue Reiter werden mit `addWorksheet()` angefügt. Bei neuen Workbooks muss dies immer als erstes erledigt werden, da es sonst keine Reiter gibt. Mit `removeWorksheet()` kann ein Worksheet wieder entfernt werden.

- mit `writeData()` werden Daten eingetragen. Hier besteht die Möglichkeit genau zu definieren, wo die Daten eingefügt werden sollen
]
.panel[.panel-name[Code]

```r
library(openxlsx)

# Workbook neu erstellen
wb &lt;- createWorkbook()

# Neues Worksheet erstellen
addWorksheet(wb,sheetName = "Neuer Reiter")

# Daten eintragen ins entsprechenden sheet.Default für startRow und startCol ist 1
writeData(wb,x=iris,sheet = "Neuer Reiter",startCol = 3,startRow = 4)

#Daten abspeichern
saveWorkbook(wb,"Daten/wb1.xlsx",overwrite = TRUE)
```
]
.panel[.panel-name[Ergebnis]


![openxlsx Bsp 1](img/openxlsx1.png)
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ycphs.github.io/openxlsx/' target="_blank"&gt;
    &lt;img src='https://i2.wp.com/mfatihtuzen.netlify.app/posts/2024-11-04_openxlsx/openxlsx.png?w=578&amp;ssl=1' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## openxlsx: Zellen stylen

.panelset[
.panel[.panel-name[Erklärung]

- Jede Zelle kann mit einem *cell style* versehen werden. Hier können z.B. Hintergrund, Zahlenformat, Farbe usw definiert werden. Eine Übersciht der Möglichkeiten findet ihr [hier](https://rdrr.io/cran/openxlsx/man/createStyle.html)

- Styles könne auf einzelnde Zellen oder auf ganze Zellbereiche angewendet werden. Ausserdem können Styles "gestackt" werden, also gestapelt. So können zusätzliche Style-Features zu einem existierenden Style hinzugefügt werden.

- styles werden mit der `createStyle()` Funktion erstellt und mit der `addStyle()` Funktion auf Zellen angewendet. Wenn ein Style auf eine Zellregion angewendet werden soll, die nicht "quadratisch" ist, muss `gridExpand=TRUE` gesetzt werden.
]
.panel[.panel-name[Code]

```r
library(openxlsx)
# Workbook laden
wb &lt;- loadWorkbook("Daten/wb1.xlsx")
# Styles erstellen
style_1 &lt;- createStyle(fontSize = 18,fontColour = "red")
style_2 &lt;- createStyle(textDecoration = "bold",border = c("top", "bottom", "left", "right"))

# Styles anwenden. Beim Sheet kann auch der Index verwednet werden, aber vorsicht mit Index.
addStyle(wb, sheet = 1, style = style_1,rows = c(4:5),cols = c(3:4),gridExpand = TRUE)
addStyle(wb, sheet = 1, style = style_2,rows = c(5:8),cols = c(3:4),gridExpand = TRUE)
addStyle(wb, sheet = 1, style = style_1,rows = c(7:8),cols = c(3:4),gridExpand = TRUE,stack = TRUE)

#Daten abspeichern
saveWorkbook(wb,"Daten/wb2.xlsx",overwrite = TRUE)
```
]
.panel[.panel-name[Ergebnis]


![openxlsx Bsp 1](img/openxlsx2.png)
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ycphs.github.io/openxlsx/' target="_blank"&gt;
    &lt;img src='https://i2.wp.com/mfatihtuzen.netlify.app/posts/2024-11-04_openxlsx/openxlsx.png?w=578&amp;ssl=1' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## openxlsx: Weitere Funktionen

.panelset[
.panel[.panel-name[Erklärung]

- Weitere nützliche Funktionen sind zum Beispiel das Setzen von Spaltenbreiten und Zeilenhöhen mit `setColWidths()` und `setRowHeights()`

- Mit `cloneWorksheet()` kann ein ganzes Worksheet kopiert werden.

- Es gibt noch unzählige weitere Funktionen. Eine Übersicht findet ihr [hier](https://rdrr.io/cran/openxlsx/man/)
]
.panel[.panel-name[Code]

```r
library(openxlsx)
# Workbook laden
wb &lt;- loadWorkbook("Daten/wb2.xlsx")
# Spaltenbreiten
setColWidths(wb,sheet=1,cols = c(1,2), widths = 3)
setColWidths(wb,sheet=1,cols = 3, widths = 15)

# Zeilenhöhen
setRowHeights(wb,sheet = 1,rows = 9,heights = 8)

#speichern
saveWorkbook(wb,"Daten/wb3.xlsx",overwrite = TRUE)
```
]
.panel[.panel-name[Ergebnis]


![openxlsx Bsp 1](img/openxlsx3.png)
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://ycphs.github.io/openxlsx/' target="_blank"&gt;
    &lt;img src='https://i2.wp.com/mfatihtuzen.netlify.app/posts/2024-11-04_openxlsx/openxlsx.png?w=578&amp;ssl=1' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Hands-On: Daten in Excel schreiben mit openxlsx

Repliziere die Tabelle in `Slides/Daten/openxlsx_table.xlsx`.

Speichere die Datei unter `Slides/Daten/openxlsx_table_DEIN_KÜRZEL.xlsx`.

![openxlsx Aufgabe](img/openxlsx_exercise.png)
<div class="countdown" id="timer_6c61a954" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## TGexcel

- `TGexcel` basiert auf `openxlsx`, ist aber bereits auf unsere Bedürfnisse abgestimmt

- Das Package enthält bereits Funktionen, die das erstellen und bearbeiten von Internettabellen erleichtern

- Die verwendeten Sytles sind bereits im Package hinterlegt

- Am häufigsten werden wahrscheinlich die Funktionen `create_xlsx_spalte()`,`create_xlsx_zeile()` und `create_xlsx_reiter()` gebraucht. Dies fügen eine Spalte/Zeile/Reiter mit Daten des neuen Jahres an und bedienen sich der Formatierungen aus dem Excelfile des letzten Jahres. Diese Funktionen sind stark vereinfacht. Das bringt sowohl Vorteile als auch Nachteile
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## TGexcel: `create_xlsx_spalte()`

.panelset[
.panel[.panel-name[Erklärung]
         
- Die Funktion hängt für die Daten eines neuen Jahres eine Spalte im Excel File an, passt die Untertitel der Überschrift und ggf. den Namen des Reiters an (z.B. aus 2020-2022 wird 2020-2023)
         
- benötigt wird dafür lediglich den Pfad zur Internettabelle des letzten Jahres als Muster, den Index der Zeile in der die Daten starten (nicht die Kopfzeile) sowie einen Datensatz mit einer Spalte, die als Spaltennamen das neue Jahr trägt.
         
- Die Reihenfolge der Daten muss dabei bereits der in der Exceltabelle entsprechen 
         
- [Doku auf GitHub](https://github.com/ogdtg/TGexcel?tab=readme-ov-file#jahr-als-spalte)
                             
]
  
.panel[.panel-name[Ausgangsdaten]
         

```r
# Dummy Data addiert mit 50
dummy_data &lt;- openxlsx::read.xlsx("Daten/excel_spalte.xlsx", sheet = 1, cols = 7, rows = 3:89) + 50
names(dummy_data) &lt;- "2025"
head(dummy_data, 5)
```

```
##   2025
## 1 2800
## 2  640
## 3  216
## 4  192
## 5   59
```
]
  
.panel[.panel-name[Musterexcel]
         
![openxlsx Bsp 1](img/tgexcel_spalte1.png)
]
  
.panel[.panel-name[Code]
         

```r
library(TGexcel)
# WB des letzten Jahres laden
wb &lt;- loadWorkbook("Daten/excel_spalte.xlsx")

# Daten eintragen. Achtung bei TGexcel muss eine Zuweisung erfolgen
wb &lt;- create_xlsx_spalte(
  xlsx_path = "Daten/excel_spalte.xlsx",
  year = 2025,
  dataStart = 4, # In dieser Zeile starten die Daten
  data = dummy_data
)

# Speichern
save_tg_workbook(wb, "Daten/excel_spalte_new.xlsx", tg_header = FALSE, overwrite = TRUE)
```

```
## File saved without header
```
]
.panel[.panel-name[Ergebnis]
         
![openxlsx Bsp 2](img/tgexcel_spalte2.png)
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## TGexcel: `create_xlsx_zeile()`

.panelset[
.panel[.panel-name[Erklärung]
         
- Die Funktion hängt für die Daten eines neuen Jahres eine Reihe im Excel File an, passt die Untertitel der Überschrift und ggf. den Namen des Reiters an (z.B. aus 2020-2022 wird 2020-2023)
         
- Zu beachten ist, dass als data Argument jeweils ein data.frame übergeben werden muss, bei welchem eine Datenspalte mit dem Namen jahr enthalten sein muss. Diese muss das entsprechende Jahr enthalten. 

- Der Datensatz sollte nur eine Zeile enthalten und die Variablenreihenfolge muss der Reihenfolge im Excel enstprechen
         
- [Doku auf GitHub](https://github.com/ogdtg/TGexcel?tab=readme-ov-file#jahr-als-zeile)
                             
]
  
.panel[.panel-name[Ausgangsdaten]
         

```r
# Dummy Data multipliziert mit 0.96
dummy_data &lt;- openxlsx::read.xlsx("Daten/excel_zeile.xlsx", sheet = 1, cols = 1:4, rows = 8,colNames = FALSE) |&gt; 
  rename(jahr = "X1") |&gt; 
  mutate(jahr = 2024) |&gt; 
  mutate_at(vars(contains("X")),~.x*0.96)
head(dummy_data, 5)
```

```
##   jahr       X2       X3      X4
## 1 2024 29.12077 29.21422 28.9852
```
]
  
.panel[.panel-name[Musterexcel]
         
![openxlsx Bsp 1](img/tgexcel_zeile1.png)
]
  
.panel[.panel-name[Code]
         

```r
library(TGexcel)
# WB des letzten Jahres laden
wb &lt;- loadWorkbook("Daten/excel_zeile.xlsx")

# Daten eintragen. Achtung bei TGexcel muss eine Zuweisung erfolgen
wb &lt;- create_xlsx_zeile(
  xlsx_path = "Daten/excel_zeile.xlsx",
  year = 2024,
  dataStart = 4, # In dieser Zeile starten die Daten
  data = dummy_data
)

# Speichern
save_tg_workbook(wb, "Daten/excel_zeile_new.xlsx", tg_header = FALSE, overwrite = TRUE)
```

```
## File saved without header
```
]
.panel[.panel-name[Ergebnis]
         
![openxlsx Bsp 2](img/tgexcel_zeile2.png)
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## TGexcel: `create_xlsx_reiter()`

.panelset[
.panel[.panel-name[Erklärung]
         
- Die Funktion hängt für die Daten eines neuen Jahres einen Reiter im Excel File an, passt die Untertitel der Überschrift und ggf. den Namen des Reiters an.
         
- Zu beachten ist, dass als data Argument jeweils ein data.frame übergeben werden muss, bei welchem eine Datenspalte mit dem Namen jahr enthalten sein muss. Diese muss das entsprechende Jahr enthalten. 

- Der Datensatz sollte nur eine Zeile enthalten und die Variablenreihenfolge muss der Reihenfolge im Excel enstprechen
         
- [Doku auf GitHub](https://github.com/ogdtg/TGexcel?tab=readme-ov-file#jahr-als-zeile)
                             
]
  
.panel[.panel-name[Ausgangsdaten]
         

```r
# Dummy Data multipliziert mit 0.96
dummy_data &lt;- openxlsx::read.xlsx("Daten/excel_zeile.xlsx", sheet = 1, cols = 1:4, rows = 8,colNames = FALSE) |&gt; 
  rename(jahr = "X1") |&gt; 
  mutate(jahr = 2024) |&gt; 
  mutate_at(vars(contains("X")),~.x*0.96)
head(dummy_data, 5)
```

```
##   jahr       X2       X3      X4
## 1 2024 29.12077 29.21422 28.9852
```
]
  
.panel[.panel-name[Musterexcel]
         
![openxlsx Bsp 1](img/tgexcel_zeile1.png)
]
  
.panel[.panel-name[Code]
         

```r
library(TGexcel)
# WB des letzten Jahres laden
wb &lt;- loadWorkbook("Daten/excel_zeile.xlsx")

# Daten eintragen. Achtung bei TGexcel muss eine Zuweisung erfolgen
wb &lt;- create_xlsx_zeile(
  xlsx_path = "Daten/excel_zeile.xlsx",
  year = 2024,
  dataStart = 4, # In dieser Zeile starten die Daten
  data = dummy_data
)

# Speichern
save_tg_workbook(wb, "Daten/excel_zeile_new.xlsx", tg_header = FALSE, overwrite = TRUE)
```

```
## File saved without header
```
]
.panel[.panel-name[Ergebnis]
         
![openxlsx Bsp 2](img/tgexcel_zeile2.png)
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## TGexcel: Tabelle von Grund auf erstellen

- TGexcel bietet auch die Möglichkeit formatierte Excel Tabellen von Grund auf zu erstellen

- Dies ist vor allem dann nützlich, wenn man sich nicht auf eine Vorlage berufen möchte, z.B. weil sich deren Speicherort verändern könnte, oder aber wenn sich die Struktur der Tabelle leicht verändert und mehrfach erstellt werden muss

- Das Package beinhaltet dafür vier Grundfunktionen:
  - `create_header_style()`: Titel erstellen
  - `create_subheader_style()`: Untertitel erstellen
  - `create_varnames_style()`: Variablennamen erstellen
  - `create_data_style()`: Daten eintragen
  
- Zusätzlich gibt es die Möglichkeit mit `create_nested_header_style()` verschachtelte Variablennamen zu erstellen


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## TGexcel: Tabelle von Grund auf erstellen

.panelset[
.panel[.panel-name[Erklärung]

- in diesem Beispiel wird eine Tabelle mit verschachtelten Variablennamen erstellt

- entscheidend ist dabei das `nesting` Argument. Es definiert wie viele `vars_level2` in eine Variable aus `vars_level1` geschachtelt werden. Der `nesting` Vektor muss daher gleich lang sein wie der `vars_level1`. Der `vars_level2` vektor muss so lang sein, wie die summe des `nesting` Vektor

- Es ist auch möglich mehrfach verschachtelte Variablennamen zu erstellen. Dazu empfiehlt sich ein Blick auf das zweite Beispiel [hier](https://github.com/ogdtg/TGexcel?tab=readme-ov-file#verschachtelt)
]
.panel[.panel-name["Rechenbeispiel"]
 
- Gegeben sind:
  - `vars_level1 = c("BFS-Nr.","Total","männlich","weiblich")`
  - `vars_level2 = c("","","absolut","in %","absolut","in %")`
  - `nesting = c(1,1,2,2)`

- Summe von `nesting` ist `6` und entspricht damit der Länge von `vars_level2`
- Länge von `nesting` ist `4` und entspricht damit der Länge von `vars_level1`

Somit ergibt sich folgendes:
 - `BFS-Nr.` und `Total` erhalten jeweils **ein** untergeordnetes Element, nämlich jeweils `""`, also ein leerer String
 - `männlich` und `weiblich` erhalten jeweils **zwei** untergeordnete Elemente, nämlich jeweils `absolut` und `in %`

]
.panel[.panel-name[Code]

```r
# Workbook neu erstellen
wb &lt;- createWorkbook()
addWorksheet(wb,"Test")
create_header_style(wb = wb, sheet = "Test", ncol = 6, text = "Das ist der Titel")
create_subheader_style(wb = wb, sheet = "Test", ncol = 6, text = "Das ist der Subtitel")
create_nested_header_style(wb = wb,
                           sheet = "Test",
                           nesting = c(1,1,2,2),
                           vars_level1 = c("BFS-Nr.","Total","männlich","weiblich"),
                           vars_level2 = c("","","absolut","in %","absolut","in %"))

#Daten abspeichern
saveWorkbook(wb,"Daten/wb3.xlsx",overwrite = TRUE)
```
]
.panel[.panel-name[Ergebnis]


![openxlsx Bsp 1](img/tgexcel1.png)
]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://github.com/ogdtg/TGexcel' target="_blank"&gt;
    &lt;img src='img/hex-TGexcel.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Hands-On: Daten in Excel schreiben mit TGexcel

Gegeben sind zwei Datensätze

  - `Slides/Daten/gemeinde_order.rds:` enthält alle Gemeinden in der korrekten Reihenfolge wie im Excel
  
  - `Slides/Daten/geburten_24.rds:` enthält Gesamtgeburtenzahlen für das Jahr 2024 nach Gemeinde, Bezirk und für den Gesamtkanton                                                                                                                                                                                      

Gegeben ist ausserdem die Datei `Slides/Daten/2023_Gde_Geb_ab2000.xlsx`                                   
                                                                                                         
Füge die Geburtenzahlen für das Jahr 2024 in die Excel `2023_Gde_Geb_ab2000.xlsx` ein und speichere sie als **`Slides/Daten/2024_Gde_Geb_ab2000_DEIN_KÜRZEL.xlsx`** neu ab         

<div class="countdown" id="timer_6a03689f" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---























---
----

## Was ist eine API?

- **API** bedeutet:  **Application Programming Interface**  

- Eine API ist wie ein **Kellner** in einem Restaurant:  
  - Du (das Programm) gibst eine **Bestellung** (Anfrage).  
  - Die API bringt deine Bestellung zur **Küche** (Server).  
  - Die Küche liefert die Antwort zurück.

- Sie ermöglicht Programmen, **miteinander zu kommunizieren**.

---
----
## Was ist eine REST API?

- Eine **REST API** nutzt das **HTTP-Protokoll** – wie Webseiten.  

- **REST** steht für: **Representational State Transfer**

- Typische Aufgaben einer REST API:
  - **Daten abrufen**: `GET`-Request 
  - **Daten senden**: `POST`-Request 
  - **Daten aktualisieren** oder **löschen**: `PUT`-Request bzw `DELETE`-Request 
  
- **REST API** können über URLs angesteuert werden. Oft kann man diese auch einfach im Browser eingenben und erhält ein Ergebnis (nützlich zum Ausprobieren)

- Um eine **REST API** anzusteuern wird das `httr` oder das `httr2` Package verwendet.

- Eine **REST API** antwortet in der Regel im JSON Format
---
----
## Die API-Response
.panelset[
.panel[.panel-name[Statuscode]
Der Statuscode gibt an, ob die Anfrage erfolgreich war und liefert Informationen über den Status der Anfrage. Verschiede Stauscodes sind:

- **2xx (Success): Anfrage war erfolgreich** 😄
  - `200 OK`: Anfrage erfolgreich verarbeitet.
  - `201 Created`: Ressource erfolgreich erstellt (bei POST-Anfragen).
- **4xx (Client Error): Problem auf der Seite des Clients** 🤔
  - `400 Bad Request`: Anfrage ist fehlerhaft.
  - `401 Unauthorized`: Fehlende oder ungültige Authentifizierung.
  - `404 Not Found`: Ressource nicht gefunden.
- **5xx (Server Error): Problem auf der Seite des Servers** 😡
  - `500 Internal Server Error`: Unerwarteter Serverfehler.
  - `503 Service Unavailable`: Dienst vorübergehend nicht verfügbar.

]
.panel[.panel-name[Response Body]

Der Body enthält die Daten der Antwort, meistens im JSON- oder XML-Format. Dies ist der Hauptteil der Antwort und enthält je nach API die angeforderten Informationen. Die Daten sind oft kodiert. Die Kodierung händelt aber das `httr2` Package
]
.panel[.panel-name[Headers]
Headers sind zusätzliche Informationen, die mit der Antwort geliefert werden. Sie enthalten Metadaten über die Antwort oder den Server.

**Wichtige Header:**
- `Content-Type:` Typ der Daten im Body (z. B. application/json).
- `Content-Length:` Größe des Response-Bodies.
- `Date:` Zeitpunkt der Antwort.
- `Server:` Informationen über den Server.
- `Authorization:` Informationen zur Authentifizierung (falls relevant).
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## API-Requests mit `httr2`

**Warum `httr2`?**
- Moderner, flexibler und schlanker Ansatz im Vergleich zu `httr`.
- Unterstützt einfache Handhabung von HTTP-Requests, Headern, Body und Authentifizierung.



**Typischer Workflow mit `httr2`:**
  1. Request-Objekt erstellen
  2. Request anpassen (z. B. Header, Query-Parameter)
  3. Request senden und Antwort prüfen
  4. Antwortdaten verarbeiten

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## GET-Request

- `GET`-Requests werden dazu benutzt um Daten abzurufen

- Ohne weitere Spezifikationen führt `httr2` standardmässig ein `GET`-Request aus

- Grundlage eines jeden Request ist die entsprechende URL, der sogenannte **API-Endpoint**. Dieser kann aus der API Dokumentation der entsprchenden Website entnommen werden.

- Eine API-URL besteht in der Regel aus einer base-URL und dem spezifischen Endpoint

**Wichtige Funktionen:**
- `request()`: Erstellt ein Request-Objekt.
- `req_perform()`: Führt die Anfrage aus.
- `resp_body_json()`: Antwort-Body als JSON-Daten einlesen.

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## GET-Request: Beispiel data.tg.ch

.panelset[
.panel[.panel-name[API Console]
[![openxlsx Bsp 1](img/datatg_api.png)](https://data.tg.ch/api/explore/v2.1/console)
]
.panel[.panel-name[Code]

```r
library(httr2)
base_url &lt;- "https://data.tg.ch/api/explore/v2.1"
endpoint &lt;- "/catalog/datasets/sk-stat-56/exports/json"
url &lt;- paste0(base_url,endpoint)

# Request erstellen
response &lt;- request(url) %&gt;% req_perform()

# JSON-Daten extrahieren
data &lt;- response %&gt;% resp_body_json()
```
]
.panel[.panel-name[Response]

```r
response
```

```
## &lt;httr2_response&gt;
## GET https://data.tg.ch/api/explore/v2.1/catalog/datasets/sk-stat-56/exports/json
## Status: 200 OK
## Content-Type: application/json
## Body: In memory (229996 bytes)
```

```r
response$status_code
```

```
## [1] 200
```
]
.panel[.panel-name[Data]

```r
data[[1]]
```

```
## $bfs_nr_gemeinde
## [1] "4421"
## 
## $gemeinde_name
## [1] "Horn"
## 
## $bezirk_nr
## [1] "2011"
## 
## $bezirk_name
## [1] "Bezirk Arbon"
## 
## $jahr
## [1] "2024"
## 
## $anzahl_personen
## [1] "3148"
```
]
.panel[.panel-name[Data (aufbereitet)]

```r
data |&gt; bind_rows()
```

```
## # A tibble: 1,440 × 6
##    bfs_nr_gemeinde gemeinde_name     bezirk_nr bezirk_name jahr  anzahl_personen
##    &lt;chr&gt;           &lt;chr&gt;             &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;          
##  1 4421            Horn              2011      Bezirk Arb… 2024  3148           
##  2 4656            Güttingen         2013      Bezirk Kre… 2024  1775           
##  3 4696            Tägerwilen        2013      Bezirk Kre… 2024  5414           
##  4 4746            Münchwilen        2014      Bezirk Mün… 2024  5935           
##  5 4561            Felben-Wellhausen 2012      Bezirk Fra… 2024  3213           
##  6 4816            Homburg           2012      Bezirk Fra… 2024  1571           
##  7 4831            Müllheim          2012      Bezirk Fra… 2024  3315           
##  8 4611            Thundorf          2012      Bezirk Fra… 2024  1729           
##  9 4646            Ermatingen        2013      Bezirk Kre… 2024  3764           
## 10 4666            Kemmental         2013      Bezirk Kre… 2024  2807           
## # ℹ 1,430 more rows
```
]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## GET-Request mit Query Paramtern: Beispiel data.tg.ch

.panelset[
.panel[.panel-name[Erklärung]

- Mit Query-Parametern kann die Anfrage verfeinert werden, sodass man genau das erhält was man braucht

- in einer URL kann man Query-Paramter daran erkennen, dass sie nach dem `?` stehen

- auf data.tg.ch kann man zum Beispiel einen SQL-artigen Sysntax anwenden. Die Möglichkeiten von Query Parametern unterscheiden sich aber von API zu API

- Beispiel: `https://data.tg.ch/api/explore/v2.1/catalog/datasets/sk-stat-56/exports/json?select=gemeinde_name,anzahl_personen&amp;where=jahr=date'2021' and gemeinde_name='Frauenfeld'`
]
.panel[.panel-name[Code]

```r
response &lt;- request(url) %&gt;%
  req_url_query(
    select = "gemeinde_name,anzahl_personen", 
    where = "jahr=date'2021' and gemeinde_name='Frauenfeld'"
  ) %&gt;%
  req_perform()

data &lt;- response %&gt;% resp_body_json() |&gt; bind_rows()
```
]
.panel[.panel-name[Response]

```r
response
```

```
## &lt;httr2_response&gt;
## GET https://data.tg.ch/api/explore/v2.1/catalog/datasets/sk-stat-56/exports/json?select=gemeinde_name%2Canzahl_personen&amp;where=jahr%3Ddate%272021%27%20and%20gemeinde_name%3D%27Frauenfeld%27
## Status: 200 OK
## Content-Type: application/json
## Body: In memory (61 bytes)
```

```r
response$status_code
```

```
## [1] 200
```
]
.panel[.panel-name[Data]

```r
data
```

```
## # A tibble: 1 × 2
##   gemeinde_name anzahl_personen
##   &lt;chr&gt;         &lt;chr&gt;          
## 1 Frauenfeld    25816
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## GET-Request mit Authentifizierung: Beispiel dataspot


- Für viele API-Dienste bedarf es einer Authentifizierung

- Dazu gibt es [verschiedene Authentifizierungsmöglichkeiten](https://www.computerweekly.com/de/tipp/API-Sicherheit-Gaengige-Methoden-zur-Authentifizierung):
  - HTTP Basic Authentication
  - Access Tokens
  - OAuth mit OpenID
  - etc.

- Manche dieser Methoden sind sicherer als andere, doch man ist meist nicht frei in der Auswahl, da man nur die Methoden verwenden kann, die auch von Seiten des API-Frameworks implementiert sind

- dataspot verwendet (zumindest in unserer Konfiguration) `HTTP Basic Authentication` mit Passwort und Username. Dies ist zwar am wenigsten "sicher", dafür aber sehr einfach zu verwenden.


---
----
## Einschub: Umgebungsvariablen in R

.panelset[
.panel[.panel-name[Erklärung]

- v.a. Passwörter aber auch API-Keys sollten nicht direkt im Script gespeichert werden

- Umgebungsvariablen helfen dabei, Code und Credentials zu trennen 

- Diese können entweder über `usethis::edit_r_environ()` dauerhaft oder mit `Sys.setenv()` für die Dauer der Session angelegt werden

]
.panel[.panel-name[edit_r_environ()]

- Mit `usethis::edit_r_environ()` öffnet sich das `.Renviron` File. Hier können Umgebungsvariablen direkt eingegeben werden.

- Nach dem Speichern des Files und Neustart der R Session sind die Umgebungsvariablen dauerhaft abrufbar

![renviron file](img/renviron.png)

]
.panel[.panel-name[Sys.setenv()]

- Mit `Sys.setenv()` können Umgebungsvariablen für die Dauer einer Session gesetzt werden

- `Sys.setenv()` überschreibt Umgebungsvariablen aus dem `.Renviron` File für die Dauer der Session.


```r
Sys.setenv(PASSWORT="meinpasswort",
           USER="meinname")
```
]
.panel[.panel-name[Umgebungsvariablen nutzen]

- Egal, wie die Umgebungsvariablen definiert wurden, beziehen kann man sie mit `Sys.getenv()`


```r
Sys.getenv("PASSWORT")
```

```
## [1] "meinpasswort"
```

```r
Sys.getenv("USER")
```

```
## [1] "meinname"
```
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## GET-Request mit Authentifizierung: Beispiel dataspot
.panelset[
.panel[.panel-name[API Doku]

- dataspot besitzt keine API Console zum Testen und nur eine eher rudimentäre Dokumentation

- Mit dieser Doku und viel Herumprobieren kann man dennoch einige Funktionalitäten mit der API darstellen

- [Link zur dataspot-API-Doku](https://dataspot.apps.ktgcpp01.tg.ch/api/dataspot/manual/rest-api)

- Als Beispiel werden wir eine Funktion erstellen, die eine Liste mit allen Referenzdaten erstellt


]
.panel[.panel-name[Code]

```r
library(httr2)
base_url &lt;- "https://dataspot.apps.ktgcpp01.tg.ch/rest/dataspot"
endpoint &lt;- "/schemes/Referenzdaten/enumerations"
url &lt;- paste0(base_url,endpoint)

# Request erstellen
response &lt;- request(url) |&gt; 
  req_auth_basic(username = Sys.getenv("DATASPOT_USER"),password = Sys.getenv("DATASPOT_PW")) |&gt; 
  req_perform()

# JSON-Daten extrahieren
data &lt;- response |&gt; resp_body_json()
```
]
.panel[.panel-name[Response]

```r
response
```

```
## &lt;httr2_response&gt;
## GET https://dataspot.apps.ktgcpp01.tg.ch/rest/dataspot/schemes/Referenzdaten/enumerations
## Status: 200 OK
## Content-Type: application/hal+json
## Body: In memory (368184 bytes)
```

```r
response$status_code
```

```
## [1] 200
```
]
.panel[.panel-name[Data]
![result dataspot](img/req_auth.png)
]
.panel[.panel-name[Data (aufbereitet)]

Daten können dieses Mal nicht so einfach verwendet werden, sondern es bedarf einer etwas komplizierteren Aufbereitung

```r
# dataspotR Package
devtools::load_all("/r-proj/stat/ogd/dataspotR")
```

```
## ℹ Loading dataspotR
```

```r
# Funktion zum aufbereiten aus dem Package
referenzdaten &lt;- prepare_raw_results(data)
referenzdaten
```

```
## # A tibble: 305 × 36
##    `_type`      id    `_version` tenantId modelId publicState label status title
##    &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
##  1 ReferenceOb… 7a22…          1 51584d0… 13ae8d… DRAFT       Stat… WORKI… Stat…
##  2 ReferenceOb… b94a…          5 51584d0… 13ae8d… DRAFT       ICD-… WORKI… ICD-…
##  3 ReferenceOb… e814…         10 51584d0… 13ae8d… DRAFT       NR E… WORKI… Aggr…
##  4 ReferenceOb… 95cb…          1 51584d0… 13ae8d… DRAFT       SOME… WORKI… SOME…
##  5 ReferenceOb… 6c14…         12 51584d0… 13ae8d… DRAFT       ATC-… WORKI… ATC-…
##  6 ReferenceOb… 018c…          4 51584d0… 13ae8d… DRAFT       Fünf… WORKI… Fünf…
##  7 ReferenceOb… 1e31…          2 51584d0… 13ae8d… DRAFT       SOME… WORKI… SOME…
##  8 ReferenceOb… bb53…          4 51584d0… 13ae8d… DRAFT       Alte… WORKI… Alte…
##  9 ReferenceOb… 5868…          3 51584d0… 13ae8d… DRAFT       MAS … WORKI… Ausr…
## 10 ReferenceOb… 1713…          4 51584d0… 13ae8d… DRAFT       SOME… WORKI… Pfle…
## # ℹ 295 more rows
## # ℹ 27 more variables: href &lt;chr&gt;, parentId &lt;chr&gt;, createdBy &lt;chr&gt;, db &lt;chr&gt;,
## #   dateCreated &lt;dbl&gt;, description &lt;chr&gt;, stringType &lt;chr&gt;, favorite &lt;lgl&gt;,
## #   validFrom &lt;dbl&gt;, tags &lt;chr&gt;, self &lt;chr&gt;, inCollection &lt;chr&gt;,
## #   literals &lt;chr&gt;, rangeOf &lt;chr&gt;, fromMappings &lt;chr&gt;, derivedFrom &lt;chr&gt;,
## #   toMappings &lt;chr&gt;, fromRules &lt;chr&gt;, subordinateOf &lt;chr&gt;,
## #   transformations &lt;chr&gt;, subordinates &lt;chr&gt;, attributedTo &lt;chr&gt;, …
```
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dataspot.apps.ktgcpp01.tg.ch/api/dataspot/manual/rest-api' target="_blank"&gt;
    &lt;img src='img/hex-dataspotR.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## `dataspotR` Package

- Package um die dataspot Rest API zu nutzen

- derzeit nur ein Entwurf, aber durchaus nutzbar

- mit dem Package können ganz einfach alle möglichen Dataspot Elemente bezogen und auch angelegt werden

Das Package ist derzeit noch nicht auf GitHub, kann aber lokal geladen werden mit 


```r
devtools::load_all("/r-proj/stat/ogd/dataspotR")
```

```
## ℹ Loading dataspotR
```
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dataspot.apps.ktgcpp01.tg.ch/api/dataspot/manual/rest-api' target="_blank"&gt;
    &lt;img src='img/hex-dataspotR.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## dataspotR: Referenzdaten beziehen

.panelset[
.panel[.panel-name[Liste beziehen]


```r
# Das, was vorhin gemacht wurde in einer Funktion komprimiert
referenzdaten &lt;- get_referenzdaten_list()
referenzdaten |&gt; 
  select(id,label,title,createdBy)  
```

```
## # A tibble: 305 × 4
##    id                                   label                    title createdBy
##    &lt;chr&gt;                                &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt;    
##  1 7a225073-4181-4fcf-9125-5233a8a3819e Status FU                Stat… cwalser  
##  2 b94a440f-a32e-461c-ad79-55e737af9acb ICD-Code (TU, Krebs)     ICD-… cwalser  
##  3 e8140301-03fe-41d4-9a78-7b9ce7e4602d NR Einsatzstichworte_In… Aggr… cwalser  
##  4 95cbbfee-4030-4d2e-98d9-d038b4f5fa55 SOMED-Mitarbeiterstellu… SOME… cwalser  
##  5 6c1409b2-0534-4459-98c5-fdc5f7663d8f ATC-Hauptgruppen         ATC-… cwalser  
##  6 018cca2a-fc08-41ee-8cc0-7cbc5eddbff4 Fünfjahresaltersklasse   Fünf… lparment…
##  7 1e310c05-5e36-443a-8358-ba08f74c1560 SOMED-RAI-RUG Code       SOME… lvogt    
##  8 bb5354eb-0a58-4cf9-b3f1-b914983e158f Alter4Kategorien (0-17,… Alte… mhausamm…
##  9 58680f12-47e3-451a-9a1a-ffacc1ff644d MAS Ausrichtung des Sta… Ausr… cwalser  
## 10 1713aab2-38e3-4ae3-9639-4a1fff53e96d SOMED-Pflegeaufwandgrup… Pfle… cwalser  
## # ℹ 295 more rows
```

]
.panel[.panel-name[Referenzdatenobjekt beziehen]

```r
get_referenzdaten("Thurgauer Gemeinden") |&gt; 
  select(shortText,label,code)
```

```
## # A tibble: 80 × 3
##    shortText  label             code 
##    &lt;chr&gt;      &lt;chr&gt;             &lt;chr&gt;
##  1 Arbon      4401 - Arbon      4401 
##  2 Dozwil     4406 - Dozwil     4406 
##  3 Egnach     4411 - Egnach     4411 
##  4 Hefenhofen 4416 - Hefenhofen 4416 
##  5 Horn       4421 - Horn       4421 
##  6 Kesswil    4426 - Kesswil    4426 
##  7 Roggwil    4431 - Roggwil    4431 
##  8 Romanshorn 4436 - Romanshorn 4436 
##  9 Salmsach   4441 - Salmsach   4441 
## 10 Sommeri    4446 - Sommeri    4446 
## # ℹ 70 more rows
```
]
.panel[.panel-name[Objekte beziehen]

Jedes Objekt auf dataspot besitzt eine ID und kann mit dieser bezogen werden


```r
# Beispiel Sammlung Open Government Data im A-Anlieferungen
get_element_by_id("cb0cc89d-e011-4ee1-8c2c-06a631206926")
```

```
## # A tibble: 1 × 21
##   `_type` id    `_version` tenantId modelId publicState label description status
##   &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; 
## 1 Collec… cb0c…          2 51584d0… f4f20d… PUBLIC      ogd … Sämtliche … PUBLI…
## # ℹ 12 more variables: title &lt;chr&gt;, favorite &lt;lgl&gt;, href &lt;chr&gt;, parentId &lt;chr&gt;,
## #   createdBy &lt;chr&gt;, db &lt;chr&gt;, dateCreated &lt;dbl&gt;, self &lt;chr&gt;, assets &lt;chr&gt;,
## #   collections &lt;chr&gt;, inScheme &lt;chr&gt;, endpoint &lt;chr&gt;
```
]
]
---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## POST-Request

.panelset[
.panel[.panel-name[Erklärung]

- **POST**-Requests werden verwendet, um neue Daten auf einem Server zu erstellen.

- In der Anfrage wird ein **Body** mit den zu sendenden Daten übermittelt (z. B. als JSON).

**Wichtige Funktionen für POST:**
- `req_body_json()`: Legt die Daten im JSON-Format fest.
- `req_perform()`: Führt die Anfrage aus.

]
.panel[.panel-name[Beispiel]

```r
response &lt;- request("https://jsonplaceholder.typicode.com/posts") %&gt;%
  req_body_json(list(
    title = "Neuer Beitrag",
    body = "Dies ist ein Beispieltext",
    userId = 1
  )) %&gt;%
  req_perform()

# Ergebnis ansehen
response %&gt;% resp_body_json()
```

```
## $title
## [1] "Neuer Beitrag"
## 
## $body
## [1] "Dies ist ein Beispieltext"
## 
## $userId
## [1] 1
## 
## $id
## [1] 101
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## PUT-Request

.panelset[
.panel[.panel-name[Erklärung]

- **PUT**-Requests werden verwendet, um Daten auf einem Server zu aktualisieren.

- Dabei wird der gesamte Datensatz ersetzt.

**Wichtige Funktionen für PUT:**
- `req_body_json()`: Legt die zu aktualisierenden Daten fest.
- `req_perform()`: Führt die Anfrage aus.


]
.panel[.panel-name[Beispiel]

```r
response &lt;- request("https://jsonplaceholder.typicode.com/posts/1") %&gt;%
  req_method("PUT") %&gt;%
  req_body_json(list(
    id = 1,
    title = "Aktualisierter Beitrag",
    body = "Der Inhalt wurde aktualisiert",
    userId = 1
  )) %&gt;%
  req_perform()

# Aktualisierte Daten ansehen
response %&gt;% resp_body_json()
```

```
## $id
## [1] 1
## 
## $title
## [1] "Aktualisierter Beitrag"
## 
## $body
## [1] "Der Inhalt wurde aktualisiert"
## 
## $userId
## [1] 1
```
]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## DELETE-Request


.panelset[
.panel[.panel-name[Erklärung]

- **DELETE**-Requests werden verwendet, um Daten auf einem Server zu löschen.

- Es wird keine zusätzliche Datenübertragung (Body) benötigt.

**Wichtige Funktionen für DELETE:**
- `req_method("DELETE")`: Setzt die HTTP-Methode auf DELETE.
- `req_perform()`: Führt die Anfrage aus.


]
.panel[.panel-name[Beispiel]

```r
response &lt;- request("https://jsonplaceholder.typicode.com/posts/1") %&gt;%
  req_method("DELETE") %&gt;%
  req_perform()

# Statuscode prüfen
response$status_code
```

```
## [1] 200
```
]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://httr2.r-lib.org/logo.png' target="_blank"&gt;
    &lt;img src='https://httr2.r-lib.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## Trockenlauf (`req_dry_run()`)

.panelset[
.panel[.panel-name[Erklärung]

- `req_dry_run()` zeigt, wie die Anfrage aussehen würde, ohne sie tatsächlich auszuführen.
- Nützlich, um Anfragen vorab zu prüfen.


]
.panel[.panel-name[Beispiel]

```r
request("https://jsonplaceholder.typicode.com/posts") %&gt;%
  req_method("POST") %&gt;%
  req_body_json(list(
    title = "Test",
    body = "Dies ist ein Test",
    userId = 1
  )) %&gt;%
  req_dry_run()
```

```
## POST /posts HTTP/1.1
## accept: */*
## accept-encoding: deflate, gzip, br, zstd
## content-length: 54
## content-type: application/json
## host: jsonplaceholder.typicode.com
## user-agent: httr2/1.1.2.9000 r-curl/6.4.0 libcurl/7.81.0
## 
## {
##   "title": "Test",
##   "body": "Dies ist ein Test",
##   "userId": 1
## }
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dataspot.apps.ktgcpp01.tg.ch/api/dataspot/manual/rest-api' target="_blank"&gt;
    &lt;img src='img/hex-dataspotR.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Hands-On: Referenzdaten beziehen

Was ist die Entsprechung des Codes `9` für Religionen in der Strukturerhebung? Löse das Problem programmatisch.
Das Ergebnis sollte ein Datensatz mit einer Zeile sein, welcher ID, shortText, code sowie den/die Ersteller/in enthält.

Beachte dass du, wenn du das `dataspotR` benutzen möchtest die Umgebungsvariablen `DATASPOT_USER` und `DATASPOT_PW` initialisieren musst.
---































----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Verbindung herstellen

- um die Verbindung herzustellen muss das `DBI` Package geladen und die `odbc()` Funktion aus dem `odbc` Package verwendet werden

- die benötigten Credentials am Besten wieder als Umgebungsvariablen speichern

- Weitere Infos zur Verbindung auf [Confluence](https://tgweb.tg.ch/display/datastat/R+Workbench)

- Nach der Verbindung können alle Schemata und Tabellen im Reiter `Connecttions` (neben Environment) eingesehen werden

.panelset[
.panel[.panel-name[Intern]


```r
library(DBI)
con &lt;- dbConnect(odbc::odbc(), 
                 Driver="sqlserver", 
                 Server = Sys.getenv("DATABASE_SERVER"), 
                 Port = "1433", 
                 UID = Sys.getenv("LANDING_USER"), 
                 PWD = Sys.getenv("LANDING_PW"), 
                 Database = "landing")
```
]
.panel[.panel-name[Öfeentlich]

```r
library(RSQLite)
con &lt;- dbConnect(RSQLite::SQLite(), "Daten/landing_local.db")
```
]
]

---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Vorhandene Tabellen anzeigen

- Alle vorhandenen Tabellen in einem Schema können mit einem einfachen SQL-Statement abgrufen werden



```r
dbo_tables &lt;- dbListTables(con)
dbo_tables
```

```
## [1] "geres_bestand_2015_2022"  "geres_bestand_2020_12_31"
## [3] "geres_bestand_2021_12_31" "geres_bestand_2022_12_31"
## [5] "geres_bestand_2023_03_31"
```


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## Felder einer Tabelle anzeigen

- Felder einer Tabelle können mit `dbListFields()` abegrufen werden


```r
dbListFields(con, "geres_bestand_2015_2022")
```

```
##  [1] "Stichtag"               "Statistikjahr"          "BFS_Nr"                
##  [4] "NationalitaetAggrID"    "AuslKategorieAggrID"    "StaatsangehoerigkeitID"
##  [7] "KonfessionAggrID"       "GeschlechtID"           "Alter5KlassenID"       
## [10] "AltersKlassenAggrID"    "Anz_StBev"
```

---
----

&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://www.tidyverse.org/' target="_blank"&gt;
    &lt;img src='https://tidyverse.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;

## tidyverse und Datenbanken

.panelset[
.panel[.panel-name[Erklärung]

- mit `tbl` wird ein Pointer zu einer Tabelle erstellt

- die Daten werden dafür noch nicht heruntergeladen

- Auf den Pointer können `tidyverse`-Operationen angewendet werden. Diese werden automatisch in **SQL-Queries** umgewandelt

- Um die Daten dann tatsächlich herunterzuladen kann die `collect()` Funktion verwendet werden

- **SQL-Queries** können mit `show_query()` angezeigt werden
]
.panel[.panel-name[Query erstellen]

```r
query &lt;- tbl(con,"geres_bestand_2015_2022") |&gt; 
  filter(Statistikjahr==2020) |&gt; 
  group_by(StaatsangehoerigkeitID) |&gt; 
  summarise(summe = sum(Anz_StBev,na.rm = TRUE)) |&gt; 
  arrange(desc(summe))

query
```

```
## # Source:     SQL [?? x 2]
## # Database:   sqlite 3.45.0 [/r-proj/stat/workshop/R Workshop DS/Slides/rmd/Daten/landing_local.db]
## # Ordered by: desc(summe)
##    StaatsangehoerigkeitID  summe
##                     &lt;dbl&gt;  &lt;dbl&gt;
##  1                   8100 193400
##  2                   8207   9324
##  3                   8255   3283
##  4                   8218   2907
##  5                   8231   1263
##  6                   8239    685
##  7                   8256    229
##  8                   8230    125
##  9                   8252     76
## 10                   8248     12
## # ℹ more rows
```
]
.panel[.panel-name[Query anzeigen]

```r
query |&gt; show_query()
```

```
## &lt;SQL&gt;
## SELECT `StaatsangehoerigkeitID`, SUM(`Anz_StBev`) AS `summe`
## FROM (
##   SELECT `geres_bestand_2015_2022`.*
##   FROM `geres_bestand_2015_2022`
##   WHERE (`Statistikjahr` = 2020.0)
## ) AS `q01`
## GROUP BY `StaatsangehoerigkeitID`
## ORDER BY `summe` DESC
```

]
.panel[.panel-name[Query ausführen]

```r
data &lt;- query |&gt; collect()
data
```

```
## # A tibble: 12 × 2
##    StaatsangehoerigkeitID  summe
##                     &lt;dbl&gt;  &lt;dbl&gt;
##  1                   8100 193400
##  2                   8207   9324
##  3                   8255   3283
##  4                   8218   2907
##  5                   8231   1263
##  6                   8239    685
##  7                   8256    229
##  8                   8230    125
##  9                   8252     76
## 10                   8248     12
## 11                   8362     11
## 12                   8232     11
```

]
.panel[.panel-name[SQL]

```r
sql_query &lt;- 'SELECT "StaatsangehoerigkeitID", SUM("Anz_StBev") AS "summe"
 FROM (
   SELECT "geres_bestand_2015_2022".*
   FROM "geres_bestand_2015_2022"
   WHERE ("Statistikjahr" = 2020.0)
 ) "q01"
 GROUP BY "StaatsangehoerigkeitID"
 ORDER BY "summe" DESC'
dbGetQuery(con,sql_query)
```

```
##    StaatsangehoerigkeitID  summe
## 1                    8100 193400
## 2                    8207   9324
## 3                    8255   3283
## 4                    8218   2907
## 5                    8231   1263
## 6                    8239    685
## 7                    8256    229
## 8                    8230    125
## 9                    8252     76
## 10                   8248     12
## 11                   8362     11
## 12                   8232     11
```

]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://www.tidyverse.org/' target="_blank"&gt;
    &lt;img src='https://tidyverse.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## tidyverse und Datenbanken

.panelset[
.panel[.panel-name[Erklärung]

- Es ist auch möglich zwei `tbl` Objekte miteinander zu joinen

- Ebenso können `tbl` Objekte mit lokalen Daten gejoined werden. Dazu muss nur der lokale data.frame in einen lazy table umgewandelt werden. Dies wird erreicht indem man innerhalb des joins `copy=TRUE` setzt.

- Diese Option ist allerdings "teuer", da die Ergebnisse temporär in die lokale Session geladen werden. 

]
.panel[.panel-name[Query erstellen]

```r
query &lt;- tbl(con,"geres_bestand_2015_2022") |&gt; 
  filter(Statistikjahr==2020) |&gt; 
  group_by(StaatsangehoerigkeitID) |&gt; 
  summarise(summe = sum(Anz_StBev,na.rm = TRUE)) |&gt; 
  arrange(desc(summe))

query
```

```
## # Source:     SQL [?? x 2]
## # Database:   sqlite 3.45.0 [/r-proj/stat/workshop/R Workshop DS/Slides/rmd/Daten/landing_local.db]
## # Ordered by: desc(summe)
##    StaatsangehoerigkeitID  summe
##                     &lt;dbl&gt;  &lt;dbl&gt;
##  1                   8100 193400
##  2                   8207   9324
##  3                   8255   3283
##  4                   8218   2907
##  5                   8231   1263
##  6                   8239    685
##  7                   8256    229
##  8                   8230    125
##  9                   8252     76
## 10                   8248     12
## # ℹ more rows
```
]
.panel[.panel-name[join lokal]

```r
# Daten aus dataspot
# staaten &lt;- dataspotR::get_referenzdaten("Staaten, Regionen (det/ aggr)") |&gt; 
#   select(shortText,code) |&gt; 
#   mutate_all(as.character)
staaten &lt;- readRDS("Daten/staaten.rds")

# Join und collect
data_join_lokal &lt;- query |&gt; 
  mutate(StaatsangehoerigkeitID = as.character(StaatsangehoerigkeitID)) |&gt; 
  left_join(staaten, join_by("StaatsangehoerigkeitID"=="code"),copy = TRUE) |&gt; 
  collect() |&gt; 
  arrange(desc(summe))
```

```
## Warning: ORDER BY is ignored in subqueries without LIMIT
## ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
```

]
.panel[.panel-name[join lokal (2)]

```r
data_join_lokal
```

```
## # A tibble: 12 × 3
##    StaatsangehoerigkeitID  summe shortText
##    &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;    
##  1 8100.0                 193400 &lt;NA&gt;     
##  2 8207.0                   9324 &lt;NA&gt;     
##  3 8255.0                   3283 &lt;NA&gt;     
##  4 8218.0                   2907 &lt;NA&gt;     
##  5 8231.0                   1263 &lt;NA&gt;     
##  6 8239.0                    685 &lt;NA&gt;     
##  7 8256.0                    229 &lt;NA&gt;     
##  8 8230.0                    125 &lt;NA&gt;     
##  9 8252.0                     76 &lt;NA&gt;     
## 10 8248.0                     12 &lt;NA&gt;     
## 11 8232.0                     11 &lt;NA&gt;     
## 12 8362.0                     11 &lt;NA&gt;
```

]
]


---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://www.tidyverse.org/' target="_blank"&gt;
    &lt;img src='https://tidyverse.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## tidyverse und Datenbanken

Deutlich ausführlicher wird dieses Thema im Workshop von Cynkra behandelt.

&lt;!-- Ihr findet alle Workshop Unterlagen lokal auf unserer Workbench oder nur die Folien auf [GitHub](https://cynkra.github.io/databases-sg_stat-2024/#1) --&gt;

Ihr findet die Folien auf [GitHub](https://cynkra.github.io/databases-sg_stat-2024/#1).




---
----
&lt;figure class="logo-fig logo-fig-small"&gt;
  &lt;a href='https://dbi.r-dbi.org/' target="_blank"&gt;
    &lt;img src='img/hex-DBI (1).png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
&lt;figure class="logo-fig logo-fig-small2"&gt;
  &lt;a href='https://www.tidyverse.org/' target="_blank"&gt;
    &lt;img src='https://tidyverse.tidyverse.org/logo.png' class='logo'/&gt;
  &lt;/a&gt;
&lt;/figure&gt;
## Hands On: tidyverse und Datenbanken

Errechne den Ausländeranteil pro Gemeinde für die Jahre 2015 bis 2022.

Beachte, dass der finale Datensatz lokal als normaler R data.frame nutzbar sein muss.

**Ergebnis:**


```
## # A tibble: 4 × 3
## # Groups:   Statistikjahr [1]
##   Statistikjahr BFS_Nr auslaenderanteil
##           &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt;
## 1          2015   4401            11.3 
## 2          2015   4436            12.7 
## 3          2015   4461            15.0 
## 4          2015   4471             4.10
```

<div class="countdown" id="timer_1ce9aaa8" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
